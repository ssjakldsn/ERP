import{d as j,h as G,z as H,r as n,e as O,o,q as r,w as a,f as l,a as t,x as i,y as P,t as g,a5 as $,k as Q,U as W,C as X,cA as Y,K as Z,cc as ee,I as ae,L as le,J as te,M as se}from"./index-CIfmhqRC.js";import{_ as de}from"./Dialog.vue_vue_type_style_index_0_lang-CtaLqQeX.js";import{E as ue}from"./el-text-DMgoq9G3.js";import{_ as oe}from"./Tooltip.vue_vue_type_script_setup_true_lang-qxoFczfQ.js";import{D as re,b as ne,c as ie,u as ce}from"./index-CwB7FJGa.js";import{d as me,h as pe}from"./tree-BMqZf9_I.js";import{g as fe}from"./index-C34hh2Ad.js";const ve=j({__name:"BusinessStatusForm",emits:["success"],setup(ye,{expose:q,emit:z}){const{t:_}=G(),V=H(),c=n(!1),C=n(""),m=n(!1),x=n(""),s=n({id:void 0,name:"",deptIds:[],statuses:[]}),D=O({name:[{required:!0,message:"\u72B6\u6001\u7EC4\u540D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),h=n(),S=n([]),f=n(),U=n(!0);q({open:async(u,d)=>{if(c.value=!0,C.value=_("action."+u),x.value=u,A(),d){m.value=!0;try{s.value=await ne(d),f.value.setCheckedKeys(s.value.deptIds),s.value.statuses.length==0&&w()}finally{m.value=!1}}else w();S.value=pe(await fe())}});const F=z,R=async()=>{await h.value.validate(),m.value=!0;try{const u=s.value;u.deptIds=f.value.getCheckedKeys(!1),x.value==="create"?(await ie(u),V.success(_("common.createSuccess"))):(await ce(u),V.success(_("common.updateSuccess"))),c.value=!1,F("success")}finally{m.value=!1}},A=()=>{var u,d;U.value=!0,s.value={id:void 0,name:"",deptIds:[],statuses:[]},(u=f.value)==null||u.setCheckedNodes([]),(d=h.value)==null||d.resetFields()},w=()=>{s.value.statuses.push({name:"",percent:void 0})};return(u,d)=>{const I=W,b=X,B=oe,E=Y,v=ue,y=Z,J=ee,k=ae,L=le,M=te,N=de,T=se;return o(),r(N,{title:t(C),modelValue:t(c),"onUpdate:modelValue":d[2]||(d[2]=e=>Q(c)?c.value=e:null)},{footer:a(()=>[l(k,{onClick:R,type:"primary",disabled:t(m)},{default:a(()=>[i("\u786E \u5B9A")]),_:1},8,["disabled"]),l(k,{onClick:d[1]||(d[1]=e=>c.value=!1)},{default:a(()=>[i("\u53D6 \u6D88")]),_:1})]),default:a(()=>[P((o(),r(M,{ref_key:"formRef",ref:h,model:t(s),rules:t(D),"label-width":"100px"},{default:a(()=>[l(b,{label:"\u72B6\u6001\u7EC4\u540D",prop:"name"},{default:a(()=>[l(I,{modelValue:t(s).name,"onUpdate:modelValue":d[0]||(d[0]=e=>t(s).name=e),placeholder:"\u8BF7\u8F93\u5165\u72B6\u6001\u7EC4\u540D"},null,8,["modelValue"])]),_:1}),l(b,{label:"\u5E94\u7528\u90E8\u95E8",prop:"deptIds"},{label:a(()=>[l(B,{message:"\u4E0D\u9009\u62E9\u90E8\u95E8\u65F6\uFF0C\u9ED8\u8BA4\u5168\u516C\u53F8\u751F\u6548",title:"\u5E94\u7528\u90E8\u95E8"})]),default:a(()=>[l(E,{ref_key:"treeRef",ref:f,data:t(S),props:t(me),"check-strictly":!t(U),"node-key":"id",placeholder:"\u8BF7\u9009\u62E9\u5F52\u5C5E\u90E8\u95E8","show-checkbox":""},null,8,["data","props","check-strictly"])]),_:1}),l(b,{label:"\u9636\u6BB5\u8BBE\u7F6E",prop:"statuses"},{default:a(()=>[l(L,{border:"",style:{width:"100%"},data:t(s).statuses.concat(re)},{default:a(()=>[l(y,{align:"center",label:"\u9636\u6BB5",width:"70"},{default:a(e=>[e.row.defaultStatus?(o(),r(v,{key:1},{default:a(()=>[i("\u7ED3\u675F")]),_:1})):(o(),r(v,{key:0},{default:a(()=>[i("\u9636\u6BB5 "+g(e.$index+1),1)]),_:2},1024))]),_:1}),l(y,{align:"center",label:"\u9636\u6BB5\u540D\u79F0",width:"160",prop:"name"},{default:a(({row:e})=>[e.endStatus?(o(),r(v,{key:1},{default:a(()=>[i(g(e.name),1)]),_:2},1024)):(o(),r(I,{key:0,modelValue:e.name,"onUpdate:modelValue":p=>e.name=p,placeholder:"\u8BF7\u8F93\u5165\u72B6\u6001\u540D\u79F0"},null,8,["modelValue","onUpdate:modelValue"]))]),_:1}),l(y,{width:"140",align:"center",label:"\u8D62\u5355\u7387\uFF08%\uFF09",prop:"percent"},{default:a(({row:e})=>[e.endStatus?(o(),r(v,{key:1},{default:a(()=>[i(g(e.percent),1)]),_:2},1024)):(o(),r(J,{key:0,modelValue:e.percent,"onUpdate:modelValue":p=>e.percent=p,placeholder:"\u8BF7\u8F93\u5165\u8D62\u5355\u7387","controls-position":"right",min:0,max:100,precision:2,class:"!w-1/1"},null,8,["modelValue","onUpdate:modelValue"]))]),_:1}),l(y,{label:"\u64CD\u4F5C",width:"110",align:"center"},{default:a(e=>[e.row.endStatus?$("",!0):(o(),r(k,{key:0,link:"",type:"primary",onClick:p=>w(e.$index)},{default:a(()=>[i(" \u6DFB\u52A0 ")]),_:2},1032,["onClick"])),e.row.endStatus?$("",!0):(o(),r(k,{key:1,link:"",type:"danger",onClick:p=>{return K=e.$index,void s.value.statuses.splice(K,1);var K},disabled:t(s).statuses.length<=1},{default:a(()=>[i(" \u5220\u9664 ")]),_:2},1032,["onClick","disabled"]))]),_:1})]),_:1},8,["data"])]),_:1})]),_:1},8,["model","rules"])),[[T,t(m)]])]),_:1},8,["title","modelValue"])}}});export{ve as _};
