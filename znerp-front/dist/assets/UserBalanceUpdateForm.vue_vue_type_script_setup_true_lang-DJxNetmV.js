import{d as J,h as M,z as R,r as m,e as S,a3 as D,aA as y,aC as p,o as _,q as V,w as s,f as l,a as n,x as v,y as E,k as j,U as G,C as H,ak as K,al as L,cc as N,J as O,I as P,M as Q}from"./index-CIfmhqRC.js";import{_ as W}from"./Dialog.vue_vue_type_style_index_0_lang-CtaLqQeX.js";import{g as X}from"./index-B-I20sFy.js";import{g as Y,u as Z}from"./index-W27YgfZA.js";const $=J({name:"UpdateBalanceForm",__name:"UserBalanceUpdateForm",emits:["success"],setup(ee,{expose:B,emit:k}){const{t:w}=M(),f=R(),d=m(!1),c=m(!1),e=m({id:void 0,nickname:void 0,balance:"0",changeBalance:0,changeType:1}),U=S({changeBalance:[{required:!0,message:"\u53D8\u52A8\u4F59\u989D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),r=m();B({open:async o=>{if(d.value=!0,C(),o){c.value=!0;try{const a=await X(o),i=await Y({userId:a.id||0});e.value.id=a.id,e.value.nickname=a.nickname,e.value.balance=y(i.balance),e.value.changeType=1,e.value.changeBalance=0}finally{c.value=!1}}}});const x=k,T=async()=>{if(r&&await r.value.validate())if(e.value.changeBalance<=0)f.error("\u53D8\u52A8\u4F59\u989D\u4E0D\u80FD\u4E3A\u96F6");else if(p(b.value)<0)f.error("\u53D8\u52A8\u540E\u7684\u4F59\u989D\u4E0D\u80FD\u5C0F\u4E8E 0");else{c.value=!0;try{await Z({userId:e.value.id,balance:p(e.value.changeBalance)*e.value.changeType}),f.success(w("common.updateSuccess")),d.value=!1,x("success")}finally{c.value=!1}}},C=()=>{var o;e.value={id:void 0,nickname:void 0,balance:"0",changeBalance:0,changeType:1},(o=r.value)==null||o.resetFields()},b=D(()=>y(p(e.value.balance)+p(e.value.changeBalance)*e.value.changeType));return(o,a)=>{const i=G,t=H,g=K,F=L,I=N,q=O,h=P,z=W,A=Q;return _(),V(z,{modelValue:n(d),"onUpdate:modelValue":a[5]||(a[5]=u=>j(d)?d.value=u:null),title:"\u4FEE\u6539\u7528\u6237\u4F59\u989D",width:"600"},{footer:s(()=>[l(h,{disabled:n(c),type:"primary",onClick:T},{default:s(()=>[v("\u786E \u5B9A")]),_:1},8,["disabled"]),l(h,{onClick:a[4]||(a[4]=u=>d.value=!1)},{default:s(()=>[v("\u53D6 \u6D88")]),_:1})]),default:s(()=>[E((_(),V(q,{ref_key:"formRef",ref:r,model:n(e),rules:n(U),"label-width":"130px"},{default:s(()=>[l(t,{label:"\u7528\u6237\u7F16\u53F7",prop:"id"},{default:s(()=>[l(i,{modelValue:n(e).id,"onUpdate:modelValue":a[0]||(a[0]=u=>n(e).id=u),class:"!w-240px",disabled:""},null,8,["modelValue"])]),_:1}),l(t,{label:"\u7528\u6237\u6635\u79F0",prop:"nickname"},{default:s(()=>[l(i,{modelValue:n(e).nickname,"onUpdate:modelValue":a[1]||(a[1]=u=>n(e).nickname=u),class:"!w-240px",disabled:""},null,8,["modelValue"])]),_:1}),l(t,{label:"\u53D8\u52A8\u524D\u4F59\u989D(\u5143)",prop:"balance"},{default:s(()=>[l(i,{"model-value":n(e).balance,class:"!w-240px",disabled:""},null,8,["model-value"])]),_:1}),l(t,{label:"\u53D8\u52A8\u7C7B\u578B",prop:"changeType"},{default:s(()=>[l(F,{modelValue:n(e).changeType,"onUpdate:modelValue":a[2]||(a[2]=u=>n(e).changeType=u)},{default:s(()=>[l(g,{label:1},{default:s(()=>[v("\u589E\u52A0")]),_:1}),l(g,{label:-1},{default:s(()=>[v("\u51CF\u5C11")]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(t,{label:"\u53D8\u52A8\u4F59\u989D(\u5143)",prop:"changeBalance"},{default:s(()=>[l(I,{modelValue:n(e).changeBalance,"onUpdate:modelValue":a[3]||(a[3]=u=>n(e).changeBalance=u),min:0,precision:2,step:.1,class:"!w-240px"},null,8,["modelValue"])]),_:1}),l(t,{label:"\u53D8\u52A8\u540E\u4F59\u989D(\u5143)"},{default:s(()=>[l(i,{"model-value":n(b),class:"!w-240px",disabled:""},null,8,["model-value"])]),_:1})]),_:1},8,["model","rules"])),[[A,n(c)]])]),_:1},8,["modelValue"])}}});export{$ as _};
