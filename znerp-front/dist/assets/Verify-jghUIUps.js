import{ds as q,h as ee,c7 as te,aq as se,r as t,e as V,a3 as ne,ar as ve,n as re,o as T,c as C,a as e,at as w,g as s,y as ie,a4 as ae,f as he,w as de,W as G,t as L,a5 as R,Z as ge,aw as oe,dt as ce,du as ue,F as fe,p as ye,_ as me,bs as be,x as xe,q as Se,a_ as we}from"./index-CIfmhqRC.js";function Y(i,f="XwKsGlMcdPMEhR1B"){const l=q.enc.Utf8.parse(f),o=q.enc.Utf8.parse(i);return q.AES.encrypt(o,l,{mode:q.mode.ECB,padding:q.pad.Pkcs7}).toString()}function pe(i){let f,l,o,g;const r=window,c=i.$el.parentNode.offsetWidth||r.offsetWidth,y=i.$el.parentNode.offsetHeight||r.offsetHeight;return f=i.imgSize.width.indexOf("%")!=-1?parseInt(i.imgSize.width)/100*c+"px":i.imgSize.width,l=i.imgSize.height.indexOf("%")!=-1?parseInt(i.imgSize.height)/100*y+"px":i.imgSize.height,o=i.barSize.width.indexOf("%")!=-1?parseInt(i.barSize.width)/100*c+"px":i.barSize.width,g=i.barSize.height.indexOf("%")!=-1?parseInt(i.barSize.height)/100*y+"px":i.barSize.height,{imgWidth:f,imgHeight:l,barWidth:o,barHeight:g}}const ze={style:{position:"relative"}},ke=["src"],We=[s("i",{class:"iconfont icon-refresh"},null,-1)],Te=["textContent"],He=["textContent"],Ie=["src"],$e={__name:"VerifySlide",props:{captchaType:{type:String},type:{type:String,default:"1"},mode:{type:String,default:"fixed"},vSpace:{type:Number,default:5},explain:{type:String,default:""},imgSize:{type:Object,default:()=>({width:"310px",height:"155px"})},blockSize:{type:Object,default:()=>({width:"50px",height:"50px"})},barSize:{type:Object,default:()=>({width:"310px",height:"30px"})}},setup(i){const f=i,{t:l}=ee(),{mode:o,captchaType:g,type:r,blockSize:c,explain:y}=te(f),{proxy:p}=se();let u=t(""),z=t(""),_=t(""),P=t(""),H=t(""),m=t(""),j=t(""),b=t(""),k=t(""),E=t(""),v=V({imgHeight:0,imgWidth:0,barHeight:0,barWidth:0}),N=t(void 0),I=t(void 0),$=t(void 0),B=t("#ddd"),O=t(void 0),D=t("icon-right"),J=t(!1),d=t(!1),n=t(!0),x=t(""),S=t(""),X=t(0);const M=ne(()=>p.$el.querySelector(".verify-bar-area")),A=()=>{y.value===""?k.value=l("captcha.slide"):k.value=y.value,le(),oe(()=>{let{imgHeight:a,imgWidth:h,barHeight:W,barWidth:Q}=pe(p);v.imgHeight=a,v.imgWidth=h,v.barHeight=W,v.barWidth=Q,p.$parent.$emit("ready",p)}),window.removeEventListener("touchmove",function(a){K(a)}),window.removeEventListener("mousemove",function(a){K(a)}),window.removeEventListener("touchend",function(){U()}),window.removeEventListener("mouseup",function(){U()}),window.addEventListener("touchmove",function(a){K(a)}),window.addEventListener("mousemove",function(a){K(a)}),window.addEventListener("touchend",function(){U()}),window.addEventListener("mouseup",function(){U()})};ve(r,()=>{A()}),re(()=>{A(),p.$el.onselectstart=function(){return!1}});const F=a=>{if((a=a||window.event).touches)h=a.touches[0].pageX;else var h=a.clientX;X.value=Math.floor(h-M.value.getBoundingClientRect().left),m.value=+new Date,d.value==0&&(k.value="",$.value="#337ab7",B.value="#337AB7",O.value="#fff",a.stopPropagation(),J.value=!0)},K=a=>{if(a=a||window.event,J.value&&d.value==0){if(a.touches)h=a.touches[0].pageX;else var h=a.clientX;var W=h-M.value.getBoundingClientRect().left;W>=M.value.offsetWidth-parseInt(parseInt(c.value.width)/2)-2&&(W=M.value.offsetWidth-parseInt(parseInt(c.value.width)/2)-2),W<=0&&(W=parseInt(parseInt(c.value.width)/2)),N.value=W-X.value+"px",I.value=W-X.value+"px"}},U=()=>{if(j.value=+new Date,J.value&&d.value==0){var a=parseInt((N.value||"0").replace("px",""));a=310*a/parseInt(v.imgWidth);let h={captchaType:g.value,pointJson:u.value?Y(JSON.stringify({x:a,y:5}),u.value):JSON.stringify({x:a,y:5}),token:H.value};ce(h).then(W=>{if(W.repCode=="0000"){$.value="#5cb85c",B.value="#5cb85c",O.value="#fff",D.value="icon-check",n.value=!1,d.value=!0,o.value=="pop"&&setTimeout(()=>{p.$parent.clickShow=!1,Z()},1500),z.value=!0,b.value=`${((j.value-m.value)/1e3).toFixed(2)}s
            ${l("captcha.success")}`;var Q=u.value?Y(H.value+"---"+JSON.stringify({x:a,y:5}),u.value):H.value+"---"+JSON.stringify({x:a,y:5});setTimeout(()=>{b.value="",p.$parent.closeBox(),p.$parent.$emit("success",{captchaVerification:Q})},1e3)}else $.value="#d9534f",B.value="#d9534f",O.value="#fff",D.value="icon-close",z.value=!1,setTimeout(function(){Z()},1e3),p.$parent.$emit("error",p),b.value=l("captcha.fail"),setTimeout(()=>{b.value=""},1e3)}),J.value=!1}},Z=async()=>{n.value=!0,E.value="",x.value="left .3s",N.value=0,I.value=void 0,S.value="width .3s",B.value="#ddd",$.value="#fff",O.value="#000",D.value="icon-right",d.value=!1,await le(),setTimeout(()=>{S.value="",x.value="",k.value=y.value},300)},le=async()=>{let a={captchaType:g.value};const h=await ue(a);h.repCode=="0000"?(_.value=h.repData.originalImageBase64,P.value=h.repData.jigsawImageBase64,H.value=h.repData.token,u.value=h.repData.secretKey):b.value=h.repMsg};return(a,h)=>(T(),C("div",ze,[e(r)==="2"?(T(),C("div",{key:0,style:w({height:parseInt(e(v).imgHeight)+i.vSpace+"px"}),class:"verify-img-out"},[s("div",{style:w({width:e(v).imgWidth,height:e(v).imgHeight}),class:"verify-img-panel"},[s("img",{src:"data:image/png;base64,"+e(_),alt:"",style:{display:"block",width:"100%",height:"100%"}},null,8,ke),ie(s("div",{class:"verify-refresh",onClick:Z},We,512),[[ae,e(n)]]),he(ge,{name:"tips"},{default:de(()=>[e(b)?(T(),C("span",{key:0,class:G([e(z)?"suc-bg":"err-bg","verify-tips"])},L(e(b)),3)):R("",!0)]),_:1})],4)],4)):R("",!0),s("div",{style:w({width:e(v).imgWidth,height:i.barSize.height,"line-height":i.barSize.height}),class:"verify-bar-area"},[s("span",{class:"verify-msg",textContent:L(e(k))},null,8,Te),s("div",{style:w({width:e(I)!==void 0?e(I):i.barSize.height,height:i.barSize.height,"border-color":e(B),transaction:e(S)}),class:"verify-left-bar"},[s("span",{class:"verify-msg",textContent:L(e(E))},null,8,He),s("div",{style:w({width:i.barSize.height,height:i.barSize.height,"background-color":e($),left:e(N),transition:e(x)}),class:"verify-move-block",onMousedown:F,onTouchstart:F},[s("i",{class:G(["verify-icon iconfont",e(D)]),style:w({color:e(O)})},null,6),e(r)==="2"?(T(),C("div",{key:0,style:w({width:Math.floor(47*parseInt(e(v).imgWidth)/310)+"px",height:e(v).imgHeight,top:"-"+(parseInt(e(v).imgHeight)+i.vSpace)+"px","background-size":e(v).imgWidth+" "+e(v).imgHeight}),class:"verify-sub-block"},[s("img",{src:"data:image/png;base64,"+e(P),alt:"",style:{display:"block",width:"100%",height:"100%","-webkit-user-drag":"none"}},null,8,Ie)],4)):R("",!0)],36)],4)],4)]))}},Oe={style:{position:"relative"}},Ce={class:"verify-img-out"},Ne=[s("i",{class:"iconfont icon-refresh"},null,-1)],Be=["src"],je={class:"verify-msg"},Ee={name:"Vue3Verify",components:{VerifySlide:$e,VerifyPoints:{__name:"VerifyPoints",props:{mode:{type:String,default:"fixed"},captchaType:{type:String},vSpace:{type:Number,default:5},imgSize:{type:Object,default:()=>({width:"310px",height:"155px"})},barSize:{type:Object,default:()=>({width:"310px",height:"40px"})}},setup(i){const f=i,{t:l}=ee(),{mode:o,captchaType:g}=te(f),{proxy:r}=se();let c=t(""),y=t(3),p=V([]),u=V([]),z=t(1),_=t(""),P=V([]),H=t(""),m=V({imgHeight:0,imgWidth:0,barHeight:0,barWidth:0}),j=V([]),b=t(""),k=t(void 0),E=t(void 0),v=t(!0),N=t(!0);re(()=>{p.splice(0,p.length),u.splice(0,u.length),z.value=1,D(),oe(()=>{let{imgHeight:d,imgWidth:n,barHeight:x,barWidth:S}=pe(r);m.imgHeight=d,m.imgWidth=n,m.barHeight=x,m.barWidth=S,r.$parent.$emit("ready",r)}),r.$el.onselectstart=function(){return!1}});const I=t(null),$=function(d,n){return{x:n.offsetX,y:n.offsetY}},B=function(d){return j.push(Object.assign({},d)),z.value+1},O=async function(){j.splice(0,j.length),k.value="#000",E.value="#ddd",N.value=!0,p.splice(0,p.length),u.splice(0,u.length),z.value=1,await D(),v.value=!0},D=async()=>{let d={captchaType:g.value};const n=await ue(d);n.repCode=="0000"?(_.value=n.repData.originalImageBase64,H.value=n.repData.token,c.value=n.repData.secretKey,P.value=n.repData.wordList,b.value=l("captcha.point")+"\u3010"+P.value.join(",")+"\u3011"):b.value=n.repMsg},J=function(d,n){return d.map(x=>({x:Math.round(310*x.x/parseInt(n.imgWidth)),y:Math.round(155*x.y/parseInt(n.imgHeight))}))};return(d,n)=>(T(),C("div",Oe,[s("div",Ce,[s("div",{style:w({width:e(m).imgWidth,height:e(m).imgHeight,"background-size":e(m).imgWidth+" "+e(m).imgHeight,"margin-bottom":i.vSpace+"px"}),class:"verify-img-panel"},[ie(s("div",{class:"verify-refresh",style:{"z-index":"3"},onClick:O},Ne,512),[[ae,e(v)]]),s("img",{ref_key:"canvas",ref:I,src:"data:image/png;base64,"+e(_),alt:"",style:{display:"block",width:"100%",height:"100%"},onClick:n[0]||(n[0]=x=>e(N)?(S=>{if(u.push($(I,S)),z.value==y.value){z.value=B($(I,S));let X=J(u,m);u.length=0,u.push(...X),setTimeout(()=>{var M=c.value?Y(H.value+"---"+JSON.stringify(u),c.value):H.value+"---"+JSON.stringify(u);let A={captchaType:g.value,pointJson:c.value?Y(JSON.stringify(u),c.value):JSON.stringify(u),token:H.value};ce(A).then(F=>{F.repCode=="0000"?(k.value="#4cae4c",E.value="#5cb85c",b.value=l("captcha.success"),N.value=!1,o.value=="pop"&&setTimeout(()=>{r.$parent.clickShow=!1,O()},1500),r.$parent.$emit("success",{captchaVerification:M})):(r.$parent.$emit("error",r),k.value="#d9534f",E.value="#d9534f",b.value=l("captcha.fail"),setTimeout(()=>{O()},700))})},400)}z.value<y.value&&(z.value=B($(I,S)))})(x):void 0)},null,8,Be),(T(!0),C(fe,null,ye(e(j),(x,S)=>(T(),C("div",{key:S,style:w({"background-color":"#1abd6c",color:"#fff","z-index":9999,width:"20px",height:"20px","text-align":"center","line-height":"20px","border-radius":"50%",position:"absolute",top:parseInt(x.y-10)+"px",left:parseInt(x.x-10)+"px"}),class:"point-area"},L(S+1),5))),128))],4)]),s("div",{style:w({width:e(m).imgWidth,color:e(k),"border-color":e(E),"line-height":i.barSize.height}),class:"verify-bar-area"},[s("span",je,L(e(b)),1)],4)]))}}},props:{captchaType:{type:String,required:!0},figure:{type:Number},arith:{type:Number},mode:{type:String,default:"pop"},vSpace:{type:Number},explain:{type:String},imgSize:{type:Object,default:()=>({width:"310px",height:"155px"})},blockSize:{type:Object},barSize:{type:Object}},setup(i){const{t:f}=ee(),{captchaType:l,mode:o}=te(i),g=t(!1),r=t(void 0),c=t(void 0),y=t({}),p=ne(()=>o.value!="pop"||g.value);return be(()=>{switch(l.value){case"blockPuzzle":r.value="2",c.value="VerifySlide";break;case"clickWord":r.value="",c.value="VerifyPoints"}}),{t:f,clickShow:g,verifyType:r,componentType:c,instance:y,showBox:p,closeBox:()=>{g.value=!1,y.value.refresh&&y.value.refresh()},show:()=>{o.value=="pop"&&(g.value=!0)}}}},De={key:0,class:"verifybox-top"},Je=[s("i",{class:"iconfont icon-close"},null,-1)],Me=me(Ee,[["render",function(i,f,l,o,g,r){return ie((T(),C("div",{class:G(l.mode=="pop"?"mask":"")},[s("div",{class:G(l.mode=="pop"?"verifybox":""),style:w({"max-width":parseInt(l.imgSize.width)+20+"px"})},[l.mode=="pop"?(T(),C("div",De,[xe(L(o.t("captcha.verification"))+" ",1),s("span",{class:"verifybox-close",onClick:f[0]||(f[0]=(...c)=>o.closeBox&&o.closeBox(...c))},Je)])):R("",!0),s("div",{style:w({padding:l.mode=="pop"?"10px":"0"}),class:"verifybox-bottom"},[o.componentType?(T(),Se(we(o.componentType),{key:0,ref:"instance",arith:l.arith,barSize:l.barSize,blockSize:l.blockSize,captchaType:l.captchaType,explain:l.explain,figure:l.figure,imgSize:l.imgSize,mode:l.mode,type:o.verifyType,vSpace:l.vSpace},null,8,["arith","barSize","blockSize","captchaType","explain","figure","imgSize","mode","type","vSpace"])):R("",!0)],4)],6)],2)),[[ae,o.showBox]])}]]);export{Me as _};
