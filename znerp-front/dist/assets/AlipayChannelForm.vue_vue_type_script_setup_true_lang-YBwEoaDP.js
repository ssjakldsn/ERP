import{d as O,h as M,z as J,r as y,o as s,c as b,f as e,w as t,a as o,x as p,y as B,q as K,F as L,p as j,cL as H,D as $,t as G,a5 as x,k as Q,U as W,C as X,ak as Y,al as Z,H as ee,I as ae,br as le,J as te,M as oe}from"./index-CIfmhqRC.js";import{_ as re}from"./Dialog.vue_vue_type_style_index_0_lang-CtaLqQeX.js";import{C as ie}from"./constants-A8BI3pz7.js";import{g as ne,c as de,u as pe}from"./index-BY9mST-C.js";const ue={key:0},se={key:1},ce={key:2},C=".crt",fe=O({name:"AlipayChannelForm",__name:"AlipayChannelForm",emits:["success"],setup(me,{expose:k,emit:A}){const{t:R}=M(),v=J(),c=y(!1),U=y(""),f=y(!1),l=y({appId:"",code:"",status:void 0,feeRate:void 0,remark:"",config:{appId:"",serverUrl:null,signType:"",mode:null,privateKey:"",alipayPublicKey:"",appCertContent:"",alipayPublicCertContent:"",rootCertContent:"",encryptType:"",encryptKey:""}}),P={feeRate:[{required:!0,message:"\u8BF7\u8F93\u5165\u6E20\u9053\u8D39\u7387",trigger:"blur"}],status:[{required:!0,message:"\u6E20\u9053\u72B6\u6001\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],"config.appId":[{required:!0,message:"\u8BF7\u8F93\u5165\u5F00\u653E\u5E73\u53F0\u4E0A\u521B\u5EFA\u7684\u5E94\u7528\u7684 ID",trigger:"blur"}],"config.serverUrl":[{required:!0,message:"\u8BF7\u4F20\u5165\u7F51\u5173\u5730\u5740",trigger:"blur"}],"config.signType":[{required:!0,message:"\u8BF7\u4F20\u5165\u7B7E\u540D\u7B97\u6CD5\u7C7B\u578B",trigger:"blur"}],"config.mode":[{required:!0,message:"\u516C\u94A5\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],"config.privateKey":[{required:!0,message:"\u8BF7\u8F93\u5165\u5546\u6237\u79C1\u94A5",trigger:"blur"}],"config.alipayPublicKey":[{required:!0,message:"\u8BF7\u8F93\u5165\u652F\u4ED8\u5B9D\u516C\u94A5\u5B57\u7B26\u4E32",trigger:"blur"}],"config.appCertContent":[{required:!0,message:"\u8BF7\u4E0A\u4F20\u5546\u6237\u516C\u94A5\u5E94\u7528\u8BC1\u4E66",trigger:"blur"}],"config.alipayPublicCertContent":[{required:!0,message:"\u8BF7\u4E0A\u4F20\u652F\u4ED8\u5B9D\u516C\u94A5\u8BC1\u4E66",trigger:"blur"}],"config.rootCertContent":[{required:!0,message:"\u8BF7\u4E0A\u4F20\u6307\u5B9A\u6839\u8BC1\u4E66",trigger:"blur"}],"config.encryptKey":[{required:!0,message:"\u8BF7\u8F93\u5165\u63A5\u53E3\u5185\u5BB9\u52A0\u5BC6\u5BC6\u94A5",trigger:"blur"}]},w=y();k({open:async(n,a)=>{c.value=!0,f.value=!0,I(n,a);try{const i=await ne(n,a);i&&i.id&&(l.value=i,l.value.config=JSON.parse(i.config)),U.value=l.value.id?"\u7F16\u8F91\u652F\u4ED8\u6E20\u9053":"\u521B\u5EFA\u652F\u4ED8\u6E20\u9053"}finally{f.value=!1}}});const T=A,q=async()=>{if(w&&await w.value.validate()){f.value=!0;try{const n={...l.value};n.config=JSON.stringify(l.value.config),n.id?(await pe(n),v.success(R("common.updateSuccess"))):(await de(n),v.success(R("common.createSuccess"))),c.value=!1,T("success")}finally{f.value=!1}}},I=(n,a)=>{var i;l.value={appId:n,code:a,status:ie.ENABLE,remark:"",feeRate:null,config:{appId:"",serverUrl:null,signType:"RSA2",mode:null,privateKey:"",alipayPublicKey:"",appCertContent:"",alipayPublicCertContent:"",rootCertContent:"",encryptType:"",encryptKey:""}},(i=w.value)==null||i.resetFields()},V=n=>{if("."+n.name.split(".")[1]!==C)return v.error(`\u8BF7\u4E0A\u4F20\u6307\u5B9A\u683C\u5F0F"${C}"\u6587\u4EF6`),!1;let a=n.size/1024/1024<2;return a||v.error("\u6587\u4EF6\u5927\u5C0F\u8D85\u8FC7 2MB"),a},S=n=>{const a=new FileReader;a.onload=i=>{l.value.config.appCertContent=i.target.result},a.readAsText(n.file)},F=n=>{const a=new FileReader;a.onload=i=>{l.value.config.alipayPublicCertContent=i.target.result},a.readAsText(n.file)},z=n=>{const a=new FileReader;a.onload=i=>{l.value.config.rootCertContent=i.target.result},a.readAsText(n.file)};return(n,a)=>{const i=W,d=X,u=Y,m=Z,_=ee,g=ae,h=le,E=te,N=re,D=oe;return s(),b("div",null,[e(N,{modelValue:o(c),"onUpdate:modelValue":a[16]||(a[16]=r=>Q(c)?c.value=r:null),title:o(U),width:"830px",onClosed:n.close},{footer:t(()=>[e(g,{disabled:o(f),type:"primary",onClick:q},{default:t(()=>[p("\u786E \u5B9A")]),_:1},8,["disabled"]),e(g,{onClick:a[15]||(a[15]=r=>c.value=!1)},{default:t(()=>[p("\u53D6 \u6D88")]),_:1})]),default:t(()=>[B((s(),K(E,{ref_key:"formRef",ref:w,model:o(l),rules:P,"label-width":"100px"},{default:t(()=>[e(d,{label:"\u6E20\u9053\u8D39\u7387","label-width":"180px",prop:"feeRate"},{default:t(()=>[e(i,{modelValue:o(l).feeRate,"onUpdate:modelValue":a[0]||(a[0]=r=>o(l).feeRate=r),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u6E20\u9053\u8D39\u7387"},{append:t(()=>[p("%")]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"\u5F00\u653E\u5E73\u53F0 APPID","label-width":"180px",prop:"config.appId"},{default:t(()=>[e(i,{modelValue:o(l).config.appId,"onUpdate:modelValue":a[1]||(a[1]=r=>o(l).config.appId=r),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u5F00\u653E\u5E73\u53F0 APPID"},null,8,["modelValue"])]),_:1}),e(d,{label:"\u6E20\u9053\u72B6\u6001","label-width":"180px",prop:"status"},{default:t(()=>[e(m,{modelValue:o(l).status,"onUpdate:modelValue":a[2]||(a[2]=r=>o(l).status=r)},{default:t(()=>[(s(!0),b(L,null,j(o(H)(o($).COMMON_STATUS),r=>(s(),K(u,{key:parseInt(r.value),value:parseInt(r.value)},{default:t(()=>[p(G(r.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"\u7F51\u5173\u5730\u5740","label-width":"180px",prop:"config.serverUrl"},{default:t(()=>[e(m,{modelValue:o(l).config.serverUrl,"onUpdate:modelValue":a[3]||(a[3]=r=>o(l).config.serverUrl=r)},{default:t(()=>[e(u,{value:"https://openapi.alipay.com/gateway.do"},{default:t(()=>[p("\u7EBF\u4E0A\u73AF\u5883")]),_:1}),e(u,{value:"https://openapi-sandbox.dl.alipaydev.com/gateway.do"},{default:t(()=>[p(" \u6C99\u7BB1\u73AF\u5883 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"\u7B97\u6CD5\u7C7B\u578B","label-width":"180px",prop:"config.signType"},{default:t(()=>[e(m,{modelValue:o(l).config.signType,"onUpdate:modelValue":a[4]||(a[4]=r=>o(l).config.signType=r)},{default:t(()=>[e(u,{key:"RSA2",value:"RSA2"},{default:t(()=>[p("RSA2")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"\u516C\u94A5\u7C7B\u578B","label-width":"180px",prop:"config.mode"},{default:t(()=>[e(m,{modelValue:o(l).config.mode,"onUpdate:modelValue":a[5]||(a[5]=r=>o(l).config.mode=r)},{default:t(()=>[e(u,{key:"\u516C\u94A5\u6A21\u5F0F",value:1},{default:t(()=>[p("\u516C\u94A5\u6A21\u5F0F")]),_:1}),e(u,{key:"\u8BC1\u4E66\u6A21\u5F0F",value:2},{default:t(()=>[p("\u8BC1\u4E66\u6A21\u5F0F")]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(l).config.mode===1?(s(),b("div",ue,[e(d,{label:"\u5E94\u7528\u79C1\u94A5","label-width":"180px",prop:"config.privateKey"},{default:t(()=>[e(i,{modelValue:o(l).config.privateKey,"onUpdate:modelValue":a[6]||(a[6]=r=>o(l).config.privateKey=r),autosize:{minRows:8,maxRows:8},style:{width:"100%"},clearable:"",placeholder:"\u8BF7\u8F93\u5165\u5E94\u7528\u79C1\u94A5",type:"textarea"},null,8,["modelValue"])]),_:1}),e(d,{label:"\u652F\u4ED8\u5B9D\u516C\u94A5","label-width":"180px",prop:"config.alipayPublicKey"},{default:t(()=>[e(i,{modelValue:o(l).config.alipayPublicKey,"onUpdate:modelValue":a[7]||(a[7]=r=>o(l).config.alipayPublicKey=r),autosize:{minRows:8,maxRows:8},style:{width:"100%"},clearable:"",placeholder:"\u8BF7\u8F93\u5165\u652F\u4ED8\u5B9D\u516C\u94A5",type:"textarea"},null,8,["modelValue"])]),_:1})])):x("",!0),o(l).config.mode===2?(s(),b("div",se,[e(d,{label:"\u5E94\u7528\u79C1\u94A5","label-width":"180px",prop:"config.privateKey"},{default:t(()=>[e(i,{modelValue:o(l).config.privateKey,"onUpdate:modelValue":a[8]||(a[8]=r=>o(l).config.privateKey=r),autosize:{minRows:8,maxRows:8},style:{width:"100%"},clearable:"",placeholder:"\u8BF7\u8F93\u5165\u5E94\u7528\u79C1\u94A5",type:"textarea"},null,8,["modelValue"])]),_:1}),e(d,{label:"\u5546\u6237\u516C\u94A5\u5E94\u7528\u8BC1\u4E66","label-width":"180px",prop:"config.appCertContent"},{default:t(()=>[e(i,{modelValue:o(l).config.appCertContent,"onUpdate:modelValue":a[9]||(a[9]=r=>o(l).config.appCertContent=r),autosize:{minRows:8,maxRows:8},style:{width:"100%"},placeholder:"\u8BF7\u4E0A\u4F20\u5546\u6237\u516C\u94A5\u5E94\u7528\u8BC1\u4E66",readonly:"",type:"textarea"},null,8,["modelValue"])]),_:1}),e(d,{label:"","label-width":"180px"},{default:t(()=>[e(h,{ref:"privateKeyContentFile",accept:C,"before-upload":V,"http-request":S,limit:1,action:""},{default:t(()=>[e(g,{type:"primary"},{default:t(()=>[e(_,{class:"mr-5px",icon:"ep:upload"}),p(" \u70B9\u51FB\u4E0A\u4F20 ")]),_:1})]),_:1},512)]),_:1}),e(d,{label:"\u652F\u4ED8\u5B9D\u516C\u94A5\u8BC1\u4E66","label-width":"180px",prop:"config.alipayPublicCertContent"},{default:t(()=>[e(i,{modelValue:o(l).config.alipayPublicCertContent,"onUpdate:modelValue":a[10]||(a[10]=r=>o(l).config.alipayPublicCertContent=r),autosize:{minRows:8,maxRows:8},style:{width:"100%"},placeholder:"\u8BF7\u4E0A\u4F20\u652F\u4ED8\u5B9D\u516C\u94A5\u8BC1\u4E66",readonly:"",type:"textarea"},null,8,["modelValue"])]),_:1}),e(d,{label:"","label-width":"180px"},{default:t(()=>[e(h,{ref:"privateCertContentFile",accept:C,"before-upload":V,"http-request":F,limit:1,action:""},{default:t(()=>[e(g,{type:"primary"},{default:t(()=>[e(_,{class:"mr-5px",icon:"ep:upload"}),p(" \u70B9\u51FB\u4E0A\u4F20 ")]),_:1})]),_:1},512)]),_:1}),e(d,{label:"\u6839\u8BC1\u4E66","label-width":"180px",prop:"config.rootCertContent"},{default:t(()=>[e(i,{modelValue:o(l).config.rootCertContent,"onUpdate:modelValue":a[11]||(a[11]=r=>o(l).config.rootCertContent=r),autosize:{minRows:8,maxRows:8},style:{width:"100%"},placeholder:"\u8BF7\u4E0A\u4F20\u6839\u8BC1\u4E66",readonly:"",type:"textarea"},null,8,["modelValue"])]),_:1}),e(d,{label:"","label-width":"180px"},{default:t(()=>[e(h,{ref:"privateCertContentFile",accept:C,"before-upload":V,"http-request":z,limit:1,action:""},{default:t(()=>[e(g,{type:"primary"},{default:t(()=>[e(_,{class:"mr-5px",icon:"ep:upload"}),p(" \u70B9\u51FB\u4E0A\u4F20 ")]),_:1})]),_:1},512)]),_:1})])):x("",!0),e(d,{label:"\u63A5\u53E3\u5185\u5BB9\u52A0\u5BC6\u65B9\u5F0F","label-width":"180px",prop:"config.encryptType"},{default:t(()=>[e(m,{modelValue:o(l).config.encryptType,"onUpdate:modelValue":a[12]||(a[12]=r=>o(l).config.encryptType=r)},{default:t(()=>[e(u,{key:"NONE",label:""},{default:t(()=>[p("\u65E0\u52A0\u5BC6")]),_:1}),e(u,{key:"AES",label:"AES"},{default:t(()=>[p("AES")]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(l).config.encryptType==="AES"?(s(),b("div",ce,[e(d,{label:"\u63A5\u53E3\u5185\u5BB9\u52A0\u5BC6\u5BC6\u94A5","label-width":"180px",prop:"config.encryptKey"},{default:t(()=>[e(i,{modelValue:o(l).config.encryptKey,"onUpdate:modelValue":a[13]||(a[13]=r=>o(l).config.encryptKey=r),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u63A5\u53E3\u5185\u5BB9\u52A0\u5BC6\u5BC6\u94A5"},null,8,["modelValue"])]),_:1})])):x("",!0),e(d,{label:"\u5907\u6CE8","label-width":"180px",prop:"remark"},{default:t(()=>[e(i,{modelValue:o(l).remark,"onUpdate:modelValue":a[14]||(a[14]=r=>o(l).remark=r),style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[D,o(f)]])]),_:1},8,["modelValue","title","onClosed"])])}}});export{fe as _};
