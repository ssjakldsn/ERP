import{d as H,r as f,e as K,u as W,ar as Y,o as s,c as g,f as a,w as l,x as y,y as A,a as e,q as c,D as G,F as z,p as R,t as U,a5 as S,z as J,h as Q,H as V,I as X,j as Z,K as aa,af as ea,L as ta,M as la}from"./index-CIfmhqRC.js";import{_ as ia}from"./ContentWrap.vue_vue_type_script_setup_true_lang-sm5dIhPQ.js";import{_ as ra}from"./index.vue_vue_type_script_setup_true_lang-DYHi04Tm.js";import{_ as oa}from"./DictTag.vue_vue_type_script_lang-CTpVFm77.js";import{d as h}from"./formatTime-DFFN_xWx.js";import{_ as sa,F}from"./FollowUpRecordForm.vue_vue_type_script_setup_true_lang-CX5nVT22.js";import{B as M}from"./index-8CYEcIk3.js";const na=H({name:"FollowUpRecord",__name:"index",props:{bizType:{},bizId:{}},setup(D){const p=D,w=J(),{t:N}=Q(),b=f(!0),C=f([]),k=f(0),n=K({pageNo:1,pageSize:10,bizType:0,bizId:0}),m=async()=>{b.value=!0;try{const i=await F.getFollowUpRecordPage(n);C.value=i.list,k.value=i.total}finally{b.value=!1}},v=f(),O=()=>{var i;(i=v.value)==null||i.open(p.bizType,p.bizId)},{push:T}=W();return Y(()=>p.bizId,()=>{n.bizType=p.bizType,n.bizId=p.bizId,m()}),(i,u)=>{const P=V,x=X,E=Z,r=aa,L=oa,I=ea,j=ta,B=ra,$=ia,q=la;return s(),g(z,null,[a(E,{class:"mb-10px",justify:"end"},{default:l(()=>[a(x,{onClick:O},{default:l(()=>[a(P,{class:"mr-5px",icon:"ep:edit"}),y(" \u5199\u8DDF\u8FDB ")]),_:1})]),_:1}),a($,null,{default:l(()=>[A((s(),c(j,{data:e(C),"show-overflow-tooltip":!0,stripe:!0},{default:l(()=>[a(r,{formatter:e(h),align:"center",label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime",width:"180px"},null,8,["formatter"]),a(r,{align:"center",label:"\u8DDF\u8FDB\u4EBA",prop:"creatorName"}),a(r,{align:"center",label:"\u8DDF\u8FDB\u7C7B\u578B",prop:"type"},{default:l(t=>[a(L,{type:e(G).CRM_FOLLOW_UP_TYPE,value:t.row.type},null,8,["type","value"])]),_:1}),a(r,{align:"center",label:"\u8DDF\u8FDB\u5185\u5BB9",prop:"content"}),a(r,{formatter:e(h),align:"center",label:"\u4E0B\u6B21\u8054\u7CFB\u65F6\u95F4",prop:"nextTime",width:"180px"},null,8,["formatter"]),i.bizType===e(M).CRM_CUSTOMER?(s(),c(r,{key:0,align:"center",label:"\u5173\u8054\u8054\u7CFB\u4EBA",prop:"contactIds"},{default:l(t=>[(s(!0),g(z,null,R(t.row.contacts,o=>(s(),c(I,{key:`key-${o.id}`,underline:!1,type:"primary",onClick:_=>{return d=o.id,void T({name:"CrmContactDetail",params:{id:d}});var d},class:"ml-5px"},{default:l(()=>[y(U(o.name),1)]),_:2},1032,["onClick"]))),128))]),_:1})):S("",!0),i.bizType===e(M).CRM_CUSTOMER?(s(),c(r,{key:1,align:"center",label:"\u5173\u8054\u5546\u673A",prop:"businessIds"},{default:l(t=>[(s(!0),g(z,null,R(t.row.businesses,o=>(s(),c(I,{key:`key-${o.id}`,underline:!1,type:"primary",onClick:_=>{return d=o.id,void T({name:"CrmBusinessDetail",params:{id:d}});var d},class:"ml-5px"},{default:l(()=>[y(U(o.name),1)]),_:2},1032,["onClick"]))),128))]),_:1})):S("",!0),a(r,{align:"center",label:"\u64CD\u4F5C"},{default:l(t=>[a(x,{link:"",type:"danger",onClick:o=>(async _=>{try{await w.delConfirm(),await F.deleteFollowUpRecord(_),w.success(N("common.delSuccess")),await m()}catch{}})(t.row.id)},{default:l(()=>[y(" \u5220\u9664 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[q,e(b)]]),a(B,{limit:e(n).pageSize,"onUpdate:limit":u[0]||(u[0]=t=>e(n).pageSize=t),page:e(n).pageNo,"onUpdate:page":u[1]||(u[1]=t=>e(n).pageNo=t),total:e(k),onPagination:m},null,8,["limit","page","total"])]),_:1}),a(sa,{ref_key:"formRef",ref:v,onSuccess:m},null,512)],64)}}});export{na as _};
