import{d as ee,ai as P,z as ae,r,n as le,o as S,q as _,w as i,f as a,x as f,a as l,P as te,y as oe,L as ie,a5 as K,t as re,aA as ne,k as pe,aH as se,U as ue,E as de,G as me,H as ce,I as fe,j as ve,K as ge,M as we}from"./index-CIfmhqRC.js";import{_ as ye}from"./Dialog.vue_vue_type_style_index_0_lang-CtaLqQeX.js";import{_ as he}from"./ContentWrap.vue_vue_type_script_setup_true_lang-sm5dIhPQ.js";import{_ as ke}from"./index.vue_vue_type_script_setup_true_lang-DYHi04Tm.js";import{E as Se}from"./el-image-DLpquQe6.js";import{E as _e}from"./el-tree-select-CYFGeiEt.js";import{g as be}from"./index-BRD6A8QB.js";import{d as xe}from"./formatTime-DFFN_xWx.js";import{h as Ve,d as Ce}from"./tree-BMqZf9_I.js";import{g as Te}from"./category-CKOb63Br.js";import{g as Ue,d as Ie}from"./spu-BTu6kAbO.js";import{_ as ze}from"./SkuList.vue_vue_type_script_setup_true_lang-DYztw255.js";const De=ee({name:"PromotionSpuSelect",__name:"SpuSelect",props:{isSelectSku:P.bool.def(!1),radio:P.bool.def(!1)},emits:["confirm"],setup(T,{expose:M,emit:q}){const b=T,v=ae(),U=r(0),I=r([]),x=r(!1),c=r(!1),z=r(""),p=r({pageNo:1,pageSize:10,tabType:0,name:"",categoryId:null,createTime:[]}),V=r([]),C=r(),D=r(),g=r(),w=r(!1),y=r(),s=r(0),m=r([]),j=t=>{var u;const e=(u=D.value)==null?void 0:u.getSkuTableRef();if(s.value===0)return v.warning("\u8BF7\u5148\u9009\u62E9\u5546\u54C1\u518D\u9009\u62E9\u76F8\u5E94\u7684\u89C4\u683C\uFF01\uFF01\uFF01"),void(e==null?void 0:e.clearSelection());if(t.length!==0)if(b.radio){if(m.value=[t.map(n=>n.id)[0]],t.length>1)return e==null||e.clearSelection(),void(e==null?void 0:e.toggleRowSelection(t.pop(),!0))}else m.value=t.map(n=>n.id);else m.value=[]},A=t=>{var e,u;if(t.length!==0){if(s.value=t.map(n=>n.id)[0],m.value.length>0&&(m.value=[]),t.length>1)return(e=C.value)==null||e.clearSelection(),void((u=C.value)==null?void 0:u.toggleRowSelection(t.pop(),!0));R(t[0],t)}else s.value=0},R=async(t,e)=>{var n;if(s.value!==0){if(t.id!==s.value)return v.warning("\u4F60\u5DF2\u9009\u62E9\u5546\u54C1\u8BF7\u5148\u53D6\u6D88"),void(y.value=[s.value]);if(w.value&&((n=g.value)==null?void 0:n.id)===t.id)return}if(g.value={},V.value=[],w.value=!1,(e==null?void 0:e.length)===0)return void(y.value=[]);const u=await Ue(t.id);V.value=be(u),g.value=u,w.value=!0,y.value=[t.id]},H=q,B=()=>{s.value!==0?b.isSelectSku&&m.value.length===0?v.warning("\u6CA1\u6709\u9009\u62E9\u4EFB\u4F55\u5546\u54C1\u5C5E\u6027"):(b.isSelectSku?H("confirm",s.value,m.value):H("confirm",s.value),c.value=!1,s.value=0,m.value=[]):v.warning("\u6CA1\u6709\u9009\u62E9\u4EFB\u4F55\u5546\u54C1")};M({open:()=>{z.value="\u5546\u54C1\u9009\u62E9",c.value=!0}});const h=async()=>{x.value=!0;try{const t=await Ie(p.value);I.value=t.list,U.value=t.total}finally{x.value=!1}},N=()=>{h()},G=()=>{p.value={pageNo:1,pageSize:10,tabType:0,name:"",categoryId:null,createTime:[]},h()},Y=r();return le(async()=>{await h();const t=await Te({});Y.value=Ve(t,"id","parentId")}),(t,e)=>{const u=ue,n=de,F=_e,J=me,E=ce,k=fe,O=ve,d=ge,Q=Se,W=ke,X=he,Z=ye,$=we;return S(),_(Z,{modelValue:l(c),"onUpdate:modelValue":e[6]||(e[6]=o=>pe(c)?c.value=o:null),appendToBody:!0,title:l(z),width:"70%"},{footer:i(()=>[a(k,{type:"primary",onClick:B},{default:i(()=>[f("\u786E \u5B9A")]),_:1}),a(k,{onClick:e[5]||(e[5]=o=>c.value=!1)},{default:i(()=>[f("\u53D6 \u6D88")]),_:1})]),default:i(()=>[a(X,null,{default:i(()=>[a(O,{gutter:20,class:"mb-10px"},{default:i(()=>[a(n,{span:6},{default:i(()=>[a(u,{modelValue:l(p).name,"onUpdate:modelValue":e[0]||(e[0]=o=>l(p).name=o),class:"!w-240px",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u5546\u54C1\u540D\u79F0",onKeyup:te(N,["enter"])},null,8,["modelValue"])]),_:1}),a(n,{span:6},{default:i(()=>[a(F,{modelValue:l(p).categoryId,"onUpdate:modelValue":e[1]||(e[1]=o=>l(p).categoryId=o),data:l(Y),props:l(Ce),"check-strictly":"",class:"w-1/1","node-key":"id",placeholder:"\u8BF7\u9009\u62E9\u5546\u54C1\u5206\u7C7B"},null,8,["modelValue","data","props"])]),_:1}),a(n,{span:6},{default:i(()=>[a(J,{modelValue:l(p).createTime,"onUpdate:modelValue":e[2]||(e[2]=o=>l(p).createTime=o),"default-time":[new Date("1 00:00:00"),new Date("1 23:59:59")],class:"!w-240px","end-placeholder":"\u7ED3\u675F\u65E5\u671F","start-placeholder":"\u5F00\u59CB\u65E5\u671F",type:"daterange","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue","default-time"])]),_:1}),a(n,{span:6},{default:i(()=>[a(k,{onClick:N},{default:i(()=>[a(E,{class:"mr-5px",icon:"ep:search"}),f(" \u641C\u7D22 ")]),_:1}),a(k,{onClick:G},{default:i(()=>[a(E,{class:"mr-5px",icon:"ep:refresh"}),f(" \u91CD\u7F6E ")]),_:1})]),_:1})]),_:1}),oe((S(),_(l(ie),{ref_key:"spuListRef",ref:C,data:l(I),"expand-row-keys":l(y),"row-key":"id",onExpandChange:R,onSelectionChange:A},{default:i(()=>[T.isSelectSku?(S(),_(d,{key:0,type:"expand",width:"30"},{default:i(()=>[l(w)?(S(),_(l(ze),{key:0,ref_key:"skuListRef",ref:D,isComponent:!0,isDetail:!0,"prop-form-data":l(g),"property-list":l(V),onSelectionChange:j},null,8,["prop-form-data","property-list"])):K("",!0)]),_:1})):K("",!0),a(d,{type:"selection",width:"55"}),a(d,{key:"id",align:"center",label:"\u5546\u54C1\u7F16\u53F7",prop:"id"}),a(d,{label:"\u5546\u54C1\u56FE","min-width":"80"},{default:i(({row:o})=>[a(Q,{src:o.picUrl,class:"h-30px w-30px",onClick:Re=>{return L=o.picUrl,void se({zIndex:99999999,urlList:[L]});var L}},null,8,["src","onClick"])]),_:1}),a(d,{"show-overflow-tooltip":!0,label:"\u5546\u54C1\u540D\u79F0","min-width":"300",prop:"name"}),a(d,{align:"center",label:"\u5546\u54C1\u552E\u4EF7","min-width":"90",prop:"price"},{default:i(({row:o})=>[f(re(l(ne)(o.price)),1)]),_:1}),a(d,{align:"center",label:"\u9500\u91CF","min-width":"90",prop:"salesCount"}),a(d,{align:"center",label:"\u5E93\u5B58","min-width":"90",prop:"stock"}),a(d,{align:"center",label:"\u6392\u5E8F","min-width":"70",prop:"sort"}),a(d,{formatter:l(xe),align:"center",label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime",width:"180"},null,8,["formatter"])]),_:1},8,["data","expand-row-keys"])),[[$,l(x)]]),a(W,{limit:l(p).pageSize,"onUpdate:limit":e[3]||(e[3]=o=>l(p).pageSize=o),page:l(p).pageNo,"onUpdate:page":e[4]||(e[4]=o=>l(p).pageNo=o),total:l(U),onPagination:h},null,8,["limit","page","total"])]),_:1})]),_:1},8,["modelValue","title"])}}});export{De as _};
