import{d as ea,z as ta,r as C,c7 as sa,ar as ia,n as la,o as d,q as E,w as t,g as u,f as e,x as S,a as o,k as K,a5 as T,c as I,F as O,p as P,t as W,W as na,y as oa,a$ as B,e0 as ra,e1 as ca,a4 as ua,dA as va,aI as da,H as pa,I as ma,U as Ca,bm as fa,b1 as ya,a0 as wa,a1 as ha,_ as ka}from"./index-CIfmhqRC.js";import{E as _a}from"./el-drawer-QOxzUn5j.js";import{E as ga}from"./el-text-DMgoq9G3.js";import{E as xa}from"./el-empty-fTn0RAmM.js";import{C as k}from"./index-DkeRi2NZ.js";import Ma from"./RoleRepository-CeKxvkCd.js";import{r as ba}from"./gpt-WhTktY3S.js";import"./RoleHeader-C3mJeNTM.js";import"./RoleList-CB48LlBH.js";import"./el-card-DyMugU68.js";import"./el-dropdown-item-CvgBZuG7.js";import"./ChatRoleForm.vue_vue_type_script_setup_true_lang-BLlgdX66.js";import"./Dialog.vue_vue_type_style_index_0_lang-CtaLqQeX.js";import"./constants-A8BI3pz7.js";import"./index-DvHknbTX.js";import"./RoleCategoryList-DQ1BXv6f.js";const Ia={class:"h-100%"},Va={class:"conversation-list"},za={key:0,class:"conversation-item classify-title"},Ea=["onClick","onMouseover"],Sa={class:"title-wrapper"},Ta=["src"],Da={class:"title"},Ua={class:"button-wrapper"},$a=(_=>(wa("data-v-c852f433"),_=_(),ha(),_))(()=>u("div",{class:"h-160px w-100%"},null,-1)),qa={class:"tool-box"},Aa=ka(ea({__name:"ConversationList",props:{activeId:{type:String||null,required:!0}},emits:["onConversationCreate","onConversationClick","onConversationClear","onConversationDelete"],setup(_,{expose:X,emit:G}){const V=ta(),g=C(""),p=C(null),D=C(null),r=C([]),f=C({}),z=C(!1),U=C(),$=_,y=G,J=async i=>{if(g.value.trim().length){const a=r.value.filter(l=>l.title.includes(g.value.trim()));f.value=await q(a)}else f.value=await q(r.value)},F=async i=>{const a=r.value.filter(l=>l.id===i);y("onConversationClick",a[0])&&(p.value=i)},w=async()=>{try{if(U.value=setTimeout(()=>{z.value=!0},50),r.value=await k.getChatConversationMyList(),r.value.sort((i,a)=>a.createTime-i.createTime),r.value.length===0)return p.value=null,void(f.value={});f.value=await q(r.value)}finally{U.value&&clearTimeout(U.value),z.value=!1}},q=async i=>{const a={\u7F6E\u9876:[],\u4ECA\u5929:[],\u4E00\u5929\u524D:[],\u4E09\u5929\u524D:[],\u4E03\u5929\u524D:[],\u4E09\u5341\u5929\u524D:[]},l=Date.now(),v=864e5,A=3*v,L=7*v,M=30*v;for(const s of i){if(s.pinned){a.\u7F6E\u9876.push(s);continue}const h=l-s.createTime;h<v?a.\u4ECA\u5929.push(s):h<A?a.\u4E00\u5929\u524D.push(s):h<L?a.\u4E09\u5929\u524D.push(s):h<M?a.\u4E03\u5929\u524D.push(s):a.\u4E09\u5341\u5929\u524D.push(s)}return a},H=async()=>{const i=await k.createChatConversationMy({});await w(),await F(i),y("onConversationCreate")},N=async()=>{try{await V.confirm("\u786E\u8BA4\u540E\u5BF9\u8BDD\u4F1A\u5168\u90E8\u6E05\u7A7A\uFF0C\u7F6E\u9876\u7684\u5BF9\u8BDD\u9664\u5916\u3002"),await k.deleteChatConversationMyByUnpinned(),da({message:"\u64CD\u4F5C\u6210\u529F!",type:"success"}),p.value=null,await w(),y("onConversationClear")}catch{}},x=C(!1),Q=async()=>{x.value=!x.value},{activeId:R}=sa($);return ia(R,async(i,a)=>{p.value=i}),X({createConversation:H}),la(async()=>{await w(),$.activeId?p.value=$.activeId:r.value.length&&(p.value=r.value[0].id,await y("onConversationClick",r.value[0]))}),(i,a)=>{const l=pa,v=ma,A=Ca,L=xa,M=ga,s=fa,h=_a,Y=ya;return d(),E(Y,{width:"260px",class:"conversation-container h-100%"},{default:t(()=>[u("div",Ia,[e(v,{class:"w-1/1 btn-new-conversation",type:"primary",onClick:H},{default:t(()=>[e(l,{icon:"ep:plus",class:"mr-5px"}),S(" \u65B0\u5EFA\u5BF9\u8BDD ")]),_:1}),e(A,{modelValue:o(g),"onUpdate:modelValue":a[0]||(a[0]=m=>K(g)?g.value=m:null),size:"large",class:"mt-10px search-input",placeholder:"\u641C\u7D22\u5386\u53F2\u8BB0\u5F55",onKeyup:J},{prefix:t(()=>[e(l,{icon:"ep:search"})]),_:1},8,["modelValue"]),u("div",Va,[o(z)?(d(),E(L,{key:0,description:".","v-loading":o(z)},null,8,["v-loading"])):T("",!0),(d(!0),I(O,null,P(Object.keys(o(f)),m=>(d(),I("div",{key:m},[o(f)[m].length?(d(),I("div",za,[e(M,{class:"mx-1",size:"small",tag:"b"},{default:t(()=>[S(W(m),1)]),_:2},1024)])):T("",!0),(d(!0),I(O,null,P(o(f)[m],n=>(d(),I("div",{class:"conversation-item",key:n.id,onClick:b=>F(n.id),onMouseover:b=>D.value=n.id,onMouseout:a[1]||(a[1]=b=>D.value="")},[u("div",{class:na(n.id===o(p)?"conversation active":"conversation")},[u("div",Sa,[u("img",{class:"avatar",src:n.roleAvatar||o(ba)},null,8,Ta),u("span",Da,W(n.title),1)]),oa(u("div",Ua,[e(v,{class:"btn",link:"",onClick:B(b=>(async c=>{c.pinned=!c.pinned,await k.updateChatConversationMy(c),await w()})(n),["stop"])},{default:t(()=>[n.pinned?T("",!0):(d(),E(s,{key:0,title:"\u7F6E\u9876"},{default:t(()=>[e(o(ra))]),_:1})),n.pinned?(d(),E(s,{key:1,title:"\u7F6E\u9876"},{default:t(()=>[e(o(ca))]),_:1})):T("",!0)]),_:2},1032,["onClick"]),e(v,{class:"btn",link:"",onClick:B(b=>(async c=>{const{value:Z}=await va.prompt("\u4FEE\u6539\u6807\u9898",{inputPattern:/^[\s\S]*.*\S[\s\S]*$/,inputErrorMessage:"\u6807\u9898\u4E0D\u80FD\u4E3A\u7A7A",inputValue:c.title});await k.updateChatConversationMy({id:c.id,title:Z}),V.success("\u91CD\u547D\u540D\u6210\u529F"),await w();const j=r.value.filter(aa=>aa.id===c.id);j.length>0&&p.value===j[0].id&&y("onConversationClick",j[0])})(n),["stop"])},{default:t(()=>[e(s,{title:"\u7F16\u8F91"},{default:t(()=>[e(l,{icon:"ep:edit"})]),_:1})]),_:2},1032,["onClick"]),e(v,{class:"btn",link:"",onClick:B(b=>(async c=>{try{await V.delConfirm(`\u662F\u5426\u786E\u8BA4\u5220\u9664\u5BF9\u8BDD - ${c.title}?`),await k.deleteChatConversationMy(c.id),V.success("\u5BF9\u8BDD\u5DF2\u5220\u9664"),await w(),y("onConversationDelete",c)}catch{}})(n),["stop"])},{default:t(()=>[e(s,{title:"\u5220\u9664\u5BF9\u8BDD"},{default:t(()=>[e(l,{icon:"ep:delete"})]),_:1})]),_:2},1032,["onClick"])],512),[[ua,o(D)===n.id]])],2)],40,Ea))),128))]))),128)),$a])]),u("div",qa,[u("div",{onClick:Q},[e(l,{icon:"ep:user"}),e(M,{size:"small"},{default:t(()=>[S("\u89D2\u8272\u4ED3\u5E93")]),_:1})]),u("div",{onClick:N},[e(l,{icon:"ep:delete"}),e(M,{size:"small"},{default:t(()=>[S("\u6E05\u7A7A\u672A\u7F6E\u9876\u5BF9\u8BDD")]),_:1})])]),e(h,{modelValue:o(x),"onUpdate:modelValue":a[2]||(a[2]=m=>K(x)?x.value=m:null),title:"\u89D2\u8272\u4ED3\u5E93",size:"754px"},{default:t(()=>[e(Ma)]),_:1},8,["modelValue"])]),_:1})}}}),[["__scopeId","data-v-c852f433"]]);export{Aa as default};
