import{_ as ce,r as _,o as l,c as r,g as i,f as P,w as z,a as C,k as H,an as pe,a0 as fe,a1 as ge,ao as Ce,ap as ue,aq as Ne,a3 as b,n as he,ar as O,as as ve,O as me,at as ye,t as L,F as U,y as G,au as K,a5 as h,x as ke,W as Q,p as Le,q as X,d as be}from"./index-CIfmhqRC.js";const w=e=>(fe("data-v-28152ded"),e=e(),ge(),e),we={class:"add-node-btn-box"},Pe={class:"add-node-btn"},Ue={class:"add-node-popover-body"},xe=[w(()=>i("div",{class:"item-wrapper"},[i("span",{class:"iconfont"},"\uE8EF")],-1)),w(()=>i("p",null,"\u5BA1\u6279\u4EBA",-1))],Se=[w(()=>i("div",{class:"item-wrapper"},[i("span",{class:"iconfont"},"\uE93B")],-1)),w(()=>i("p",null,"\u6284\u9001\u4EBA",-1))],De=[w(()=>i("div",{class:"item-wrapper"},[i("span",{class:"iconfont"},"\uE9BE")],-1)),w(()=>i("p",null,"\u6761\u4EF6\u5206\u652F",-1))],_e=w(()=>i("button",{class:"btn",type:"button"},[i("span",{class:"iconfont"},"\uE95B")],-1)),I=ce({__name:"addNode",props:{childNodeP:{type:Object,default:()=>({})}},emits:["update:childNodeP"],setup(e,{emit:c}){let a=e,o=c,s=_(!1);const u=v=>{var p;s.value=!1,v!=4?(v==1?p={nodeName:"\u5BA1\u6838\u4EBA",error:!0,type:1,settype:1,selectMode:0,selectRange:0,directorLevel:1,examineMode:1,noHanderAction:1,examineEndDirectorLevel:0,childNode:a.childNodeP,nodeUserList:[]}:v==2&&(p={nodeName:"\u6284\u9001\u4EBA",type:2,ccSelfSelectFlag:1,childNode:a.childNodeP,nodeUserList:[]}),o("update:childNodeP",p)):o("update:childNodeP",{nodeName:"\u8DEF\u7531",type:4,childNode:null,conditionNodes:[{nodeName:"\u6761\u4EF61",error:!0,type:3,priorityLevel:1,conditionList:[],nodeUserList:[],childNode:a.childNodeP},{nodeName:"\u6761\u4EF62",type:3,priorityLevel:2,conditionList:[],nodeUserList:[],childNode:null}]})};return(v,p)=>{const y=pe;return l(),r("div",we,[i("div",Pe,[P(y,{placement:"right-start",modelValue:C(s),"onUpdate:modelValue":p[3]||(p[3]=f=>H(s)?s.value=f:s=f),width:"auto"},{reference:z(()=>[_e]),default:z(()=>[i("div",Ue,[i("a",{class:"add-node-popover-item approver",onClick:p[0]||(p[0]=f=>u(1))},xe),i("a",{class:"add-node-popover-item notifier",onClick:p[1]||(p[1]=f=>u(2))},Se),i("a",{class:"add-node-popover-item condition",onClick:p[2]||(p[2]=f=>u(4))},De)])]),_:1},8,["modelValue"])])])}}},[["__scopeId","data-v-28152ded"]]),M=e=>{if(e)return e.map(c=>c.name).toString()},Y=e=>{if(e.settype==1){if(e.nodeUserList.length==1)return e.nodeUserList[0].name;if(e.nodeUserList.length>1){if(e.examineMode==1)return M(e.nodeUserList);if(e.examineMode==2)return e.nodeUserList.length+"\u4EBA\u4F1A\u7B7E"}}else if(e.settype==2){const c=e.directorLevel==1?"\u76F4\u63A5\u4E3B\u7BA1":"\u7B2C"+e.directorLevel+"\u7EA7\u4E3B\u7BA1";if(e.examineMode==1)return c;if(e.examineMode==2)return c+"\u4F1A\u7B7E"}else{if(e.settype==4)return e.selectRange==1?"\u53D1\u8D77\u4EBA\u81EA\u9009":e.nodeUserList.length>0?e.selectRange==2?"\u53D1\u8D77\u4EBA\u81EA\u9009":"\u53D1\u8D77\u4EBA\u4ECE"+e.nodeUserList[0].name+"\u4E2D\u81EA\u9009":"";if(e.settype==5)return"\u53D1\u8D77\u4EBA\u81EA\u5DF1";if(e.settype==7)return"\u4ECE\u76F4\u63A5\u4E3B\u7BA1\u5230\u901A\u8BAF\u5F55\u4E2D\u7EA7\u522B\u6700\u9AD8\u7684\u7B2C"+e.examineEndDirectorLevel+"\u4E2A\u5C42\u7EA7\u4E3B\u7BA1"}},Z=e=>e.nodeUserList.length!=0?M(e.nodeUserList):e.ccSelfSelectFlag==1?"\u53D1\u8D77\u4EBA\u81EA\u9009":void 0,ee=(e,c)=>{const{conditionList:a,nodeUserList:o}=e.conditionNodes[c];if(a.length==0)return c==e.conditionNodes.length-1&&e.conditionNodes[0].conditionList.length!=0?"\u5176\u4ED6\u6761\u4EF6\u8FDB\u5165\u6B64\u6D41\u7A0B":"\u8BF7\u8BBE\u7F6E\u6761\u4EF6";{let s="";for(let u=0;u<a.length;u++){const{columnId:v,columnType:p,showType:y,showName:f,optType:m,zdy1:k,opt1:T,zdy2:x,opt2:$,fixedDownBoxValue:j}=a[u];v==0&&o.length!=0&&(s+="\u53D1\u8D77\u4EBA\u5C5E\u4E8E\uFF1A",s+=o.map(F=>F.name).join("\u6216")+" \u5E76\u4E14 "),p=="String"&&y=="3"&&k&&(s+=f+"\u5C5E\u4E8E\uFF1A"+Oe(k,JSON.parse(j))+" \u5E76\u4E14 "),p=="Double"&&(m!=6&&k?s+=`${f} ${["","<",">","\u2264","=","\u2265"][m]} ${k} \u5E76\u4E14 `:m==6&&k&&x&&(s+=`${k} ${T} ${f} ${$} ${x} \u5E76\u4E14 `))}return s?s.substring(0,s.length-4):"\u8BF7\u8BBE\u7F6E\u6761\u4EF6"}},Oe=(e,c)=>{const a=[],o=e.split(",");for(const s in c)o.map(u=>{u==s&&a.push(c[s].value)});return a.join("\u6216")},Te=["87, 106, 149","255, 148, 62","50, 150, 250"],$e=["\u53D1\u8D77\u4EBA","\u5BA1\u6838\u4EBA","\u6284\u9001\u4EBA"],je=ue("simpleWorkflow",{state:()=>({tableId:"",isTried:!1,promoterDrawer:!1,flowPermission1:{},approverDrawer:!1,approverConfig1:{},copyerDrawer:!1,copyerConfig1:{},conditionDrawer:!1,conditionsConfig1:{conditionNodes:[]}}),actions:{setTableId(e){this.tableId=e},setIsTried(e){this.isTried=e},setPromoter(e){this.promoterDrawer=e},setFlowPermission(e){this.flowPermission1=e},setApprover(e){this.approverDrawer=e},setApproverConfig(e){this.approverConfig1=e},setCopyer(e){this.copyerDrawer=e},setCopyerConfig(e){this.copyerConfig1=e},setCondition(e){this.conditionDrawer=e},setConditionsConfig(e){this.conditionsConfig1=e}}}),Fe=()=>je(Ce),Je={key:0,class:"node-wrap"},Ve={key:0},Ie={class:"iconfont"},Me=["placeholder"],Ae={class:"text"},We={key:0,class:"placeholder"},Be=i("i",{class:"anticon anticon-right arrow"},null,-1),Re={key:0,class:"error_tip"},Ee=[i("i",{class:"anticon anticon-exclamation-circle"},null,-1)],qe={key:1,class:"branch-wrap"},ze={class:"branch-box-wrap"},He={class:"branch-box"},Ge={class:"condition-node"},Ke={class:"condition-node-box"},Qe=["onClick"],Xe={class:"title-wrapper"},Ye=["onBlur","onUpdate:modelValue"],Ze=["onClick"],eo=["onClick"],oo=["onClick"],no=["onClick"],io=["onClick"],to={key:2,class:"error_tip"},so=[i("i",{class:"anticon anticon-exclamation-circle"},null,-1)],lo=i("div",{class:"top-left-cover-line"},null,-1),ao=i("div",{class:"bottom-left-cover-line"},null,-1),ro=i("div",{class:"top-right-cover-line"},null,-1),co=i("div",{class:"bottom-right-cover-line"},null,-1),po={__name:"nodeWrap",props:{nodeConfig:{type:Object,default:()=>({})},flowPermission:{type:Object,default:()=>[]}},emits:["update:flowPermission","update:nodeConfig"],setup(e,{emit:c}){let a=Ne().uid,o=e,s=b(()=>$e[o.nodeConfig.type]),u=b(()=>o.nodeConfig.type==0?M(o.flowPermission)||"\u6240\u6709\u4EBA":o.nodeConfig.type==1?Y(o.nodeConfig):Z(o.nodeConfig)),v=_([]),p=_(!1);const y=()=>{for(var n=0;n<o.nodeConfig.conditionNodes.length;n++)o.nodeConfig.conditionNodes[n].error=ee(o.nodeConfig,n)=="\u8BF7\u8BBE\u7F6E\u6761\u4EF6"&&n!=o.nodeConfig.conditionNodes.length-1};he(()=>{o.nodeConfig.type==1?o.nodeConfig.error=!Y(o.nodeConfig):o.nodeConfig.type==2?o.nodeConfig.error=!Z(o.nodeConfig):o.nodeConfig.type==4&&y()});let f=c,m=Fe(),{setPromoter:k,setApprover:T,setCopyer:x,setCondition:$,setFlowPermission:j,setApproverConfig:F,setCopyerConfig:oe,setConditionsConfig:ne}=m,S=b(()=>m.isTried),ie=b(()=>m.flowPermission1),de=b(()=>m.approverConfig1),te=b(()=>m.copyerConfig1),se=b(()=>m.conditionsConfig1);O(ie,n=>{n.flag&&n.id===a&&f("update:flowPermission",n.value)}),O(de,n=>{n.flag&&n.id===a&&f("update:nodeConfig",n.value)}),O(te,n=>{n.flag&&n.id===a&&f("update:nodeConfig",n.value)}),O(se,n=>{n.flag&&n.id===a&&f("update:nodeConfig",n.value)});const A=n=>{n||n===0?v.value[n]=!0:p.value=!0},W=n=>{n||n===0?(v.value[n]=!1,o.nodeConfig.conditionNodes[n].nodeName=o.nodeConfig.conditionNodes[n].nodeName||"\u6761\u4EF6"):(p.value=!1,o.nodeConfig.nodeName=o.nodeConfig.nodeName||s)},le=()=>{f("update:nodeConfig",o.nodeConfig.childNode)},ae=()=>{let n=o.nodeConfig.conditionNodes.length+1;o.nodeConfig.conditionNodes.push({nodeName:"\u6761\u4EF6"+n,type:3,priorityLevel:n,conditionList:[],nodeUserList:[],childNode:null}),y(),f("update:nodeConfig",o.nodeConfig)},B=(n,d)=>{n.childNode?B(n.childNode,d):n.childNode=d},J=n=>{var{type:d}=o.nodeConfig;d==0?(k(!0),j({value:o.flowPermission,flag:!1,id:a})):d==1?(T(!0),F({value:{...JSON.parse(JSON.stringify(o.nodeConfig)),settype:o.nodeConfig.settype?o.nodeConfig.settype:1},flag:!1,id:a})):d==2?(x(!0),oe({value:JSON.parse(JSON.stringify(o.nodeConfig)),flag:!1,id:a})):($(!0),ne({value:JSON.parse(JSON.stringify(o.nodeConfig)),priorityLevel:n,flag:!1,id:a}))},R=(n,d=1)=>{o.nodeConfig.conditionNodes[n]=o.nodeConfig.conditionNodes.splice(n+d,1,o.nodeConfig.conditionNodes[n])[0],o.nodeConfig.conditionNodes.map((D,V)=>{D.priorityLevel=V+1}),y(),f("update:nodeConfig",o.nodeConfig)};return(n,d)=>{const D=ve("nodeWrap",!0),V=me("focus");return l(),r(U,null,[e.nodeConfig.type<3?(l(),r("div",Je,[i("div",{class:Q(["node-wrap-box",(e.nodeConfig.type==0?"start-node ":"")+(C(S)&&e.nodeConfig.error?"active error":"")])},[i("div",{class:"title",style:ye(`background: rgb(${C(Te)[e.nodeConfig.type]});`)},[e.nodeConfig.type==0?(l(),r("span",Ve,L(e.nodeConfig.nodeName),1)):(l(),r(U,{key:1},[i("span",Ie,L(e.nodeConfig.type==1?"\uE8EF":"\uE93B"),1),C(p)?G((l(),r("input",{key:0,type:"text",class:"ant-input editable-title-input",onBlur:d[0]||(d[0]=t=>W()),onFocus:d[1]||(d[1]=t=>t.currentTarget.select()),"onUpdate:modelValue":d[2]||(d[2]=t=>e.nodeConfig.nodeName=t),placeholder:C(s)},null,40,Me)),[[V],[K,e.nodeConfig.nodeName]]):(l(),r("span",{key:1,class:"editable-title",onClick:d[3]||(d[3]=t=>A())},L(e.nodeConfig.nodeName),1)),i("i",{class:"anticon anticon-close close",onClick:le})],64))],4),i("div",{class:"content",onClick:J},[i("div",Ae,[C(u)?h("",!0):(l(),r("span",We,"\u8BF7\u9009\u62E9"+L(C(s)),1)),ke(" "+L(C(u)),1)]),Be]),C(S)&&e.nodeConfig.error?(l(),r("div",Re,Ee)):h("",!0)],2),P(I,{childNodeP:e.nodeConfig.childNode,"onUpdate:childNodeP":d[4]||(d[4]=t=>e.nodeConfig.childNode=t)},null,8,["childNodeP"])])):h("",!0),e.nodeConfig.type==4?(l(),r("div",qe,[i("div",ze,[i("div",He,[i("button",{class:"add-branch",onClick:ae},"\u6DFB\u52A0\u6761\u4EF6"),(l(!0),r(U,null,Le(e.nodeConfig.conditionNodes,(t,N)=>(l(),r("div",{class:"col-box",key:N},[i("div",Ge,[i("div",Ke,[i("div",{class:Q(["auto-judge",C(S)&&t.error?"error active":""])},[N!=0?(l(),r("div",{key:0,class:"sort-left",onClick:g=>R(N,-1)},"<",8,Qe)):h("",!0),i("div",Xe,[C(v)[N]?G((l(),r("input",{key:0,type:"text",class:"ant-input editable-title-input",onBlur:g=>W(N),onFocus:d[5]||(d[5]=g=>g.currentTarget.select()),"onUpdate:modelValue":g=>t.nodeName=g},null,40,Ye)),[[K,t.nodeName]]):(l(),r("span",{key:1,class:"editable-title",onClick:g=>A(N)},L(t.nodeName),9,Ze)),i("span",{class:"priority-title",onClick:g=>J(t.priorityLevel)},"\u4F18\u5148\u7EA7"+L(t.priorityLevel),9,eo),i("i",{class:"anticon anticon-close close",onClick:g=>(re=>{o.nodeConfig.conditionNodes.splice(re,1),o.nodeConfig.conditionNodes.map((E,q)=>{E.priorityLevel=q+1,E.nodeName=`\u6761\u4EF6${q+1}`}),y(),f("update:nodeConfig",o.nodeConfig),o.nodeConfig.conditionNodes.length==1&&(o.nodeConfig.childNode&&(o.nodeConfig.conditionNodes[0].childNode?B(o.nodeConfig.conditionNodes[0].childNode,o.nodeConfig.childNode):o.nodeConfig.conditionNodes[0].childNode=o.nodeConfig.childNode),f("update:nodeConfig",o.nodeConfig.conditionNodes[0].childNode))})(N)},null,8,oo)]),N!=e.nodeConfig.conditionNodes.length-1?(l(),r("div",{key:1,class:"sort-right",onClick:g=>R(N)},">",8,no)):h("",!0),i("div",{class:"content",onClick:g=>J(t.priorityLevel)},L(C(ee)(e.nodeConfig,N)),9,io),C(S)&&t.error?(l(),r("div",to,so)):h("",!0)],2),P(I,{childNodeP:t.childNode,"onUpdate:childNodeP":g=>t.childNode=g},null,8,["childNodeP","onUpdate:childNodeP"])])]),t.childNode?(l(),X(D,{key:0,nodeConfig:t.childNode,"onUpdate:nodeConfig":g=>t.childNode=g},null,8,["nodeConfig","onUpdate:nodeConfig"])):h("",!0),N==0?(l(),r(U,{key:1},[lo,ao],64)):h("",!0),N==e.nodeConfig.conditionNodes.length-1?(l(),r(U,{key:2},[ro,co],64)):h("",!0)]))),128))]),P(I,{childNodeP:e.nodeConfig.childNode,"onUpdate:childNodeP":d[6]||(d[6]=t=>e.nodeConfig.childNode=t)},null,8,["childNodeP"])])])):h("",!0),e.nodeConfig.childNode?(l(),X(D,{key:2,nodeConfig:e.nodeConfig.childNode,"onUpdate:nodeConfig":d[7]||(d[7]=t=>e.nodeConfig.childNode=t)},null,8,["nodeConfig"])):h("",!0)],64)}}},fo={class:"dingflow-design"},go={class:"box-scale"},Co=i("div",{class:"end-node"},[i("div",{class:"end-node-circle"}),i("div",{class:"end-node-text"},"\u6D41\u7A0B\u7ED3\u675F")],-1),uo=be({name:"SimpleWorkflowDesignEditor",__name:"index",setup(e){let c=_({nodeName:"\u53D1\u8D77\u4EBA",type:0,id:"root",formPerms:{},nodeUserList:[],childNode:{}});return(a,o)=>(l(),r("div",null,[i("section",fo,[i("div",go,[P(po,{nodeConfig:C(c),"onUpdate:nodeConfig":o[0]||(o[0]=s=>H(c)?c.value=s:c=s)},null,8,["nodeConfig"]),Co])])]))}});export{uo as default};
