import{h as P,e as D,cL as S,ez as T,cr as w,Q as E,v as Y,bB as I}from"./index-CIfmhqRC.js";import{e as y,b as A,f as H}from"./tree-BMqZf9_I.js";import{_ as M}from"./DictTag.vue_vue_type_script_lang-CTpVFm77.js";const{t:F}=P(),x=s=>{const a=D({searchSchema:[],tableColumns:[],formSchema:[],detailSchema:[]}),t=z(s,a);a.searchSchema=t||[];const l=B(s);a.tableColumns=l||[];const o=L(s,a);a.formSchema=o;const i=N(s);return a.detailSchema=i,{allSchemas:a}},z=(s,a)=>{const t=[],l=[];y(s,o=>{var i,p,f,m;if(o!=null&&o.isSearch||(i=o.search)!=null&&i.show){let u=((p=o==null?void 0:o.search)==null?void 0:p.component)||"Input";const h=[];let e={};if(o.dictType){const r={label:"\u5168\u90E8",value:""};h.push(r),S(o.dictType).forEach(c=>{h.push(c)}),e={options:h},(f=o.search)!=null&&f.component||(u="Select")}const d=T({component:u,...o.search,field:o.field,label:((m=o.search)==null?void 0:m.label)||o.label},{componentProps:e});d.api&&l.push(async()=>{var c;const r=await d.api();if(r){const n=w(a.searchSchema,b=>b.field===d.field);n!==-1&&(a.searchSchema[n].componentProps.options=v(r,(c=d.componentProps.optionsAlias)==null?void 0:c.labelField))}}),delete d.show,t.push(d)}});for(const o of l)o();return t},B=s=>{const a=A(s,{conversion:t=>{var l;if((t==null?void 0:t.isTable)!==!1&&((l=t==null?void 0:t.table)==null?void 0:l.show)!==!1)return!t.formatter&&t.dictType&&(t.formatter=(o,i,p)=>I(M,{type:t.dictType,value:p})),{...t.table,...t}}});return H(a,t=>(t.children===void 0&&delete t.children,!!t.field))},L=(s,a)=>{const t=[],l=[];y(s,o=>{var i,p,f,m,u;if((o==null?void 0:o.isForm)!==!1&&((i=o==null?void 0:o.form)==null?void 0:i.show)!==!1){let h=((p=o==null?void 0:o.form)==null?void 0:p.component)||"Input",e="";(f=o.form)!=null&&f.value?e=(m=o.form)==null?void 0:m.value:h==="InputNumber"&&(e=0);let d={};if(o.dictType){const c=[];o.dictClass&&o.dictClass==="number"?E(o.dictType).forEach(n=>{c.push(n)}):o.dictClass&&o.dictClass==="boolean"?Y(o.dictType).forEach(n=>{c.push(n)}):S(o.dictType).forEach(n=>{c.push(n)}),d={options:c},o.form&&o.form.component||(h="Select")}const r=T({component:h,value:e,...o.form,field:o.field,label:((u=o.form)==null?void 0:u.label)||o.label},{componentProps:d});r.api&&l.push(async()=>{var n;const c=await r.api();if(c){const b=w(a.formSchema,C=>C.field===r.field);b!==-1&&(a.formSchema[b].componentProps.options=v(c,(n=r.componentProps.optionsAlias)==null?void 0:n.labelField))}}),delete r.show,t.push(r)}});for(const o of l)o();return t},N=s=>{const a=[];return y(s,t=>{var l,o,i,p,f;if((t==null?void 0:t.isDetail)!==!1&&((l=t.detail)==null?void 0:l.show)!==!1){const m={...t.detail,field:t.field,label:((o=t.detail)==null?void 0:o.label)||t.label};t.dictType&&(m.dictType=t.dictType),((i=t.detail)!=null&&i.dateFormat||t.formatter=="formatDate")&&(m.dateFormat=(p=t==null?void 0:t.detail)!=null&&p.dateFormat?(f=t==null?void 0:t.detail)==null?void 0:f.dateFormat:"YYYY-MM-DD HH:mm:ss"),delete m.show,a.push(m)}}),a},v=(s,a)=>s==null?void 0:s.map(t=>(a?t.labelField=F(t.labelField):t.label=F(t.label),t));export{x as u};
