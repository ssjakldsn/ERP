import{d as K,r as p,e as P,n as G,Q as J,D as d,O as Q,o as i,c as k,f as e,w as t,a as l,x as y,k as B,F as I,p as W,q as g,y as S,z as X,G as Z,C as $,H as ee,I as ae,J as le,l as te,m as se,K as oe,L as re,M as ne}from"./index-CIfmhqRC.js";import{_ as ue}from"./index.vue_vue_type_script_setup_true_lang-DYHi04Tm.js";import{_ as pe}from"./DictTag.vue_vue_type_script_lang-CTpVFm77.js";import{_ as ie}from"./ContentWrap.vue_vue_type_script_setup_true_lang-sm5dIhPQ.js";import{g as de,d as me}from"./coupon-9SvqQ8BP.js";import{d as x}from"./formatTime-DFFN_xWx.js";const ce=K({name:"UserCouponList",__name:"UserCouponList",props:{userId:{type:Number,required:!0}},setup(D){const{userId:M}=D,T=X(),m=p(!0),v=p(0),O=p([]),o=P({pageNo:1,pageSize:10,createTime:[],status:void 0,userIds:void 0}),b=p(),c=p("all"),w=P([{label:"\u5168\u90E8",value:"all"}]),u=async()=>{m.value=!0;try{o.userIds=M;const s=await de(o);O.value=s.list,v.value=s.total}finally{m.value=!1}},N=()=>{o.pageNo=1,u()},V=()=>{var s;(s=b.value)==null||s.resetFields(),N()},Y=s=>{o.status=s==="all"?void 0:s,u()};return G(()=>{u();for(const s of J(d.PROMOTION_COUPON_STATUS))w.push({label:s.label,value:s.value})}),(s,r)=>{const R=Z,h=$,C=ee,f=ae,z=le,U=ie,q=te,A=se,n=oe,_=pe,E=re,F=ue,H=Q("hasPermi"),L=ne;return i(),k(I,null,[e(U,null,{default:t(()=>[e(z,{ref_key:"queryFormRef",ref:b,inline:!0,model:l(o),class:"-mb-15px","label-width":"68px"},{default:t(()=>[e(h,{label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime"},{default:t(()=>[e(R,{modelValue:l(o).createTime,"onUpdate:modelValue":r[0]||(r[0]=a=>l(o).createTime=a),"value-format":"YYYY-MM-DD HH:mm:ss",type:"daterange","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F","default-time":[new Date("1 00:00:00"),new Date("1 23:59:59")],class:"!w-240px"},null,8,["modelValue","default-time"])]),_:1}),e(h,null,{default:t(()=>[e(f,{onClick:N},{default:t(()=>[e(C,{icon:"ep:search",class:"mr-5px"}),y("\u641C\u7D22 ")]),_:1}),e(f,{onClick:V},{default:t(()=>[e(C,{icon:"ep:refresh",class:"mr-5px"}),y("\u91CD\u7F6E ")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(U,null,{default:t(()=>[e(A,{modelValue:l(c),"onUpdate:modelValue":r[1]||(r[1]=a=>B(c)?c.value=a:null),type:"card",onTabChange:Y},{default:t(()=>[(i(!0),k(I,null,W(l(w),a=>(i(),g(q,{key:a.value,label:a.label,name:a.value},null,8,["label","name"]))),128))]),_:1},8,["modelValue"]),S((i(),g(E,{data:l(O)},{default:t(()=>[e(n,{label:"\u4F18\u60E0\u52B5",align:"center",prop:"name"}),e(n,{label:"\u4F18\u60E0\u5238\u7C7B\u578B",align:"center",prop:"discountType"},{default:t(a=>[e(_,{type:l(d).PROMOTION_DISCOUNT_TYPE,value:a.row.discountType},null,8,["type","value"])]),_:1}),e(n,{label:"\u9886\u53D6\u65B9\u5F0F",align:"center",prop:"takeType"},{default:t(a=>[e(_,{type:l(d).PROMOTION_COUPON_TAKE_TYPE,value:a.row.takeType},null,8,["type","value"])]),_:1}),e(n,{label:"\u72B6\u6001",align:"center",prop:"status"},{default:t(a=>[e(_,{type:l(d).PROMOTION_COUPON_STATUS,value:a.row.status},null,8,["type","value"])]),_:1}),e(n,{label:"\u9886\u53D6\u65F6\u95F4",align:"center",prop:"createTime",formatter:l(x),width:"180"},null,8,["formatter"]),e(n,{label:"\u4F7F\u7528\u65F6\u95F4",align:"center",prop:"useTime",formatter:l(x),width:"180"},null,8,["formatter"]),e(n,{label:"\u64CD\u4F5C",align:"center","class-name":"small-padding fixed-width"},{default:t(a=>[S((i(),g(f,{type:"danger",link:"",onClick:fe=>(async j=>{try{await T.confirm("\u56DE\u6536\u5C06\u4F1A\u6536\u56DE\u4F1A\u5458\u9886\u53D6\u7684\u5F85\u4F7F\u7528\u7684\u4F18\u60E0\u5238\uFF0C\u5DF2\u4F7F\u7528\u7684\u5C06\u65E0\u6CD5\u56DE\u6536\uFF0C\u786E\u5B9A\u8981\u56DE\u6536\u6240\u9009\u4F18\u60E0\u5238\u5417\uFF1F"),await me(j),T.notifySuccess("\u56DE\u6536\u6210\u529F"),await u()}catch{}})(a.row.id)},{default:t(()=>[y(" \u56DE\u6536 ")]),_:2},1032,["onClick"])),[[H,["promotion:coupon:delete"]]])]),_:1})]),_:1},8,["data"])),[[L,l(m)]]),e(F,{limit:l(o).pageSize,"onUpdate:limit":r[2]||(r[2]=a=>l(o).pageSize=a),page:l(o).pageNo,"onUpdate:page":r[3]||(r[3]=a=>l(o).pageNo=a),total:l(v),onPagination:u},null,8,["limit","page","total"])]),_:1})],64)}}});export{ce as _};
