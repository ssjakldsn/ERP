import{d as K,r as s,u as X,N as Y,n as Z,O as ee,o as m,c as ae,f as i,w as t,a as e,y as ie,q as c,x as d,a5 as f,F as te,z as re,I as le,l as oe,m as se,E as me}from"./index-CIfmhqRC.js";import{g as ue,_ as pe}from"./index-Bm5JfAS4.js";import{u as ne}from"./tagsView-CqxiFcdS.js";import{g as ce,u as de,l as h,r as fe,p as ye}from"./index-BZptzjxi.js";import{_ as _e}from"./CustomerForm.vue_vue_type_script_setup_true_lang-DwPSj-v0.js";import{_ as ve}from"./CustomerDetailsInfo.vue_vue_type_script_setup_true_lang-CT7F7a3m.js";import{_ as be}from"./CustomerDetailsHeader.vue_vue_type_script_setup_true_lang-CKnVFiN-.js";import{_ as ze}from"./ContactList.vue_vue_type_script_setup_true_lang-BYr0nk9x.js";import{_ as we}from"./ContractList.vue_vue_type_script_setup_true_lang-Bv1adOHr.js";import{_ as Ce}from"./BusinessList.vue_vue_type_script_setup_true_lang-K5adT8NL.js";import{_ as ke}from"./ReceivableList.vue_vue_type_script_setup_true_lang-DO-aDM01.js";import{_ as Re}from"./ReceivablePlanList.vue_vue_type_script_setup_true_lang-GZ5KzsDO.js";import{_ as Me}from"./PermissionList.vue_vue_type_script_setup_true_lang-BJ8SS8cZ.js";import{_ as Ue}from"./TransferForm.vue_vue_type_script_setup_true_lang-BkZZyHcA.js";import{_ as Se}from"./index.vue_vue_type_script_setup_true_lang-PdFImspl.js";import{B as _}from"./index-8CYEcIk3.js";import{_ as Oe}from"./CustomerDistributeForm.vue_vue_type_script_setup_true_lang-C-P2XzAG.js";import"./el-timeline-item-r9TewDuU.js";import"./formatTime-DFFN_xWx.js";import"./Dialog.vue_vue_type_style_index_0_lang-CtaLqQeX.js";import"./index-w2FCJT7Q.js";import"./tree-BMqZf9_I.js";import"./index-QrlE36WK.js";import"./ContentWrap.vue_vue_type_script_setup_true_lang-sm5dIhPQ.js";import"./el-card-DyMugU68.js";import"./el-collapse-item-BgajxfOI.js";import"./el-descriptions-item-BL6ba85F.js";import"./DictTag.vue_vue_type_script_lang-CTpVFm77.js";import"./color-BN7ZL7BD.js";import"./index.vue_vue_type_script_setup_true_lang-DYHi04Tm.js";import"./index-CrBeVHKs.js";import"./index-B_QTmj5f.js";import"./ContactForm.vue_vue_type_script_setup_true_lang-CLRF_VIq.js";import"./ContactListModal.vue_vue_type_script_setup_true_lang-KXTfVMT0.js";import"./index-jPQDaA_X.js";import"./ContractForm.vue_vue_type_script_setup_true_lang-BKXLCfjR.js";import"./index-B5nlbV2q.js";import"./ContractProductForm.vue_vue_type_script_setup_true_lang-BBuHPlBt.js";import"./index-BVTl5RdT.js";import"./BusinessForm.vue_vue_type_script_setup_true_lang-BT6WnAjK.js";import"./index-CwB7FJGa.js";import"./BusinessProductForm.vue_vue_type_script_setup_true_lang-23yRPDfu.js";import"./BusinessListModal.vue_vue_type_script_setup_true_lang-DoLUy-ZT.js";import"./index-CvUtKmzr.js";import"./ReceivableForm.vue_vue_type_script_setup_true_lang-Cav8NmDw.js";import"./index-DdHHUXAi.js";import"./ReceivablePlanForm.vue_vue_type_script_setup_true_lang-DhJzn0na.js";import"./PermissionForm.vue_vue_type_script_setup_true_lang-BA269V0x.js";import"./index-IYA49QTG.js";import"./FollowUpRecordForm.vue_vue_type_script_setup_true_lang-CX5nVT22.js";import"./FollowUpRecordBusinessForm.vue_vue_type_script_setup_true_lang-DxrArb3L.js";import"./FollowUpRecordContactForm.vue_vue_type_script_setup_true_lang-DLVeCN1i.js";const Te=K({name:"CrmCustomerDetail",__name:"index",setup($e){const l=s(0),z=s(!0),o=re(),{delView:I}=ne(),{push:x,currentRoute:F}=X(),u=s(),a=s({}),y=async()=>{z.value=!0;try{a.value=await ce(l.value),await V()}finally{z.value=!1}},C=s(),q=()=>{var r;(r=C.value)==null||r.open("update",l.value)},L=async()=>{const r=!a.value.dealStatus;try{await o.confirm(`\u786E\u5B9A\u66F4\u65B0\u6210\u4EA4\u72B6\u6001\u4E3A\u3010${r?"\u5DF2\u6210\u4EA4":"\u672A\u6210\u4EA4"}\u3011\u5417\uFF1F`),await de(l.value,r),o.success("\u66F4\u65B0\u6210\u4EA4\u72B6\u6001\u6210\u529F"),await y()}catch{}},k=s(),P=()=>{var r;(r=k.value)==null||r.open(l.value)},W=async()=>{await o.confirm(`\u786E\u5B9A\u9501\u5B9A\u5BA2\u6237\u3010${a.value.name}\u3011 \u5417\uFF1F`),await h(e(l.value),!0),o.success(`\u9501\u5B9A\u5BA2\u6237\u3010${a.value.name}\u3011\u6210\u529F`),await y()},B=async()=>{await o.confirm(`\u786E\u5B9A\u89E3\u9501\u5BA2\u6237\u3010${a.value.name}\u3011 \u5417\uFF1F`),await h(e(l.value),!1),o.success(`\u89E3\u9501\u5BA2\u6237\u3010${a.value.name}\u3011\u6210\u529F`),await y()},D=async()=>{await o.confirm(`\u786E\u5B9A\u9886\u53D6\u5BA2\u6237\u3010${a.value.name}\u3011 \u5417\uFF1F`),await fe([e(l.value)]),o.success(`\u9886\u53D6\u5BA2\u6237\u3010${a.value.name}\u3011\u6210\u529F`),await y()},R=s(),N=async()=>{var r;(r=R.value)==null||r.open(l.value)},Q=async()=>{await o.confirm(`\u786E\u5B9A\u5C06\u5BA2\u6237\u3010${a.value.name}\u3011\u653E\u5165\u516C\u6D77\u5417\uFF1F`),await ye(e(l.value)),o.success(`\u5BA2\u6237\u3010${a.value.name}\u3011\u653E\u5165\u516C\u6D77\u6210\u529F`),b()},M=s([]),V=async()=>{if(!l.value)return;const r=await ue({bizType:_.CRM_CUSTOMER,bizId:l.value});M.value=r.list},U=s(),j=r=>{var w;(w=U.value)==null||w.createReceivable(r)},b=()=>{I(e(F)),x({name:"CrmCustomer"})},{params:S}=Y();return Z(()=>{if(!S.id)return o.warning("\u53C2\u6570\u9519\u8BEF\uFF0C\u5BA2\u6237\u4E0D\u80FD\u4E3A\u7A7A\uFF01"),void b();l.value=S.id,y()}),(r,w)=>{const p=le,n=oe,A=pe,G=se,H=me,J=ee("hasPermi");return m(),ae(te,null,[i(be,{customer:e(a),loading:e(z)},{default:t(()=>{var v,O,T,$,E,g;return[(v=e(u))!=null&&v.validateWrite?ie((m(),c(p,{key:0,type:"primary",onClick:q},{default:t(()=>[d(" \u7F16\u8F91 ")]),_:1})),[[J,["crm:customer:update"]]]):f("",!0),(O=e(u))!=null&&O.validateOwnerUser?(m(),c(p,{key:1,type:"primary",onClick:P},{default:t(()=>[d(" \u8F6C\u79FB ")]),_:1})):f("",!0),(T=e(u))!=null&&T.validateWrite?(m(),c(p,{key:2,onClick:L},{default:t(()=>[d(" \u66F4\u6539\u6210\u4EA4\u72B6\u6001 ")]),_:1})):f("",!0),e(a).lockStatus&&(($=e(u))!=null&&$.validateOwnerUser)?(m(),c(p,{key:3,onClick:B},{default:t(()=>[d(" \u89E3\u9501 ")]),_:1})):f("",!0),!e(a).lockStatus&&((E=e(u))!=null&&E.validateOwnerUser)?(m(),c(p,{key:4,onClick:W},{default:t(()=>[d(" \u9501\u5B9A ")]),_:1})):f("",!0),e(a).ownerUserId?f("",!0):(m(),c(p,{key:5,type:"primary",onClick:D},{default:t(()=>[d(" \u9886\u53D6")]),_:1})),e(a).ownerUserId?f("",!0):(m(),c(p,{key:6,type:"primary",onClick:N},{default:t(()=>[d(" \u5206\u914D ")]),_:1})),e(a).ownerUserId&&((g=e(u))!=null&&g.validateOwnerUser)?(m(),c(p,{key:7,onClick:Q},{default:t(()=>[d(" \u653E\u5165\u516C\u6D77 ")]),_:1})):f("",!0)]}),_:1},8,["customer","loading"]),i(H,null,{default:t(()=>[i(G,null,{default:t(()=>[i(n,{label:"\u8DDF\u8FDB\u8BB0\u5F55"},{default:t(()=>[i(Se,{"biz-id":e(l),"biz-type":e(_).CRM_CUSTOMER},null,8,["biz-id","biz-type"])]),_:1}),i(n,{label:"\u57FA\u672C\u4FE1\u606F"},{default:t(()=>[i(ve,{customer:e(a)},null,8,["customer"])]),_:1}),i(n,{label:"\u8054\u7CFB\u4EBA",lazy:""},{default:t(()=>[i(ze,{"biz-id":e(a).id,"biz-type":e(_).CRM_CUSTOMER},null,8,["biz-id","biz-type"])]),_:1}),i(n,{label:"\u56E2\u961F\u6210\u5458"},{default:t(()=>{var v;return[i(Me,{ref_key:"permissionListRef",ref:u,"biz-id":e(a).id,"biz-type":e(_).CRM_CUSTOMER,"show-action":!((v=e(u))!=null&&v.isPool)||!1,onQuitTeam:b},null,8,["biz-id","biz-type","show-action"])]}),_:1}),i(n,{label:"\u5546\u673A",lazy:""},{default:t(()=>[i(Ce,{"biz-id":e(a).id,"biz-type":e(_).CRM_CUSTOMER},null,8,["biz-id","biz-type"])]),_:1}),i(n,{label:"\u5408\u540C",lazy:""},{default:t(()=>[i(we,{"biz-id":e(a).id,"biz-type":e(_).CRM_CUSTOMER},null,8,["biz-id","biz-type"])]),_:1}),i(n,{label:"\u56DE\u6B3E",lazy:""},{default:t(()=>[i(Re,{"customer-id":e(a).id,onCreateReceivable:j},null,8,["customer-id"]),i(ke,{ref_key:"receivableListRef",ref:U,"customer-id":e(a).id},null,8,["customer-id"])]),_:1}),i(n,{label:"\u64CD\u4F5C\u65E5\u5FD7"},{default:t(()=>[i(A,{"log-list":e(M)},null,8,["log-list"])]),_:1})]),_:1})]),_:1}),i(_e,{ref_key:"formRef",ref:C,onSuccess:y},null,512),i(Oe,{ref_key:"distributeForm",ref:R,onSuccess:y},null,512),i(Ue,{ref_key:"transferFormRef",ref:k,"biz-type":e(_).CRM_CUSTOMER,onSuccess:b},null,8,["biz-type"])],64)}}});export{Te as default};
