import{ba as Y,ar as S,aw as j,cz as B,c7 as G,B as D,c2 as H,a3 as m,d as _,A as J,aq as Z,b_ as ee,cA as q,c4 as te,c1 as le,b4 as ae,cB as se,by as oe,r as P,e as z,n as de,bB as R,bb as ce,bc as re}from"./index-CIfmhqRC.js";const ne=_({extends:J,setup(t,c){const r=J.setup(t,c);delete r.selectOptionClick;const p=Z().proxy;return j(()=>{r.select.states.cachedOptions.get(p.value)||r.select.onOptionCreate(p)}),S(()=>c.attrs.visible,d=>{r.states.visible=d},{immediate:!0}),r},methods:{selectOptionClick(){this.$el.parentElement.click()}}});function I(t){return t||t===0}function T(t){return Array.isArray(t)&&t.length}function x(t){return Array.isArray(t)?t:I(t)?[t]:[]}function L(t,c,r,p,d){for(let n=0;n<t.length;n++){const v=t[n];if(c(v,n,t,d))return p?p(v,n,t,d):v;{const O=r(v);if(T(O)){const A=L(O,c,r,p,v);if(A)return A}}}}function U(t,c,r,p){for(let d=0;d<t.length;d++){const n=t[d];c(n,d,t,p);const v=r(n);T(v)&&U(v,c,r,n)}}var ie=_({props:{data:{type:Array,default:()=>[]}},setup(t){const c=ae(se);return S(()=>t.data,()=>{var r;t.data.forEach(d=>{c.states.cachedOptions.has(d.value)||c.states.cachedOptions.set(d.value,d)});const p=((r=c.selectRef)==null?void 0:r.querySelectorAll("input"))||[];oe&&!Array.from(p).includes(document.activeElement)&&c.setSelected()},{flush:"post",immediate:!0}),()=>{}}});const ue=_({name:"ElTreeSelect",inheritAttrs:!1,props:{...D.props,...q.props,cacheData:{type:Array,default:()=>[]}},setup(t,c){const{slots:r,expose:p}=c,d=P(),n=P(),v=m(()=>t.nodeKey||t.valueKey||"value"),O=((e,{attrs:C,emit:E},{select:g,tree:b,key:f})=>{const V=Y("tree-select");return S(()=>e.data,()=>{e.filterable&&j(()=>{var i,a;(a=b.value)==null||a.filter((i=g.value)==null?void 0:i.states.inputValue)})},{flush:"post"}),{...B(G(e),Object.keys(D.props)),...C,"onUpdate:modelValue":i=>E(H,i),valueKey:f,popperClass:m(()=>{const i=[V.e("popper")];return e.popperClass&&i.push(e.popperClass),i.join(" ")}),filterMethod:(i="")=>{var a;e.filterMethod?e.filterMethod(i):e.remoteMethod?e.remoteMethod(i):(a=b.value)==null||a.filter(i)}}})(t,c,{select:d,tree:n,key:v}),{cacheOptions:A,...Q}=((e,{attrs:C,slots:E,emit:g},{select:b,tree:f,key:V})=>{S(()=>e.modelValue,()=>{e.showCheckbox&&j(()=>{const l=f.value;l&&!ee(l.getCheckedKeys(),x(e.modelValue))&&l.setCheckedKeys(x(e.modelValue))})},{immediate:!0,deep:!0});const i=m(()=>({value:V.value,label:"label",children:"children",disabled:"disabled",isLeaf:"isLeaf",...e.props})),a=(l,s)=>{var o;const u=i.value[l];return le(u)?u(s,(o=f.value)==null?void 0:o.getNode(a("value",s))):s[u]},F=x(e.modelValue).map(l=>L(e.data||[],s=>a("value",s)===l,s=>a("children",s),(s,o,u,y)=>y&&a("value",y))).filter(l=>I(l)),W=m(()=>{if(!e.renderAfterExpand&&!e.lazy)return[];const l=[];return U(e.data.concat(e.cacheData),s=>{const o=a("value",s);l.push({value:o,currentLabel:a("label",s),isDisabled:a("disabled",s)})},s=>a("children",s)),l});return{...B(G(e),Object.keys(q.props)),...C,nodeKey:V,expandOnClickNode:m(()=>!e.checkStrictly&&e.expandOnClickNode),defaultExpandedKeys:m(()=>e.defaultExpandedKeys?e.defaultExpandedKeys.concat(F):F),renderContent:(l,{node:s,data:o,store:u})=>l(ne,{value:a("value",o),label:a("label",o),disabled:a("disabled",o),visible:s.visible},e.renderContent?()=>e.renderContent(l,{node:s,data:o,store:u}):E.default?()=>E.default({node:s,data:o,store:u}):void 0),filterNodeMethod:(l,s,o)=>e.filterNodeMethod?e.filterNodeMethod(l,s,o):!l||new RegExp(te(l),"i").test(a("label",s)||""),onNodeClick:(l,s,o)=>{var u,y,K,N;if((u=C.onNodeClick)==null||u.call(C,l,s,o),!e.showCheckbox||!e.checkOnClickNode){if(e.showCheckbox||!e.checkStrictly&&!s.isLeaf)e.expandOnClickNode&&o.proxy.handleExpandIconClick();else if(!a("disabled",l)){const M=(y=b.value)==null?void 0:y.states.options.get(a("value",l));(K=b.value)==null||K.handleOptionSelect(M)}(N=b.value)==null||N.focus()}},onCheck:(l,s)=>{var o;if(!e.showCheckbox)return;const u=a("value",l),y={};U([f.value.store.root],h=>y[h.key]=h,h=>h.childNodes);const K=s.checkedKeys,N=e.multiple?x(e.modelValue).filter(h=>!(h in y)&&!K.includes(h)):[],M=N.concat(K);if(e.checkStrictly)g(H,e.multiple?M:M.includes(u)?u:void 0);else if(e.multiple)g(H,N.concat(f.value.getCheckedKeys(!0)));else{const h=L([l],k=>!T(a("children",k))&&!a("disabled",k),k=>a("children",k)),w=h?a("value",h):void 0,X=I(e.modelValue)&&!!L([l],k=>a("value",k)===e.modelValue,k=>a("children",k));g(H,w===e.modelValue||X?void 0:w)}j(()=>{var h;const w=x(e.modelValue);f.value.setCheckedKeys(w),(h=C.onCheck)==null||h.call(C,l,{checkedKeys:f.value.getCheckedKeys(),checkedNodes:f.value.getCheckedNodes(),halfCheckedKeys:f.value.getHalfCheckedKeys(),halfCheckedNodes:f.value.getHalfCheckedNodes()})}),(o=b.value)==null||o.focus()},cacheOptions:W}})(t,c,{select:d,tree:n,key:v}),$=z({});return p($),de(()=>{Object.assign($,{...B(n.value,["filter","updateKeyChildren","getCheckedNodes","setCheckedNodes","getCheckedKeys","setCheckedKeys","setChecked","getHalfCheckedNodes","getHalfCheckedKeys","getCurrentKey","getCurrentNode","setCurrentKey","setCurrentNode","getNode","remove","append","insertBefore","insertAfter"]),...B(d.value,["focus","blur"])})}),()=>R(D,z({...O,ref:e=>d.value=e}),{...r,default:()=>[R(ie,{data:A.value}),R(q,z({...Q,ref:e=>n.value=e}))]})}}),he=re(ce(ue,[["__file","tree-select.vue"]]));export{he as E};
