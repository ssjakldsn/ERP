import{d as j,u as q,N as J,r as m,n as M,y as G,a as e,o as S,q as I,w as c,f as o,k as v,x as T,a5 as H,h as K,z as L,az as y,aA as _,aB as O,aC as g,l as Q,m as W,I as X,C as Y,J as Z,M as $}from"./index-CIfmhqRC.js";import{_ as ee}from"./ContentWrap.vue_vue_type_script_setup_true_lang-sm5dIhPQ.js";import{u as ae}from"./tagsView-CqxiFcdS.js";import{g as re,c as ie,u as te}from"./spu-BTu6kAbO.js";import{_ as oe}from"./InfoForm.vue_vue_type_script_setup_true_lang-CKxJ6UB_.js";import{_ as se}from"./DescriptionForm.vue_vue_type_script_setup_true_lang-DAm5n4a_.js";import{_ as le}from"./OtherForm.vue_vue_type_script_setup_true_lang-C1ytE0N0.js";import{_ as ce}from"./SkuForm.vue_vue_type_script_setup_true_lang-DyzGNjKI.js";import{_ as me}from"./DeliveryForm.vue_vue_type_script_setup_true_lang-DjwSDlXt.js";import"./el-card-DyMugU68.js";import"./tree-BMqZf9_I.js";import"./category-CKOb63Br.js";import"./brand-CPSHRwFA.js";import"./formRules-C3y0LKNH.js";import"./index-BRD6A8QB.js";import"./SkuList.vue_vue_type_script_setup_true_lang-DYztw255.js";import"./el-image-DLpquQe6.js";import"./ProductAttributes.vue_vue_type_script_setup_true_lang-C5FB3-Uq.js";import"./el-text-DMgoq9G3.js";import"./property-DPsKsB2C.js";import"./ProductPropertyAddForm.vue_vue_type_script_setup_true_lang-BQhgUkqc.js";import"./Dialog.vue_vue_type_style_index_0_lang-CtaLqQeX.js";import"./index-vowoPdPv.js";import"./constants-A8BI3pz7.js";const pe=j({name:"ProductSpuAdd",__name:"index",setup(de){const{t:B}=K(),w=L(),{push:V,currentRoute:x}=q(),{params:h,name:A}=J(),{delView:E}=ae(),n=m(!1),r=m("info"),p=m(!1),D=m(),U=m(),F=m(),b=m(),C=m(),d=m({name:"",categoryId:void 0,keyword:"",picUrl:"",sliderPicUrls:[],introduction:"",deliveryTypes:[],deliveryTemplateId:void 0,brandId:void 0,specType:!1,subCommissionType:!1,skus:[{price:0,marketPrice:0,costPrice:0,barCode:"",picUrl:"",stock:0,weight:0,volume:0,firstBrokeragePrice:0,secondBrokeragePrice:0}],description:"",sort:0,giveIntegral:0,virtualSalesCount:0}),z=async()=>{var f,i,s,a,k;n.value=!0;try{await((f=e(D))==null?void 0:f.validate()),await((i=e(U))==null?void 0:i.validate()),await((s=e(F))==null?void 0:s.validate()),await((a=e(b))==null?void 0:a.validate()),await((k=e(C))==null?void 0:k.validate());const u=O(e(d.value));u.skus.forEach(t=>{t.name=u.name,t.price=g(t.price),t.marketPrice=g(t.marketPrice),t.costPrice=g(t.costPrice),t.firstBrokeragePrice=g(t.firstBrokeragePrice),t.secondBrokeragePrice=g(t.secondBrokeragePrice)});const P=[];u.sliderPicUrls.forEach(t=>{typeof t=="object"?P.push(t.url):P.push(t)}),u.sliderPicUrls=P;const N=u;h.id?(await te(N),w.success(B("common.updateSuccess"))):(await ie(N),w.success(B("common.createSuccess"))),R()}finally{n.value=!1}},R=()=>{E(e(x)),V({name:"ProductSpu"})};return M(async()=>{await(async()=>{var i;A==="ProductSpuDetail"&&(p.value=!0);const f=h.id;if(f){n.value=!0;try{const s=await re(f);(i=s.skus)==null||i.forEach(a=>{p.value?(a.price=y(a.price),a.marketPrice=y(a.marketPrice),a.costPrice=y(a.costPrice),a.firstBrokeragePrice=y(a.firstBrokeragePrice),a.secondBrokeragePrice=y(a.secondBrokeragePrice)):(a.price=_(a.price),a.marketPrice=_(a.marketPrice),a.costPrice=_(a.costPrice),a.firstBrokeragePrice=_(a.firstBrokeragePrice),a.secondBrokeragePrice=_(a.secondBrokeragePrice))}),d.value=s}finally{n.value=!1}}})()}),(f,i)=>{const s=Q,a=W,k=X,u=Y,P=Z,N=ee,t=$;return G((S(),I(N,null,{default:c(()=>[o(a,{modelValue:e(r),"onUpdate:modelValue":i[5]||(i[5]=l=>v(r)?r.value=l:null)},{default:c(()=>[o(s,{label:"\u57FA\u7840\u8BBE\u7F6E",name:"info"},{default:c(()=>[o(oe,{ref_key:"infoRef",ref:D,activeName:e(r),"onUpdate:activeName":i[0]||(i[0]=l=>v(r)?r.value=l:null),"is-detail":e(p),propFormData:e(d)},null,8,["activeName","is-detail","propFormData"])]),_:1}),o(s,{label:"\u4EF7\u683C\u5E93\u5B58",name:"sku"},{default:c(()=>[o(ce,{ref_key:"skuRef",ref:U,activeName:e(r),"onUpdate:activeName":i[1]||(i[1]=l=>v(r)?r.value=l:null),"is-detail":e(p),propFormData:e(d)},null,8,["activeName","is-detail","propFormData"])]),_:1}),o(s,{label:"\u7269\u6D41\u8BBE\u7F6E",name:"delivery"},{default:c(()=>[o(me,{ref_key:"deliveryRef",ref:F,activeName:e(r),"onUpdate:activeName":i[2]||(i[2]=l=>v(r)?r.value=l:null),"is-detail":e(p),propFormData:e(d)},null,8,["activeName","is-detail","propFormData"])]),_:1}),o(s,{label:"\u5546\u54C1\u8BE6\u60C5",name:"description"},{default:c(()=>[o(se,{ref_key:"descriptionRef",ref:b,activeName:e(r),"onUpdate:activeName":i[3]||(i[3]=l=>v(r)?r.value=l:null),"is-detail":e(p),propFormData:e(d)},null,8,["activeName","is-detail","propFormData"])]),_:1}),o(s,{label:"\u5176\u5B83\u8BBE\u7F6E",name:"other"},{default:c(()=>[o(le,{ref_key:"otherRef",ref:C,activeName:e(r),"onUpdate:activeName":i[4]||(i[4]=l=>v(r)?r.value=l:null),"is-detail":e(p),propFormData:e(d)},null,8,["activeName","is-detail","propFormData"])]),_:1})]),_:1},8,["modelValue"]),o(P,null,{default:c(()=>[o(u,{style:{float:"right"}},{default:c(()=>[e(p)?H("",!0):(S(),I(k,{key:0,loading:e(n),type:"primary",onClick:z},{default:c(()=>[T(" \u4FDD\u5B58 ")]),_:1},8,["loading"])),o(k,{onClick:R},{default:c(()=>[T("\u8FD4\u56DE")]),_:1})]),_:1})]),_:1})]),_:1})),[[t,e(n)]])}}});export{pe as default};
