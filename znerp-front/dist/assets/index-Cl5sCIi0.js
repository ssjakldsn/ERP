import{d as me,z as de,h as ue,u as ce,r as m,e as fe,n as ye,as as we,O as ke,o as r,c as N,f as a,w as l,a as o,P as W,F as X,p as _e,q as n,x as d,y,g as q,t as v,a5 as Y,k as B,am as ge,U as be,C as ve,A as he,B as Ce,H as Ve,I as xe,J as De,K as Se,av as Ue,ce as Ne,L as Pe,M as Te}from"./index-CIfmhqRC.js";import{_ as qe}from"./Dialog.vue_vue_type_style_index_0_lang-CtaLqQeX.js";import{_ as Be}from"./index.vue_vue_type_script_setup_true_lang-DYHi04Tm.js";import{E as Fe}from"./el-image-DLpquQe6.js";import{_ as ze}from"./ContentWrap.vue_vue_type_script_setup_true_lang-sm5dIhPQ.js";import{_ as Ie}from"./index-2RHHZ-Zv.js";import{d as Ke,f as Me}from"./formatTime-DFFN_xWx.js";import{k as Re}from"./bpmn-embedded-BXCF3ZCj.js";import{a as Ee,d as Le,b as je,e as Ae,g as He}from"./index-DX2fvTi7.js";import{g as Je}from"./index-X3qw9mzS.js";import{_ as Oe}from"./ModelForm.vue_vue_type_script_setup_true_lang-n6MZ4qeT.js";import{_ as Qe}from"./ModelImportForm.vue_vue_type_script_setup_true_lang-D6iCJola.js";import{b as We}from"./formCreate-ECTif2qa.js";import{C as Xe}from"./index-YiSRvDzN.js";import"./index-CrBeVHKs.js";import"./el-card-DyMugU68.js";import"./XTextButton-eNQK5rLc.js";import"./XButton-CPWgIV2x.js";import"./el-collapse-item-BgajxfOI.js";import"./el-tree-select-CYFGeiEt.js";import"./tree-BMqZf9_I.js";import"./index-CSBlvrKl.js";import"./index-C34hh2Ad.js";import"./index-5G2YP0dG.js";import"./index-QrlE36WK.js";import"./index-DoOVXCWW.js";import"./constants-A8BI3pz7.js";import"./index-D8KNv32A.js";import"./el-drawer-QOxzUn5j.js";import"./DictTag.vue_vue_type_script_lang-CTpVFm77.js";import"./color-BN7ZL7BD.js";import"./index-BbfStrPJ.js";const Ye={key:2},$e={key:0},Ge=me({name:"BpmModel",__name:"index",setup(Ze){const _=de(),{t:F}=ue(),{push:h}=ce(),P=m(!0),z=m(0),I=m([]),p=fe({pageNo:1,pageSize:10,key:void 0,name:void 0,category:void 0}),K=m(),M=m([]),w=async()=>{P.value=!0;try{const f=await Ee(p);I.value=f.list,z.value=f.total}finally{P.value=!1}},C=()=>{p.pageNo=1,w()},$=()=>{K.value.resetFields(),C()},R=m(),E=(f,t)=>{R.value.open(f,t)},L=m(),G=()=>{L.value.open()},V=m(!1),T=m({rule:[],option:{}}),j=async f=>{if(f.formType==10){const t=await Je(f.formId);We(T,t.conf,t.fields),V.value=!0}else await h({path:f.formCustomCreatePath})},x=m(!1),g=m(null),A=m({prefix:"flowable"});return ye(async()=>{await w(),M.value=await Xe.getCategorySimpleList()}),(f,t)=>{const D=Ie,H=be,S=ve,Z=he,ee=Ce,U=Ve,s=xe,ae=De,J=ze,u=Se,le=Fe,O=Ue,oe=Ne,te=Pe,ie=Be,re=we("form-create"),Q=qe,k=ke("hasPermi"),ne=Te;return r(),N(X,null,[a(D,{title:"\u6D41\u7A0B\u8BBE\u8BA1\u5668\uFF08BPMN\uFF09",url:"https://doc.iocoder.cn/bpm/model-designer-dingding/"}),a(D,{title:"\u6D41\u7A0B\u8BBE\u8BA1\u5668\uFF08\u9489\u9489\u3001\u98DE\u4E66\uFF09",url:"https://doc.iocoder.cn/bpm/model-designer-bpmn/"}),a(D,{title:"\u9009\u62E9\u5BA1\u6279\u4EBA\u3001\u53D1\u8D77\u4EBA\u81EA\u9009",url:"https://doc.iocoder.cn/bpm/assignee/"}),a(D,{title:"\u4F1A\u7B7E\u3001\u6216\u7B7E\u3001\u4F9D\u6B21\u5BA1\u6279",url:"https://doc.iocoder.cn/bpm/multi-instance/"}),a(J,null,{default:l(()=>[a(ae,{class:"-mb-15px",model:o(p),ref_key:"queryFormRef",ref:K,inline:!0,"label-width":"68px"},{default:l(()=>[a(S,{label:"\u6D41\u7A0B\u6807\u8BC6",prop:"key"},{default:l(()=>[a(H,{modelValue:o(p).key,"onUpdate:modelValue":t[0]||(t[0]=e=>o(p).key=e),placeholder:"\u8BF7\u8F93\u5165\u6D41\u7A0B\u6807\u8BC6",clearable:"",onKeyup:W(C,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),a(S,{label:"\u6D41\u7A0B\u540D\u79F0",prop:"name"},{default:l(()=>[a(H,{modelValue:o(p).name,"onUpdate:modelValue":t[1]||(t[1]=e=>o(p).name=e),placeholder:"\u8BF7\u8F93\u5165\u6D41\u7A0B\u540D\u79F0",clearable:"",onKeyup:W(C,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),a(S,{label:"\u6D41\u7A0B\u5206\u7C7B",prop:"category"},{default:l(()=>[a(ee,{modelValue:o(p).category,"onUpdate:modelValue":t[2]||(t[2]=e=>o(p).category=e),placeholder:"\u8BF7\u9009\u62E9\u6D41\u7A0B\u5206\u7C7B",clearable:"",class:"!w-240px"},{default:l(()=>[(r(!0),N(X,null,_e(o(M),e=>(r(),n(Z,{key:e.code,label:e.name,value:e.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(S,null,{default:l(()=>[a(s,{onClick:C},{default:l(()=>[a(U,{icon:"ep:search",class:"mr-5px"}),d(" \u641C\u7D22")]),_:1}),a(s,{onClick:$},{default:l(()=>[a(U,{icon:"ep:refresh",class:"mr-5px"}),d(" \u91CD\u7F6E")]),_:1}),y((r(),n(s,{type:"primary",plain:"",onClick:t[3]||(t[3]=e=>E("create"))},{default:l(()=>[a(U,{icon:"ep:plus",class:"mr-5px"}),d(" \u65B0\u5EFA\u6D41\u7A0B ")]),_:1})),[[k,["bpm:model:create"]]]),y((r(),n(s,{type:"success",plain:"",onClick:G},{default:l(()=>[a(U,{icon:"ep:upload",class:"mr-5px"}),d(" \u5BFC\u5165\u6D41\u7A0B ")]),_:1})),[[k,["bpm:model:import"]]])]),_:1})]),_:1},8,["model"])]),_:1}),a(J,null,{default:l(()=>[y((r(),n(te,{data:o(I)},{default:l(()=>[a(u,{label:"\u6D41\u7A0B\u6807\u8BC6",align:"center",prop:"key",width:"200"}),a(u,{label:"\u6D41\u7A0B\u540D\u79F0",align:"center",prop:"name",width:"200"},{default:l(e=>[a(s,{type:"primary",link:"",onClick:c=>(async i=>{const b=await He(i.id);g.value=b.bpmnXml||"",x.value=!0})(e.row)},{default:l(()=>[q("span",null,v(e.row.name),1)]),_:2},1032,["onClick"])]),_:1}),a(u,{label:"\u6D41\u7A0B\u56FE\u6807",align:"center",prop:"icon",width:"100"},{default:l(e=>[a(le,{src:e.row.icon,class:"w-32px h-32px"},null,8,["src"])]),_:1}),a(u,{label:"\u6D41\u7A0B\u5206\u7C7B",align:"center",prop:"categoryName",width:"100"}),a(u,{label:"\u8868\u5355\u4FE1\u606F",align:"center",prop:"formType",width:"200"},{default:l(e=>[e.row.formType===10?(r(),n(s,{key:0,type:"primary",link:"",onClick:c=>j(e.row)},{default:l(()=>[q("span",null,v(e.row.formName),1)]),_:2},1032,["onClick"])):e.row.formType===20?(r(),n(s,{key:1,type:"primary",link:"",onClick:c=>j(e.row)},{default:l(()=>[q("span",null,v(e.row.formCustomCreatePath),1)]),_:2},1032,["onClick"])):(r(),N("label",Ye,"\u6682\u65E0\u8868\u5355"))]),_:1}),a(u,{label:"\u521B\u5EFA\u65F6\u95F4",align:"center",prop:"createTime",width:"180",formatter:o(Ke)},null,8,["formatter"]),a(u,{label:"\u6700\u65B0\u90E8\u7F72\u7684\u6D41\u7A0B\u5B9A\u4E49",align:"center"},{default:l(()=>[a(u,{label:"\u6D41\u7A0B\u7248\u672C",align:"center",prop:"processDefinition.version",width:"100"},{default:l(e=>[e.row.processDefinition?(r(),n(O,{key:0},{default:l(()=>[d(" v"+v(e.row.processDefinition.version),1)]),_:2},1024)):(r(),n(O,{key:1,type:"warning"},{default:l(()=>[d("\u672A\u90E8\u7F72")]),_:1}))]),_:1}),a(u,{label:"\u6FC0\u6D3B\u72B6\u6001",align:"center",prop:"processDefinition.version",width:"85"},{default:l(e=>[e.row.processDefinition?(r(),n(oe,{key:0,modelValue:e.row.processDefinition.suspensionState,"onUpdate:modelValue":c=>e.row.processDefinition.suspensionState=c,"active-value":1,"inactive-value":2,onChange:c=>(async i=>{const b=i.processDefinition.suspensionState;try{const pe=i.id,se="\u662F\u5426\u786E\u8BA4"+(b===1?"\u6FC0\u6D3B":"\u6302\u8D77")+'\u6D41\u7A0B\u540D\u5B57\u4E3A"'+i.name+'"\u7684\u6570\u636E\u9879?';await _.confirm(se),await je(pe,b),await w()}catch{i.processDefinition.suspensionState=b===1?2:1}})(e.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])):Y("",!0)]),_:1}),a(u,{label:"\u90E8\u7F72\u65F6\u95F4",align:"center",prop:"deploymentTime",width:"180"},{default:l(e=>[e.row.processDefinition?(r(),N("span",$e,v(o(Me)(e.row.processDefinition.deploymentTime)),1)):Y("",!0)]),_:1})]),_:1}),a(u,{label:"\u64CD\u4F5C",align:"center","min-width":"240",fixed:"right"},{default:l(e=>[y((r(),n(s,{link:"",type:"primary",onClick:c=>E("update",e.row.id)},{default:l(()=>[d(" \u4FEE\u6539\u6D41\u7A0B ")]),_:2},1032,["onClick"])),[[k,["bpm:model:update"]]]),y((r(),n(s,{link:"",type:"primary",onClick:c=>{return i=e.row,void h({name:"BpmModelEditor",query:{modelId:i.id}});var i}},{default:l(()=>[d(" \u8BBE\u8BA1\u6D41\u7A0B ")]),_:2},1032,["onClick"])),[[k,["bpm:model:update"]]]),y((r(),n(s,{link:"",type:"primary",onClick:c=>{return i=e.row.id,void h({name:"SimpleWorkflowDesignEditor",query:{modelId:i.id}});var i}},{default:l(()=>[d(" \u4EFF\u9489\u9489\u8BBE\u8BA1\u6D41\u7A0B ")]),_:2},1032,["onClick"])),[[k,["bpm:model:update"]]]),y((r(),n(s,{link:"",type:"primary",onClick:c=>(async i=>{try{await _.confirm("\u662F\u5426\u90E8\u7F72\u8BE5\u6D41\u7A0B\uFF01\uFF01"),await Ae(i.id),_.success(F("\u90E8\u7F72\u6210\u529F")),await w()}catch{}})(e.row)},{default:l(()=>[d(" \u53D1\u5E03\u6D41\u7A0B ")]),_:2},1032,["onClick"])),[[k,["bpm:model:deploy"]]]),y((r(),n(s,{link:"",type:"primary",onClick:c=>{return i=e.row,void h({name:"BpmProcessDefinition",query:{key:i.key}});var i}},{default:l(()=>[d(" \u6D41\u7A0B\u5B9A\u4E49 ")]),_:2},1032,["onClick"])),[[k,["bpm:process-definition:query"]]]),y((r(),n(s,{link:"",type:"danger",onClick:c=>(async i=>{try{await _.delConfirm(),await Le(i),_.success(F("common.delSuccess")),await w()}catch{}})(e.row.id)},{default:l(()=>[d(" \u5220\u9664 ")]),_:2},1032,["onClick"])),[[k,["bpm:model:delete"]]])]),_:1})]),_:1},8,["data"])),[[ne,o(P)]]),a(ie,{total:o(z),page:o(p).pageNo,"onUpdate:page":t[4]||(t[4]=e=>o(p).pageNo=e),limit:o(p).pageSize,"onUpdate:limit":t[5]||(t[5]=e=>o(p).pageSize=e),onPagination:w},null,8,["total","page","limit"])]),_:1}),a(Oe,{ref_key:"formRef",ref:R,onSuccess:w},null,512),a(Qe,{ref_key:"importFormRef",ref:L,onSuccess:w},null,512),a(Q,{title:"\u8868\u5355\u8BE6\u60C5",modelValue:o(V),"onUpdate:modelValue":t[6]||(t[6]=e=>B(V)?V.value=e:null),width:"800"},{default:l(()=>[a(re,{rule:o(T).rule,option:o(T).option},null,8,["rule","option"])]),_:1},8,["modelValue"]),a(Q,{title:"\u6D41\u7A0B\u56FE",modelValue:o(x),"onUpdate:modelValue":t[8]||(t[8]=e=>B(x)?x.value=e:null),width:"800"},{default:l(()=>[a(o(Re),ge({key:"designer",modelValue:o(g),"onUpdate:modelValue":t[7]||(t[7]=e=>B(g)?g.value=e:null),value:o(g)},o(A),{prefix:o(A).prefix}),null,16,["modelValue","value","prefix"])]),_:1},8,["modelValue"])],64)}}});export{Ge as default};
