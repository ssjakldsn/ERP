import{d as N,r as i,e as Q,o as n,q as v,w as u,f as l,x as D,a,y as S,c as w,p as I,F as g,Q as Y,D as H,k as K,h as O,z as W,aB as X,b as Z,U as $,C as ee,E as le,A as ae,B as ue,j as re,cc as de,G as te,J as se,I as oe,M as ne}from"./index-CIfmhqRC.js";import{_ as ie}from"./Dialog.vue_vue_type_style_index_0_lang-CtaLqQeX.js";import{b as ce,c as me,u as pe}from"./index-DdHHUXAi.js";import{g as fe}from"./index-QrlE36WK.js";import{a as ve}from"./index-BZptzjxi.js";import{d as be}from"./index-jPQDaA_X.js";const _e=N({__name:"ReceivablePlanForm",emits:["success"],setup(Ve,{expose:B,emit:F}){const{t:U}=O(),T=W(),R=i([]),c=i(!1),q=i(""),m=i(!1),p=i(""),r=i({}),A=Q({price:[{required:!0,message:"\u8BA1\u5212\u56DE\u6B3E\u91D1\u989D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],returnTime:[{required:!0,message:"\u8BA1\u5212\u56DE\u6B3E\u65E5\u671F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],customerId:[{required:!0,message:"\u5BA2\u6237\u7F16\u53F7\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],contractId:[{required:!0,message:"\u5408\u540C\u7F16\u53F7\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],ownerUserId:[{required:!0,message:"\u8D1F\u8D23\u4EBA\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),b=i(),x=i([]),h=i([]);B({open:async(s,d,f,o)=>{if(c.value=!0,q.value=U("action."+s),p.value=s,j(),d){m.value=!0;try{const t=await ce(d);r.value=X(t),await k(t.customerId),r.value.contractId=t==null?void 0:t.contractId}finally{m.value=!1}}R.value=await fe(),x.value=await ve(),p.value==="create"&&(r.value.ownerUserId=Z().getUser.id),f&&(r.value.customerId=f,await k(f)),o&&(r.value.contractId=o)}});const M=F,P=async()=>{if(b&&await b.value.validate()){m.value=!0;try{const s=r.value;p.value==="create"?(await me(s),T.success(U("common.createSuccess"))):(await pe(s),T.success(U("common.updateSuccess"))),c.value=!1,M("success")}finally{m.value=!1}}},j=()=>{var s;r.value={},(s=b.value)==null||s.resetFields()},k=async s=>{r.value.contractId=void 0,s&&(h.value=[],h.value=await be(s))};return(s,d)=>{const f=$,o=ee,t=le,_=ae,V=ue,y=re,C=de,z=te,G=se,E=oe,J=ie,L=ne;return n(),v(J,{modelValue:a(c),"onUpdate:modelValue":d[10]||(d[10]=e=>K(c)?c.value=e:null),title:a(q)},{footer:u(()=>[l(E,{disabled:a(m),type:"primary",onClick:P},{default:u(()=>[D("\u786E \u5B9A")]),_:1},8,["disabled"]),l(E,{onClick:d[9]||(d[9]=e=>c.value=!1)},{default:u(()=>[D("\u53D6 \u6D88")]),_:1})]),default:u(()=>[S((n(),v(G,{ref_key:"formRef",ref:b,model:a(r),rules:a(A),"label-width":"110px"},{default:u(()=>[l(y,null,{default:u(()=>[l(t,{span:12},{default:u(()=>[l(o,{label:"\u8FD8\u6B3E\u671F\u6570",prop:"period"},{default:u(()=>[l(f,{modelValue:a(r).period,"onUpdate:modelValue":d[0]||(d[0]=e=>a(r).period=e),disabled:"",placeholder:"\u4FDD\u5B58\u65F6\u81EA\u52A8\u751F\u6210"},null,8,["modelValue"])]),_:1})]),_:1}),l(t,{span:12},{default:u(()=>[l(o,{label:"\u8D1F\u8D23\u4EBA",prop:"ownerUserId"},{default:u(()=>[l(V,{modelValue:a(r).ownerUserId,"onUpdate:modelValue":d[1]||(d[1]=e=>a(r).ownerUserId=e),disabled:a(p)!=="create",class:"w-1/1"},{default:u(()=>[(n(!0),w(g,null,I(a(R),e=>(n(),v(_,{key:e.id,label:e.nickname,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),l(y,null,{default:u(()=>[l(t,{span:12},{default:u(()=>[l(o,{label:"\u5BA2\u6237\u540D\u79F0",prop:"customerId"},{default:u(()=>[l(V,{modelValue:a(r).customerId,"onUpdate:modelValue":d[2]||(d[2]=e=>a(r).customerId=e),disabled:a(p)!=="create",class:"w-1/1",filterable:"",placeholder:"\u8BF7\u9009\u62E9\u5BA2\u6237",onChange:k},{default:u(()=>[(n(!0),w(g,null,I(a(x),e=>(n(),v(_,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),l(t,{span:12},{default:u(()=>[l(o,{label:"\u5408\u540C\u540D\u79F0",prop:"contractId"},{default:u(()=>[l(V,{modelValue:a(r).contractId,"onUpdate:modelValue":d[3]||(d[3]=e=>a(r).contractId=e),disabled:a(p)!=="create"||!a(r).customerId,class:"w-1/1",filterable:"",placeholder:"\u8BF7\u9009\u62E9\u5408\u540C"},{default:u(()=>[(n(!0),w(g,null,I(a(h),e=>(n(),v(_,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),l(y,null,{default:u(()=>[l(t,{span:12},{default:u(()=>[l(o,{label:"\u8BA1\u5212\u56DE\u6B3E\u91D1\u989D",prop:"price"},{default:u(()=>[l(C,{modelValue:a(r).price,"onUpdate:modelValue":d[4]||(d[4]=e=>a(r).price=e),min:.01,precision:2,class:"!w-100%","controls-position":"right",placeholder:"\u8BF7\u8F93\u5165\u8BA1\u5212\u56DE\u6B3E\u91D1\u989D"},null,8,["modelValue"])]),_:1})]),_:1}),l(t,{span:12},{default:u(()=>[l(o,{label:"\u8BA1\u5212\u56DE\u6B3E\u65E5\u671F",prop:"returnTime"},{default:u(()=>[l(z,{modelValue:a(r).returnTime,"onUpdate:modelValue":d[5]||(d[5]=e=>a(r).returnTime=e),placeholder:"\u9009\u62E9\u8BA1\u5212\u56DE\u6B3E\u65E5\u671F",type:"date","value-format":"x",class:"!w-100%"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(y,null,{default:u(()=>[l(t,{span:12},{default:u(()=>[l(o,{label:"\u63D0\u524D\u51E0\u5929\u63D0\u9192",prop:"remindDays"},{default:u(()=>[l(C,{modelValue:a(r).remindDays,"onUpdate:modelValue":d[6]||(d[6]=e=>a(r).remindDays=e),class:"!w-100%","controls-position":"right",placeholder:"\u8BF7\u8F93\u5165\u63D0\u524D\u51E0\u5929\u63D0\u9192"},null,8,["modelValue"])]),_:1})]),_:1}),l(t,{span:12},{default:u(()=>[l(o,{label:"\u56DE\u6B3E\u65B9\u5F0F",prop:"returnType"},{default:u(()=>[l(V,{modelValue:a(r).returnType,"onUpdate:modelValue":d[7]||(d[7]=e=>a(r).returnType=e),class:"w-1/1",placeholder:"\u8BF7\u9009\u62E9\u56DE\u6B3E\u65B9\u5F0F"},{default:u(()=>[(n(!0),w(g,null,I(a(Y)(a(H).CRM_RECEIVABLE_RETURN_TYPE),e=>(n(),v(_,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(t,{span:24},{default:u(()=>[l(o,{label:"\u5907\u6CE8",prop:"remark"},{default:u(()=>[l(f,{modelValue:a(r).remark,"onUpdate:modelValue":d[8]||(d[8]=e=>a(r).remark=e),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])),[[L,a(m)]])]),_:1},8,["modelValue","title"])}}});export{_e as _};
