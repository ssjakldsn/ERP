import{d as O,ai as Q,r as p,a3 as T,ar as W,o as v,c as V,p as A,a as f,F as D,q as P,w as o,g as E,f as d,x as y,t as I,y as K,a4 as L,k as X,P as Y,h as Z,z as h,av as aa,A as ea,B as la,I as sa,i as ua,E as ta}from"./index-CIfmhqRC.js";import{E as na}from"./el-text-DMgoq9G3.js";import{c as ia,b as oa}from"./property-DPsKsB2C.js";const ra=O({name:"ProductAttributes",__name:"ProductAttributes",props:{propertyList:{type:Array,default:()=>{}},isDetail:Q.bool.def(!1)},emits:["success"],setup(b,{emit:R}){const{t:q}=Z(),_=h(),l=p(""),r=p(null),z=T(()=>a=>r.value!==null&&(r.value===a||void 0)),w=p([]),F=a=>{a!=null&&(w.value.some(c=>{var n,u;return((n=c.inputRef)==null?void 0:n.attributes.id)===((u=a.inputRef)==null?void 0:u.attributes.id)})||w.value.push(a))},s=p([]),C=p([]),S=b;W(()=>S.propertyList,a=>{a&&(s.value=a)},{deep:!0,immediate:!0});const x=R,k=async(a,c)=>{if(l.value){if(s.value[a].values.find(u=>u.name===l.value))return _.warning("\u5DF2\u5B58\u5728\u76F8\u540C\u5C5E\u6027\u503C\uFF0C\u8BF7\u91CD\u8BD5"),r.value=null,void(l.value="");const n=C.value.find(u=>u.name===l.value);if(n)return r.value=null,l.value="",s.value[a].values.push({id:n.id,name:n.name}),void x("success",s.value);try{const u=await ia({propertyId:c,name:l.value});s.value[a].values.push({id:u,name:l.value}),_.success(q("common.createSuccess")),x("success",s.value)}catch{_.error("\u6DFB\u52A0\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5")}}r.value=null,l.value=""},U=async a=>{C.value=await oa(a)};return(a,c)=>{const n=na,u=aa,$=ea,j=la,G=sa,H=ua,J=ta;return v(!0),V(D,null,A(f(s),(m,t)=>(v(),P(J,{key:t},{default:o(()=>[E("div",null,[d(n,{class:"mx-1"},{default:o(()=>[y("\u5C5E\u6027\u540D\uFF1A")]),_:1}),d(u,{closable:!b.isDetail,class:"mx-1",type:"success",onClose:e=>(i=>{var g;(g=s.value)==null||g.splice(i,1),x("success",s.value)})(t)},{default:o(()=>[y(I(m.name),1)]),_:2},1032,["closable","onClose"])]),E("div",null,[d(n,{class:"mx-1"},{default:o(()=>[y("\u5C5E\u6027\u503C\uFF1A")]),_:1}),(v(!0),V(D,null,A(m.values,(e,i)=>(v(),P(u,{key:e.id,closable:!b.isDetail,class:"mx-1",onClose:g=>((M,N)=>{var B;(B=s.value[M].values)==null||B.splice(N,1)})(t,i)},{default:o(()=>[y(I(e.name),1)]),_:2},1032,["closable","onClose"]))),128)),K(d(j,{id:`input${t}`,ref_for:!0,ref:F,modelValue:f(l),"onUpdate:modelValue":c[0]||(c[0]=e=>X(l)?l.value=e:null),"reserve-keyword":!1,"allow-create":"",class:"!w-30","default-first-option":"",filterable:"",size:"small",onBlur:e=>k(t,m.id),onChange:e=>k(t,m.id),onKeyup:Y(e=>k(t,m.id),["enter"])},{default:o(()=>[(v(!0),V(D,null,A(f(C),e=>(v(),P($,{key:e.id,label:e.name,value:e.name},null,8,["label","value"]))),128))]),_:2},1032,["id","modelValue","onBlur","onChange","onKeyup"]),[[L,f(z)(t)]]),K(d(G,{class:"button-new-tag ml-1",size:"small",onClick:e=>(async i=>{r.value=i,w.value[i].focus(),await U(s.value[i].id)})(t)},{default:o(()=>[y(" + \u6DFB\u52A0 ")]),_:2},1032,["onClick"]),[[L,!f(z)(t)]])]),d(H,{class:"my-10px"})]),_:2},1024))),128)}}});export{ra as _};
