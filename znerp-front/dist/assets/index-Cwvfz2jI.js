import{d as le,N as te,u as se,z as oe,r,a3 as re,n as ie,as as ue,o as i,c as b,f as o,a as e,y as me,q as y,w as a,k as G,F as g,p as x,g as A,x as P,t as H,E as ne,j as pe,l as de,m as fe,H as ce,I as ve,A as ye,B as _e,C as be,J as ge,M as he}from"./index-CIfmhqRC.js";import{_ as ke}from"./ContentWrap.vue_vue_type_script_setup_true_lang-sm5dIhPQ.js";import{E as we}from"./el-card-DyMugU68.js";import{E as xe}from"./el-text-DMgoq9G3.js";import{E as Ce}from"./el-image-DLpquQe6.js";import{_ as Ve}from"./index-2RHHZ-Zv.js";import{b as Ue,a as Se}from"./index-w37PzF0B.js";import{g as Ie,a as qe}from"./index-ECQfPeC-.js";import{b as Ae}from"./formCreate-ECTif2qa.js";import{_ as Pe}from"./ProcessInstanceBpmnViewer.vue_vue_type_style_index_0_lang-D8Q-vtEF.js";import{C as ze}from"./index-YiSRvDzN.js";import{u as Be}from"./tagsView-CqxiFcdS.js";import{g as Ee}from"./index-QrlE36WK.js";import"./bpmn-embedded-BXCF3ZCj.js";import"./Dialog.vue_vue_type_style_index_0_lang-CtaLqQeX.js";import"./XTextButton-eNQK5rLc.js";import"./XButton-CPWgIV2x.js";import"./el-collapse-item-BgajxfOI.js";import"./index-X3qw9mzS.js";import"./el-tree-select-CYFGeiEt.js";import"./tree-BMqZf9_I.js";import"./index-CSBlvrKl.js";import"./index-C34hh2Ad.js";import"./index-5G2YP0dG.js";import"./index-DoOVXCWW.js";import"./index.vue_vue_type_script_setup_true_lang-DYHi04Tm.js";import"./index-CrBeVHKs.js";import"./constants-A8BI3pz7.js";import"./index-D8KNv32A.js";import"./el-drawer-QOxzUn5j.js";import"./DictTag.vue_vue_type_script_lang-CTpVFm77.js";import"./color-BN7ZL7BD.js";import"./index-BbfStrPJ.js";import"./formatTime-DFFN_xWx.js";const Fe={class:"flex"},Me={class:"clearfix"},De={class:"el-icon-document"},Ge=le({name:"BpmProcessInstanceCreate",__name:"index",setup(He){const J=te(),{push:z,currentRoute:L}=se(),C=oe(),{delView:R}=Be(),h=J.query.processInstanceId,V=r(!0),k=r([]),_=r(""),U=r([]),T=re(()=>U.value.filter(l=>l.category==_.value)),n=r(),p=r({rule:[],option:{},value:{}}),d=r(),B=r(null),f=r([]),c=r({}),E=r(),S=r({}),F=r([]),M=async(l,t)=>{var v;if(d.value=l,f.value=[],c.value={},S.value={},l.formType==10){Ae(p,l.formConf,l.formFields,t);const m=await Se(l.id);if(m&&(B.value=m.bpmnXml,f.value=m.startUserSelectTasks,((v=f.value)==null?void 0:v.length)>0)){p.value.rule.push({type:"startUserSelect",props:{title:"\u6307\u5B9A\u5BA1\u6279\u4EBA"}});for(const w of f.value)c.value[w.id]=[],S.value[w.id]=[{required:!0,message:"\u8BF7\u9009\u62E9\u5BA1\u6279\u4EBA",trigger:"blur"}];F.value=await Ee()}}else l.formCustomCreatePath&&await z({path:l.formCustomCreatePath})},$=async l=>{var t;if(n.value&&d.value){((t=f.value)==null?void 0:t.length)>0&&await E.value.validate(),n.value.btn.loading(!0);try{await qe({processDefinitionId:d.value.id,variables:l,startUserSelectAssignees:c.value}),C.success("\u53D1\u8D77\u6D41\u7A0B\u6210\u529F"),R(e(L)),await z({name:"BpmProcessInstanceMy"})}finally{n.value.btn.loading(!1)}}};return ie(()=>{(async()=>{V.value=!0;try{if(k.value=await ze.getCategorySimpleList(),k.value.length>0&&(_.value=k.value[0].code),U.value=await Ue({suspensionState:1}),(h==null?void 0:h.length)>0){const l=await Ie(h);if(!l)return void C.error("\u91CD\u65B0\u53D1\u8D77\u6D41\u7A0B\u5931\u8D25\uFF0C\u539F\u56E0\uFF1A\u6D41\u7A0B\u5B9E\u4F8B\u4E0D\u5B58\u5728");const t=U.value.find(v=>{var m;return v.key==((m=l.processDefinition)==null?void 0:m.key)});if(!t)return void C.error("\u91CD\u65B0\u53D1\u8D77\u6D41\u7A0B\u5931\u8D25\uFF0C\u539F\u56E0\uFF1A\u6D41\u7A0B\u5B9A\u4E49\u4E0D\u5B58\u5728");await M(t,l.formVariables)}}finally{V.value=!1}})()}),(l,t)=>{const v=Ve,m=Ce,w=xe,I=we,q=ne,j=pe,K=de,N=fe,D=ke,O=ce,Q=ve,X=ye,W=_e,Y=be,Z=ge,ee=ue("form-create"),ae=he;return i(),b(g,null,[o(v,{title:"\u6D41\u7A0B\u53D1\u8D77\u3001\u53D6\u6D88\u3001\u91CD\u65B0\u53D1\u8D77",url:"https://doc.iocoder.cn/bpm/process-instance/"}),e(d)?(i(),y(D,{key:1},{default:a(()=>[o(I,{class:"box-card"},{default:a(()=>[A("div",Me,[A("span",De,"\u7533\u8BF7\u4FE1\u606F\u3010"+H(e(d).name)+"\u3011",1),o(Q,{style:{float:"right"},type:"primary",onClick:t[1]||(t[1]=s=>d.value=void 0)},{default:a(()=>[o(O,{icon:"ep:delete"}),P(" \u9009\u62E9\u5176\u5B83\u6D41\u7A0B ")]),_:1})]),o(q,{span:16,offset:6,style:{"margin-top":"20px"}},{default:a(()=>[o(ee,{rule:e(p).rule,api:e(n),"onUpdate:api":t[2]||(t[2]=s=>G(n)?n.value=s:null),modelValue:e(p).value,"onUpdate:modelValue":t[3]||(t[3]=s=>e(p).value=s),option:e(p).option,onSubmit:$},{"type-startUserSelect":a(()=>[o(q,{span:24},{default:a(()=>[o(I,{class:"mb-10px"},{header:a(()=>[P("\u6307\u5B9A\u5BA1\u6279\u4EBA")]),default:a(()=>[o(Z,{model:e(c),rules:e(S),ref_key:"startUserSelectAssigneesFormRef",ref:E},{default:a(()=>[(i(!0),b(g,null,x(e(f),s=>(i(),y(Y,{key:s.id,label:`\u4EFB\u52A1\u3010${s.name}\u3011`,prop:s.id},{default:a(()=>[o(W,{modelValue:e(c)[s.id],"onUpdate:modelValue":u=>e(c)[s.id]=u,multiple:"",placeholder:"\u8BF7\u9009\u62E9\u5BA1\u6279\u4EBA"},{default:a(()=>[(i(!0),b(g,null,x(e(F),u=>(i(),y(X,{key:u.id,label:u.nickname,value:u.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label","prop"]))),128))]),_:1},8,["model","rules"])]),_:1})]),_:1})]),_:1},8,["rule","api","modelValue","option"])]),_:1})]),_:1}),o(Pe,{"bpmn-xml":e(B)},null,8,["bpmn-xml"])]),_:1})):me((i(),y(D,{key:0},{default:a(()=>[o(N,{"tab-position":"left",modelValue:e(_),"onUpdate:modelValue":t[0]||(t[0]=s=>G(_)?_.value=s:null)},{default:a(()=>[(i(!0),b(g,null,x(e(k),s=>(i(),y(K,{label:s.name,name:s.code,key:s.code},{default:a(()=>[o(j,{gutter:20},{default:a(()=>[(i(!0),b(g,null,x(e(T),u=>(i(),y(q,{lg:6,sm:12,xs:24,key:u.id},{default:a(()=>[o(I,{shadow:"hover",class:"mb-20px cursor-pointer",onClick:Je=>M(u)},{default:a(()=>[A("div",Fe,[o(m,{src:u.icon,class:"w-32px h-32px"},null,8,["src"]),o(w,{class:"!ml-10px",size:"large"},{default:a(()=>[P(H(u.name),1)]),_:2},1024)])]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])]),_:1})),[[ae,e(V)]])],64)}}});export{Ge as default};
