import{bt as g,d as Q,h as H,z as K,r as i,e as W,o as c,q as f,w as o,f as r,a as l,x as T,y as X,c as h,F as k,p as P,Q as U,D as O,t as R,k as q,a5 as x,aD as Z,aB as $,eG as ee,aw as ae,U as le,C as te,G as oe,ak as re,al as ue,J as de,I as se,M as ce}from"./index-CIfmhqRC.js";import{_ as pe}from"./Dialog.vue_vue_type_style_index_0_lang-CtaLqQeX.js";import{_ as ie}from"./RewardRule.vue_vue_type_script_setup_true_lang-DqT2dzyM.js";import ne from"./SpuShowcase-DQavcwpZ.js";import{i as G,h as p}from"./constants-A8BI3pz7.js";import{_ as me}from"./ProductCategorySelect.vue_vue_type_script_setup_true_lang-Dn8UypNC.js";const ye=async V=>await g.get({url:"/promotion/reward-activity/page",params:V}),fe=async V=>await g.delete({url:"/promotion/reward-activity/delete?id="+V}),ve=Q({name:"ProductBrandForm",__name:"RewardForm",emits:["success"],setup(V,{expose:Y,emit:D}){const{t:v}=H(),S=K(),n=i(!1),b=i(""),m=i(!1),w=i(""),e=i({conditionType:G.PRICE.type,productScope:p.ALL.scope,rules:[]}),L=W({name:[{required:!0,message:"\u6D3B\u52A8\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],startAndEndTime:[{required:!0,message:"\u6D3B\u52A8\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],conditionType:[{required:!0,message:"\u6761\u4EF6\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],productScope:[{required:!0,message:"\u5546\u54C1\u8303\u56F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],productSpuIds:[{required:!0,message:"\u5546\u54C1\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],productCategoryIds:[{required:!0,message:"\u5546\u54C1\u5206\u7C7B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),_=i(),C=i();Y({open:async(s,a)=>{var u;if(n.value=!0,b.value=v("action."+s),w.value=s,M(),a){m.value=!0;try{const d=await(async y=>await g.get({url:"/promotion/reward-activity/get?id="+y}))(a);d.startAndEndTime=[d.startTime,d.endTime],(u=d.rules)==null||u.forEach(y=>{y.discountPrice=Z(y.discountPrice||0)}),e.value=d,await B()}finally{m.value=!1}}}});const N=D,F=async()=>{var s;if(_.value&&await _.value.validate()){m.value=!0;try{(s=C.value)==null||s.setRuleCoupon();const a=$(e.value);a.startTime=a.startAndEndTime[0],a.endTime=a.startAndEndTime[1],delete a.startAndEndTime,a.rules.forEach(u=>{u.discountPrice=ee(u.discountPrice||0)}),function(u){switch(e.value.productScope){case p.SPU.scope:u.productScopeValues=e.value.productSpuIds;break;case p.CATEGORY.scope:u.productScopeValues=Array.isArray(e.value.productCategoryIds)?e.value.productCategoryIds:[e.value.productCategoryIds]}}(a),w.value==="create"?(await(async u=>await g.post({url:"/promotion/reward-activity/create",data:u}))(a),S.success(v("common.createSuccess"))):(await(async u=>await g.put({url:"/promotion/reward-activity/update",data:u}))(a),S.success(v("common.updateSuccess"))),n.value=!1,N("success")}finally{m.value=!1}}},M=()=>{e.value={conditionType:G.PRICE.type,productScope:p.ALL.scope,rules:[]}},B=async()=>{switch(e.value.productScope){case p.SPU.scope:e.value.productSpuIds=e.value.productScopeValues;break;case p.CATEGORY.scope:await ae();let s=e.value.productScopeValues;Array.isArray(s)&&s.length>0&&(s=s[0]),e.value.productCategoryIds=s}};return(s,a)=>{const u=le,d=te,y=oe,I=re,A=ue,j=de,E=se,z=pe,J=ce;return c(),f(z,{modelValue:l(n),"onUpdate:modelValue":a[9]||(a[9]=t=>q(n)?n.value=t:null),title:l(b),width:"65%"},{footer:o(()=>[r(E,{disabled:l(m),type:"primary",onClick:F},{default:o(()=>[T("\u786E \u5B9A")]),_:1},8,["disabled"]),r(E,{onClick:a[8]||(a[8]=t=>n.value=!1)},{default:o(()=>[T("\u53D6 \u6D88")]),_:1})]),default:o(()=>[X((c(),f(j,{ref_key:"formRef",ref:_,model:l(e),rules:l(L),"label-width":"80px"},{default:o(()=>[r(d,{label:"\u6D3B\u52A8\u540D\u79F0",prop:"name"},{default:o(()=>[r(u,{modelValue:l(e).name,"onUpdate:modelValue":a[0]||(a[0]=t=>l(e).name=t),placeholder:"\u8BF7\u8F93\u5165\u6D3B\u52A8\u540D\u79F0"},null,8,["modelValue"])]),_:1}),r(d,{label:"\u6D3B\u52A8\u65F6\u95F4",prop:"startAndEndTime"},{default:o(()=>[r(y,{modelValue:l(e).startAndEndTime,"onUpdate:modelValue":a[1]||(a[1]=t=>l(e).startAndEndTime=t),"end-placeholder":l(v)("common.endTimeText"),"start-placeholder":l(v)("common.startTimeText"),"range-separator":"-",type:"datetimerange","value-format":"x"},null,8,["modelValue","end-placeholder","start-placeholder"])]),_:1}),r(d,{label:"\u6761\u4EF6\u7C7B\u578B",prop:"conditionType"},{default:o(()=>[r(A,{modelValue:l(e).conditionType,"onUpdate:modelValue":a[2]||(a[2]=t=>l(e).conditionType=t)},{default:o(()=>[(c(!0),h(k,null,P(l(U)(l(O).PROMOTION_CONDITION_TYPE),t=>(c(),f(I,{key:t.value,label:t.value},{default:o(()=>[T(R(t.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(d,{label:"\u4F18\u60E0\u8BBE\u7F6E"},{default:o(()=>[r(ie,{ref_key:"rewardRuleRef",ref:C,modelValue:l(e),"onUpdate:modelValue":a[3]||(a[3]=t=>q(e)?e.value=t:null)},null,8,["modelValue"])]),_:1}),r(d,{label:"\u6D3B\u52A8\u8303\u56F4",prop:"productScope"},{default:o(()=>[r(A,{modelValue:l(e).productScope,"onUpdate:modelValue":a[4]||(a[4]=t=>l(e).productScope=t)},{default:o(()=>[(c(!0),h(k,null,P(l(U)(l(O).PROMOTION_PRODUCT_SCOPE),t=>(c(),f(I,{key:t.value,label:t.value},{default:o(()=>[T(R(t.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(e).productScope===l(p).SPU.scope?(c(),f(d,{key:0,prop:"productSpuIds"},{default:o(()=>[r(ne,{modelValue:l(e).productSpuIds,"onUpdate:modelValue":a[5]||(a[5]=t=>l(e).productSpuIds=t)},null,8,["modelValue"])]),_:1})):x("",!0),l(e).productScope===l(p).CATEGORY.scope?(c(),f(d,{key:1,label:"\u5206\u7C7B",prop:"productCategoryIds"},{default:o(()=>[r(me,{modelValue:l(e).productCategoryIds,"onUpdate:modelValue":a[6]||(a[6]=t=>l(e).productCategoryIds=t)},null,8,["modelValue"])]),_:1})):x("",!0),r(d,{label:"\u5907\u6CE8",prop:"remark"},{default:o(()=>[r(u,{modelValue:l(e).remark,"onUpdate:modelValue":a[7]||(a[7]=t=>l(e).remark=t),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[J,l(m)]])]),_:1},8,["modelValue","title"])}}});export{ve as _,fe as d,ye as g};
