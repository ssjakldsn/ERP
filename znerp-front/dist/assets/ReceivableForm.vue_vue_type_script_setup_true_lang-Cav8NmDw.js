import{d as Y,r as c,e as H,o as i,q as m,w as t,f as u,x as P,a as l,y as K,c as V,p as y,F as w,Q as O,D as W,k as X,h as Z,z as $,b as ee,U as ae,C as le,E as ue,A as de,B as te,j as re,cc as se,G as oe,J as ne,I as ie,M as ce}from"./index-CIfmhqRC.js";import{_ as pe}from"./Dialog.vue_vue_type_style_index_0_lang-CtaLqQeX.js";import{a as me}from"./index-DdHHUXAi.js";import{a as fe,c as ve,u as be}from"./index-CvUtKmzr.js";import{g as _e}from"./index-QrlE36WK.js";import{a as Ie}from"./index-BZptzjxi.js";import{d as Ve}from"./index-jPQDaA_X.js";const ye=Y({__name:"ReceivableForm",emits:["success"],setup(we,{expose:S,emit:A}){const{t:k}=Z(),C=$(),E=c([]),f=c(!1),R=c(""),v=c(!1),p=c(""),a=c({}),B=H({customerId:[{required:!0,message:"\u5BA2\u6237\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],contractId:[{required:!0,message:"\u5408\u540C\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],returnTime:[{required:!0,message:"\u56DE\u6B3E\u65E5\u671F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],price:[{required:!0,message:"\u56DE\u6B3E\u91D1\u989D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),g=c(),q=c([]),U=c([]),h=c([]);S({open:async(r,d,s)=>{var n;if(f.value=!0,R.value=k("action."+r),p.value=r,z(),d){v.value=!0;try{const o=await fe(d);a.value=o,await T(o.customerId),a.value.contractId=(n=o==null?void 0:o.contract)==null?void 0:n.id}finally{v.value=!1}}E.value=await _e(),q.value=await Ie(),p.value==="create"&&(a.value.ownerUserId=ee().getUser.id),s&&(a.value.customerId=s.customerId,await T(s.customerId),a.value.contractId=s.contractId,await x(s.contractId),s.id&&(a.value.planId=s.id,a.value.price=s.price,a.value.returnType=s.returnType))}});const D=A,j=async()=>{if(g&&await g.value.validate()){v.value=!0;try{const r=a.value;p.value==="create"?(await ve(r),C.success(k("common.createSuccess"))):(await be(r),C.success(k("common.updateSuccess"))),f.value=!1,D("success")}finally{v.value=!1}}},z=()=>{var r;a.value={},(r=g.value)==null||r.resetFields()},T=async r=>{a.value.contractId=void 0,r&&(U.value=[],U.value=await Ve(r))},x=async r=>{if(a.value.planId=void 0,r){h.value=[],h.value=await me(a.value.customerId,r);const d=U.value.find(s=>s.id===r);d&&(a.value.price=d.totalPrice-d.totalReceivablePrice)}},G=r=>{if(!r)return;const d=h.value.find(s=>s.id===r);d&&(a.value.price=d.price,a.value.returnType=d.returnType)};return(r,d)=>{const s=ae,n=le,o=ue,b=de,_=te,I=re,J=se,L=oe,M=ne,F=ie,N=pe,Q=ce;return i(),m(N,{modelValue:l(f),"onUpdate:modelValue":d[10]||(d[10]=e=>X(f)?f.value=e:null),title:l(R)},{footer:t(()=>[u(F,{disabled:l(v),type:"primary",onClick:j},{default:t(()=>[P("\u786E \u5B9A")]),_:1},8,["disabled"]),u(F,{onClick:d[9]||(d[9]=e=>f.value=!1)},{default:t(()=>[P("\u53D6 \u6D88")]),_:1})]),default:t(()=>[K((i(),m(M,{ref_key:"formRef",ref:g,model:l(a),rules:l(B),"label-width":"100px"},{default:t(()=>[u(I,null,{default:t(()=>[u(o,{span:12},{default:t(()=>[u(n,{label:"\u56DE\u6B3E\u7F16\u53F7",prop:"no"},{default:t(()=>[u(s,{modelValue:l(a).no,"onUpdate:modelValue":d[0]||(d[0]=e=>l(a).no=e),disabled:"",placeholder:"\u4FDD\u5B58\u65F6\u81EA\u52A8\u751F\u6210"},null,8,["modelValue"])]),_:1})]),_:1}),u(o,{span:12},{default:t(()=>[u(n,{label:"\u8D1F\u8D23\u4EBA",prop:"ownerUserId"},{default:t(()=>[u(_,{modelValue:l(a).ownerUserId,"onUpdate:modelValue":d[1]||(d[1]=e=>l(a).ownerUserId=e),disabled:l(p)!=="create",class:"w-1/1"},{default:t(()=>[(i(!0),V(w,null,y(l(E),e=>(i(),m(b,{key:e.id,label:e.nickname,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),u(I,null,{default:t(()=>[u(o,{span:12},{default:t(()=>[u(n,{label:"\u5BA2\u6237\u540D\u79F0",prop:"customerId"},{default:t(()=>[u(_,{modelValue:l(a).customerId,"onUpdate:modelValue":d[2]||(d[2]=e=>l(a).customerId=e),disabled:l(p)!=="create",class:"w-1/1",filterable:"",placeholder:"\u8BF7\u9009\u62E9\u5BA2\u6237",onChange:T},{default:t(()=>[(i(!0),V(w,null,y(l(q),e=>(i(),m(b,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),u(o,{span:12},{default:t(()=>[u(n,{label:"\u5408\u540C\u540D\u79F0",prop:"contractId"},{default:t(()=>[u(_,{modelValue:l(a).contractId,"onUpdate:modelValue":d[3]||(d[3]=e=>l(a).contractId=e),disabled:l(p)!=="create"||!l(a).customerId,class:"w-1/1",filterable:"",placeholder:"\u8BF7\u9009\u62E9\u5408\u540C",onChange:x},{default:t(()=>[(i(!0),V(w,null,y(l(U),e=>(i(),m(b,{key:e.id,disabled:e.auditStatus!==20,label:e.name,value:e.id},null,8,["disabled","label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),u(I,null,{default:t(()=>[u(o,{span:12},{default:t(()=>[u(n,{label:"\u56DE\u6B3E\u671F\u6570",prop:"planId"},{default:t(()=>[u(_,{modelValue:l(a).planId,"onUpdate:modelValue":d[4]||(d[4]=e=>l(a).planId=e),disabled:l(p)!=="create"||!l(a).contractId,class:"!w-1/1",placeholder:"\u8BF7\u9009\u62E9\u56DE\u6B3E\u671F\u6570",onChange:G},{default:t(()=>[(i(!0),V(w,null,y(l(h),e=>(i(),m(b,{key:e.id,disabled:e.receivableId,label:"\u7B2C "+e.period+" \u671F",value:e.id},null,8,["disabled","label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),u(o,{span:12},{default:t(()=>[u(n,{label:"\u56DE\u6B3E\u65B9\u5F0F",prop:"returnType"},{default:t(()=>[u(_,{modelValue:l(a).returnType,"onUpdate:modelValue":d[5]||(d[5]=e=>l(a).returnType=e),class:"w-1/1",placeholder:"\u8BF7\u9009\u62E9\u56DE\u6B3E\u65B9\u5F0F"},{default:t(()=>[(i(!0),V(w,null,y(l(O)(l(W).CRM_RECEIVABLE_RETURN_TYPE),e=>(i(),m(b,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),u(I,null,{default:t(()=>[u(o,{span:12},{default:t(()=>[u(n,{label:"\u56DE\u6B3E\u91D1\u989D",prop:"price"},{default:t(()=>[u(J,{modelValue:l(a).price,"onUpdate:modelValue":d[6]||(d[6]=e=>l(a).price=e),min:.01,precision:2,class:"!w-100%","controls-position":"right",placeholder:"\u8BF7\u8F93\u5165\u56DE\u6B3E\u91D1\u989D"},null,8,["modelValue"])]),_:1})]),_:1}),u(o,{span:12},{default:t(()=>[u(n,{label:"\u56DE\u6B3E\u65E5\u671F",prop:"returnTime"},{default:t(()=>[u(L,{modelValue:l(a).returnTime,"onUpdate:modelValue":d[7]||(d[7]=e=>l(a).returnTime=e),placeholder:"\u9009\u62E9\u56DE\u6B3E\u65E5\u671F",type:"date","value-format":"x",class:"!w-100%"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),u(I,null,{default:t(()=>[u(o,{span:24},{default:t(()=>[u(n,{label:"\u5907\u6CE8",prop:"remark"},{default:t(()=>[u(s,{modelValue:l(a).remark,"onUpdate:modelValue":d[8]||(d[8]=e=>l(a).remark=e),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])),[[Q,l(v)]])]),_:1},8,["modelValue","title"])}}});export{ye as _};
