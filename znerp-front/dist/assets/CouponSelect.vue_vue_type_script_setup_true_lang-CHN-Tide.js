import{d as Q,r as s,e as B,o as _,q as b,w as t,f as e,a as l,x as i,c as H,F as j,p as G,Q as W,D as d,y as X,t as Z,k as $,U as J,C as ee,A as le,B as ae,H as te,I as oe,J as pe,K as ue,L as ne,M as se}from"./index-CIfmhqRC.js";import{_ as re}from"./Dialog.vue_vue_type_style_index_0_lang-CtaLqQeX.js";import{_ as ie}from"./index.vue_vue_type_script_setup_true_lang-DYHi04Tm.js";import{_ as de}from"./DictTag.vue_vue_type_script_lang-CTpVFm77.js";import{_ as me}from"./ContentWrap.vue_vue_type_script_setup_true_lang-sm5dIhPQ.js";import{d as ce,v as fe,r as _e,t as ye}from"./formatter-DiQ-12RX.js";import{g as Te}from"./couponTemplate-CdzguE4M.js";const ve=Q({name:"CouponSelect",__name:"CouponSelect",props:{multipleSelection:{},takeType:{}},emits:["update:multipleSelection","change"],setup(U,{expose:x,emit:V}){const g=U,O=V,r=s(!1),I=s("\u9009\u62E9\u4F18\u60E0\u5377"),M=s(!1),y=s(!0),w=s(0),C=s([]),o=B({pageNo:1,pageSize:10,name:null,discountType:null,canTakeTypes:null}),m=s(),S=s([]),h=async()=>{y.value=!0;try{o.canTakeTypes=[g.takeType];const n=await Te(o);C.value=n.list,w.value=n.total}finally{y.value=!1}},T=()=>{o.pageNo=1,h()},k=()=>{var n;(n=m==null?void 0:m.value)==null||n.resetFields(),T()};x({open:async()=>{r.value=!0,k()}});const R=n=>{g.multipleSelection?O("update:multipleSelection",n):S.value=n},D=()=>{r.value=!1,O("change",S.value)};return(n,p)=>{const E=J,v=ee,z=le,A=ae,N=te,c=oe,F=pe,P=me,u=ue,f=de,K=ne,Y=ie,q=re,L=se;return _(),b(q,{modelValue:l(r),"onUpdate:modelValue":p[5]||(p[5]=a=>$(r)?r.value=a:null),title:l(I),width:"65%"},{footer:t(()=>[e(c,{disabled:l(M),type:"primary",onClick:D},{default:t(()=>[i("\u786E \u5B9A")]),_:1},8,["disabled"]),e(c,{onClick:p[4]||(p[4]=a=>r.value=!1)},{default:t(()=>[i("\u53D6 \u6D88")]),_:1})]),default:t(()=>[e(P,null,{default:t(()=>[e(F,{ref_key:"queryFormRef",ref:m,inline:!0,model:l(o),class:"-mb-15px","label-width":"82px"},{default:t(()=>[e(v,{label:"\u4F18\u60E0\u5238\u540D\u79F0",prop:"name"},{default:t(()=>[e(E,{modelValue:l(o).name,"onUpdate:modelValue":p[0]||(p[0]=a=>l(o).name=a),class:"!w-240px",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u4F18\u60E0\u52B5\u540D",onKeyup:T},null,8,["modelValue"])]),_:1}),e(v,{label:"\u4F18\u60E0\u7C7B\u578B",prop:"discountType"},{default:t(()=>[e(A,{modelValue:l(o).discountType,"onUpdate:modelValue":p[1]||(p[1]=a=>l(o).discountType=a),class:"!w-240px",clearable:"",placeholder:"\u8BF7\u9009\u62E9\u4F18\u60E0\u5238\u7C7B\u578B"},{default:t(()=>[(_(!0),H(j,null,G(l(W)(l(d).PROMOTION_DISCOUNT_TYPE),a=>(_(),b(z,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(v,null,{default:t(()=>[e(c,{onClick:T},{default:t(()=>[e(N,{class:"mr-5px",icon:"ep:search"}),i(" \u641C\u7D22 ")]),_:1}),e(c,{onClick:k},{default:t(()=>[e(N,{class:"mr-5px",icon:"ep:refresh"}),i(" \u91CD\u7F6E ")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(P,null,{default:t(()=>[X((_(),b(K,{data:l(C),onSelectionChange:R},{default:t(()=>[e(u,{type:"selection",width:"55"}),e(u,{label:"\u4F18\u60E0\u5238\u540D\u79F0","min-width":"140",prop:"name"}),e(u,{label:"\u7C7B\u578B","min-width":"80",prop:"productScope"},{default:t(a=>[e(f,{type:l(d).PROMOTION_PRODUCT_SCOPE,value:a.row.productScope},null,8,["type","value"])]),_:1}),e(u,{label:"\u4F18\u60E0","min-width":"100",prop:"discount"},{default:t(a=>[e(f,{type:l(d).PROMOTION_DISCOUNT_TYPE,value:a.row.discountType},null,8,["type","value"]),i(" "+Z(l(ce)(a.row)),1)]),_:1}),e(u,{label:"\u9886\u53D6\u65B9\u5F0F","min-width":"100",prop:"takeType"},{default:t(a=>[e(f,{type:l(d).PROMOTION_COUPON_TAKE_TYPE,value:a.row.takeType},null,8,["type","value"])]),_:1}),e(u,{formatter:l(fe),align:"center",label:"\u4F7F\u7528\u65F6\u95F4",prop:"validityType",width:"185"},null,8,["formatter"]),e(u,{align:"center",label:"\u53D1\u653E\u6570\u91CF",prop:"totalCount"}),e(u,{formatter:l(_e),align:"center",label:"\u5269\u4F59\u6570\u91CF",prop:"totalCount"},null,8,["formatter"]),e(u,{formatter:l(ye),align:"center",label:"\u9886\u53D6\u4E0A\u9650",prop:"takeLimitCount"},null,8,["formatter"]),e(u,{align:"center",label:"\u72B6\u6001",prop:"status"},{default:t(a=>[e(f,{type:l(d).COMMON_STATUS,value:a.row.status},null,8,["type","value"])]),_:1})]),_:1},8,["data"])),[[L,l(y)]]),e(Y,{limit:l(o).pageSize,"onUpdate:limit":p[2]||(p[2]=a=>l(o).pageSize=a),page:l(o).pageNo,"onUpdate:page":p[3]||(p[3]=a=>l(o).pageNo=a),total:l(w),onPagination:h},null,8,["limit","page","total"])]),_:1})]),_:1},8,["modelValue","title"])}}});export{ve as _};
