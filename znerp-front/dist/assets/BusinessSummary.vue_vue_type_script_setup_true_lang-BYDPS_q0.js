import{d as U,e as v,r as c,ar as L,u as j,n as z,o as _,c as E,f as e,w as l,a as t,y as F,q as K,x as N,t as C,dV as M,F as O,K as V,af as X,L as Z,M as G}from"./index-CIfmhqRC.js";import{_ as H}from"./index.vue_vue_type_script_setup_true_lang-DYHi04Tm.js";import{E as J}from"./el-card-DyMugU68.js";import{E as Q}from"./el-skeleton-item-Dm6LwaUQ.js";import{_ as R}from"./Echart.vue_vue_type_script_setup_true_lang-C-1NoClp.js";import{S as A}from"./funnel-DvnBhkJI.js";import{d as p}from"./formatTime-DFFN_xWx.js";const W=U({name:"BusinessSummary",__name:"BusinessSummary",props:{queryParams:{}},setup(P,{expose:S}){const u=P,o=v({pageNo:1,pageSize:10}),d=c(!1),f=c([]),g=c(0);L(()=>u.queryParams,s=>{if(!s)return;const i={...o,...s};Object.assign(o,i)},{immediate:!0});const r=v({grid:{left:30,right:30,bottom:20,containLabel:!0},legend:{},series:[{name:"\u65B0\u589E\u5546\u673A\u6570\u91CF",type:"bar",yAxisIndex:0,data:[]},{name:"\u65B0\u589E\u5546\u673A\u91D1\u989D",type:"bar",yAxisIndex:1,data:[]}],toolbox:{feature:{dataZoom:{xAxisIndex:!1},brush:{type:["lineX","clear"]},saveAsImage:{show:!0,name:"\u65B0\u589E\u5546\u673A\u5206\u6790"}}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},yAxis:[{type:"value",name:"\u65B0\u589E\u5546\u673A\u6570\u91CF",min:0,minInterval:1},{type:"value",name:"\u65B0\u589E\u5546\u673A\u91D1\u989D",min:0,minInterval:1,splitLine:{lineStyle:{type:"dotted",opacity:.7}}}],xAxis:{type:"category",name:"\u65E5\u671F",data:[]}}),x=async()=>{const s=await A.getBusinessPageByDate(u.queryParams);f.value=s.list,g.value=s.total},{push:y}=j(),w=async()=>{d.value=!0;try{await(async()=>{const s=await A.getBusinessSummaryByDate(u.queryParams);r.xAxis&&r.xAxis.data&&(r.xAxis.data=s.map(i=>i.time)),r.series&&r.series[0]&&r.series[0].data&&(r.series[0].data=s.map(i=>i.businessCreateCount)),r.series&&r.series[1]&&r.series[1].data&&(r.series[1].data=s.map(i=>i.totalPrice)),await x()})()}finally{d.value=!1}};return S({loadData:w}),z(()=>{w()}),(s,i)=>{const B=R,I=Q,h=J,a=V,b=X,D=Z,T=H,k=G;return _(),E(O,null,[e(h,{shadow:"never"},{default:l(()=>[e(I,{loading:t(d),animated:""},{default:l(()=>[e(B,{height:500,options:t(r)},null,8,["options"])]),_:1},8,["loading"])]),_:1}),e(h,{class:"mt-16px",shadow:"never"},{default:l(()=>[F((_(),K(D,{data:t(f)},{default:l(()=>[e(a,{align:"center",fixed:"left",label:"\u5E8F\u53F7",type:"index",width:"80"}),e(a,{align:"center",fixed:"left",label:"\u5546\u673A\u540D\u79F0",prop:"name",width:"160"},{default:l(n=>[e(b,{underline:!1,type:"primary",onClick:q=>{return m=n.row.id,void y({name:"CrmBusinessDetail",params:{id:m}});var m}},{default:l(()=>[N(C(n.row.name),1)]),_:2},1032,["onClick"])]),_:1}),e(a,{align:"center",fixed:"left",label:"\u5BA2\u6237\u540D\u79F0",prop:"customerName",width:"120"},{default:l(n=>[e(b,{underline:!1,type:"primary",onClick:q=>{return m=n.row.customerId,void y({name:"CrmCustomerDetail",params:{id:m}});var m}},{default:l(()=>[N(C(n.row.customerName),1)]),_:2},1032,["onClick"])]),_:1}),e(a,{formatter:t(M),align:"center",label:"\u5546\u673A\u91D1\u989D\uFF08\u5143\uFF09",prop:"totalPrice",width:"140"},null,8,["formatter"]),e(a,{formatter:t(p),align:"center",label:"\u9884\u8BA1\u6210\u4EA4\u65E5\u671F",prop:"dealTime",width:"180px"},null,8,["formatter"]),e(a,{align:"center",label:"\u5907\u6CE8",prop:"remark",width:"200"}),e(a,{formatter:t(p),align:"center",label:"\u4E0B\u6B21\u8054\u7CFB\u65F6\u95F4",prop:"contactNextTime",width:"180px"},null,8,["formatter"]),e(a,{align:"center",label:"\u8D1F\u8D23\u4EBA",prop:"ownerUserName",width:"100px"}),e(a,{align:"center",label:"\u6240\u5C5E\u90E8\u95E8",prop:"ownerUserDeptName",width:"100px"}),e(a,{formatter:t(p),align:"center",label:"\u6700\u540E\u8DDF\u8FDB\u65F6\u95F4",prop:"contactLastTime",width:"180px"},null,8,["formatter"]),e(a,{formatter:t(p),align:"center",label:"\u66F4\u65B0\u65F6\u95F4",prop:"updateTime",width:"180px"},null,8,["formatter"]),e(a,{formatter:t(p),align:"center",label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime",width:"180px"},null,8,["formatter"]),e(a,{align:"center",label:"\u521B\u5EFA\u4EBA",prop:"creatorName",width:"100px"}),e(a,{align:"center",fixed:"right",label:"\u5546\u673A\u72B6\u6001\u7EC4",prop:"statusTypeName",width:"140"}),e(a,{align:"center",fixed:"right",label:"\u5546\u673A\u9636\u6BB5",prop:"statusName",width:"120"})]),_:1},8,["data"])),[[k,t(d)]]),e(T,{limit:t(o).pageSize,"onUpdate:limit":i[0]||(i[0]=n=>t(o).pageSize=n),page:t(o).pageNo,"onUpdate:page":i[1]||(i[1]=n=>t(o).pageNo=n),total:t(g),onPagination:x},null,8,["limit","page","total"])]),_:1})],64)}}});export{W as _};
