import{d as B,h as H,z as K,r as g,e as W,o as i,q as s,w as t,f as o,a as l,x as c,y as X,c as b,F as k,p as x,Q as E,D as I,t as U,a5 as m,k as Z,aA as h,aC as w,aw as $,U as ee,C as le,ak as ae,al as de,cc as te,G as oe,J as ie,I as ue,M as re}from"./index-CIfmhqRC.js";import{_ as se}from"./Dialog.vue_vue_type_style_index_0_lang-CtaLqQeX.js";import{a as ce,c as pe,u as me}from"./couponTemplate-CdzguE4M.js";import{e as V,f as S,h as v}from"./constants-A8BI3pz7.js";import ne from"./SpuShowcase-DQavcwpZ.js";import{_ as ve}from"./ProductCategorySelect.vue_vue_type_script_setup_true_lang-Dn8UypNC.js";const ye=B({name:"CouponTemplateForm",__name:"CouponTemplateForm",emits:["success"],setup(Te,{expose:A,emit:D}){const{t:C}=H(),L=K(),y=g(!1),q=g(""),T=g(!1),O=g(""),e=g({id:void 0,name:void 0,discountType:V.PRICE.type,discountPrice:void 0,discountPercent:void 0,discountLimitPrice:void 0,usePrice:void 0,takeType:1,totalCount:void 0,takeLimitCount:void 0,validityType:S.DATE.type,validTimes:[],validStartTime:void 0,validEndTime:void 0,fixedStartTerm:void 0,fixedEndTerm:void 0,productScope:v.ALL.scope,description:void 0,productScopeValues:[],productCategoryIds:[],productSpuIds:[]}),N=W({name:[{required:!0,message:"\u4F18\u60E0\u5238\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],discountType:[{required:!0,message:"\u4F18\u60E0\u5238\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],discountPrice:[{required:!0,message:"\u4F18\u60E0\u5238\u9762\u989D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],discountPercent:[{required:!0,message:"\u4F18\u60E0\u5238\u6298\u6263\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],discountLimitPrice:[{required:!0,message:"\u6700\u591A\u4F18\u60E0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],usePrice:[{required:!0,message:"\u6EE1\u591A\u5C11\u5143\u53EF\u4EE5\u4F7F\u7528\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],takeType:[{required:!0,message:"\u9886\u53D6\u65B9\u5F0F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],totalCount:[{required:!0,message:"\u53D1\u653E\u6570\u91CF\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],takeLimitCount:[{required:!0,message:"\u6BCF\u4EBA\u9650\u9886\u4E2A\u6570\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],validityType:[{required:!0,message:"\u6709\u6548\u671F\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],validTimes:[{required:!0,message:"\u56FA\u5B9A\u65E5\u671F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],fixedStartTerm:[{required:!0,message:"\u5F00\u59CB\u9886\u53D6\u5929\u6570\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],fixedEndTerm:[{required:!0,message:"\u5F00\u59CB\u9886\u53D6\u5929\u6570\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],productScope:[{required:!0,message:"\u5546\u54C1\u8303\u56F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],productSpuIds:[{required:!0,message:"\u5546\u54C1\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],productCategoryIds:[{required:!0,message:"\u5206\u7C7B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),P=g();A({open:async(u,d)=>{if(y.value=!0,q.value=C("action."+u),O.value=u,G(),d){T.value=!0;try{const p=await ce(d);e.value={...p,discountPrice:h(p.discountPrice),discountPercent:p.discountPercent!==void 0?p.discountPercent/10:void 0,discountLimitPrice:h(p.discountLimitPrice),usePrice:h(p.usePrice),validTimes:[p.validStartTime,p.validEndTime]},await F()}finally{T.value=!1}}}});const Y=D,M=async()=>{if(P&&await P.value.validate()){T.value=!0;try{const u={...e.value,discountPrice:w(e.value.discountPrice),discountPercent:e.value.discountPercent!==void 0?10*e.value.discountPercent:void 0,discountLimitPrice:w(e.value.discountLimitPrice),usePrice:w(e.value.usePrice),validStartTime:e.value.validTimes&&e.value.validTimes.length===2?e.value.validTimes[0]:void 0,validEndTime:e.value.validTimes&&e.value.validTimes.length===2?e.value.validTimes[1]:void 0};(function(d){switch(e.value.productScope){case v.SPU.scope:d.productScopeValues=e.value.productSpuIds;break;case v.CATEGORY.scope:d.productScopeValues=Array.isArray(e.value.productCategoryIds)?e.value.productCategoryIds:[e.value.productCategoryIds]}})(u),O.value==="create"?(await pe(u),L.success(C("common.createSuccess"))):(await me(u),L.success(C("common.updateSuccess"))),y.value=!1,Y("success")}finally{T.value=!1}}},G=()=>{var u;e.value={id:void 0,name:void 0,description:void 0,discountType:V.PRICE.type,discountPrice:void 0,discountPercent:void 0,discountLimitPrice:void 0,usePrice:void 0,takeType:1,totalCount:void 0,takeLimitCount:void 0,validityType:S.DATE.type,validTimes:[],validStartTime:void 0,validEndTime:void 0,fixedStartTerm:void 0,fixedEndTerm:void 0,productScope:v.ALL.scope,productScopeValues:[],productSpuIds:[],productCategoryIds:[]},(u=P.value)==null||u.resetFields()},F=async()=>{switch(e.value.productScope){case v.SPU.scope:e.value.productSpuIds=e.value.productScopeValues;break;case v.CATEGORY.scope:await $(()=>{let u=e.value.productScopeValues;Array.isArray(u)&&u.length>0&&(u=u[0]),e.value.productCategoryIds=u})}};return(u,d)=>{const p=ee,r=le,f=ae,_=de,n=te,z=oe,J=ie,R=ue,Q=se,j=re;return i(),s(Q,{modelValue:l(y),"onUpdate:modelValue":d[18]||(d[18]=a=>Z(y)?y.value=a:null),title:l(q)},{footer:t(()=>[o(R,{disabled:l(T),type:"primary",onClick:M},{default:t(()=>[c("\u786E \u5B9A")]),_:1},8,["disabled"]),o(R,{onClick:d[17]||(d[17]=a=>y.value=!1)},{default:t(()=>[c("\u53D6 \u6D88")]),_:1})]),default:t(()=>[X((i(),s(J,{ref_key:"formRef",ref:P,model:l(e),rules:l(N),"label-width":"140px"},{default:t(()=>[o(r,{label:"\u4F18\u60E0\u5238\u540D\u79F0",prop:"name"},{default:t(()=>[o(p,{modelValue:l(e).name,"onUpdate:modelValue":d[0]||(d[0]=a=>l(e).name=a),placeholder:"\u8BF7\u8F93\u5165\u4F18\u60E0\u5238\u540D\u79F0"},null,8,["modelValue"])]),_:1}),o(r,{label:"\u4F18\u60E0\u5238\u63CF\u8FF0",prop:"description"},{default:t(()=>[o(p,{modelValue:l(e).description,"onUpdate:modelValue":d[1]||(d[1]=a=>l(e).description=a),autosize:{minRows:2,maxRows:2},clearable:!0,"show-word-limit":!0,class:"w-1/1!",maxlength:"512",placeholder:"\u8BF7\u8F93\u5165\u4F18\u60E0\u5238\u63CF\u8FF0",type:"textarea"},null,8,["modelValue"])]),_:1}),o(r,{label:"\u4F18\u60E0\u52B5\u7C7B\u578B",prop:"productScope"},{default:t(()=>[o(_,{modelValue:l(e).productScope,"onUpdate:modelValue":d[2]||(d[2]=a=>l(e).productScope=a)},{default:t(()=>[(i(!0),b(k,null,x(l(E)(l(I).PROMOTION_PRODUCT_SCOPE),a=>(i(),s(f,{key:a.value,value:a.value},{default:t(()=>[c(U(a.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(e).productScope===l(v).SPU.scope?(i(),s(r,{key:0,label:"\u5546\u54C1",prop:"productSpuIds"},{default:t(()=>[o(ne,{modelValue:l(e).productSpuIds,"onUpdate:modelValue":d[3]||(d[3]=a=>l(e).productSpuIds=a)},null,8,["modelValue"])]),_:1})):m("",!0),l(e).productScope===l(v).CATEGORY.scope?(i(),s(r,{key:1,label:"\u5206\u7C7B",prop:"productCategoryIds"},{default:t(()=>[o(ve,{modelValue:l(e).productCategoryIds,"onUpdate:modelValue":d[4]||(d[4]=a=>l(e).productCategoryIds=a)},null,8,["modelValue"])]),_:1})):m("",!0),o(r,{label:"\u4F18\u60E0\u7C7B\u578B",prop:"discountType"},{default:t(()=>[o(_,{modelValue:l(e).discountType,"onUpdate:modelValue":d[5]||(d[5]=a=>l(e).discountType=a)},{default:t(()=>[(i(!0),b(k,null,x(l(E)(l(I).PROMOTION_DISCOUNT_TYPE),a=>(i(),s(f,{key:a.value,value:a.value},{default:t(()=>[c(U(a.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(e).discountType===l(V).PRICE.type?(i(),s(r,{key:2,label:"\u4F18\u60E0\u5238\u9762\u989D",prop:"discountPrice"},{default:t(()=>[o(n,{modelValue:l(e).discountPrice,"onUpdate:modelValue":d[6]||(d[6]=a=>l(e).discountPrice=a),min:0,precision:2,class:"mr-2 !w-400px",placeholder:"\u8BF7\u8F93\u5165\u4F18\u60E0\u91D1\u989D\uFF0C\u5355\u4F4D\uFF1A\u5143"},null,8,["modelValue"]),c(" \u5143 ")]),_:1})):m("",!0),l(e).discountType===l(V).PERCENT.type?(i(),s(r,{key:3,label:"\u4F18\u60E0\u5238\u6298\u6263",prop:"discountPercent"},{default:t(()=>[o(n,{modelValue:l(e).discountPercent,"onUpdate:modelValue":d[7]||(d[7]=a=>l(e).discountPercent=a),max:9.9,min:1,precision:1,class:"mr-2 !w-400px",placeholder:"\u4F18\u60E0\u5238\u6298\u6263\u4E0D\u80FD\u5C0F\u4E8E 1 \u6298\uFF0C\u4E14\u4E0D\u53EF\u5927\u4E8E 9.9 \u6298"},null,8,["modelValue"]),c(" \u6298 ")]),_:1})):m("",!0),l(e).discountType===l(V).PERCENT.type?(i(),s(r,{key:4,label:"\u6700\u591A\u4F18\u60E0",prop:"discountLimitPrice"},{default:t(()=>[o(n,{modelValue:l(e).discountLimitPrice,"onUpdate:modelValue":d[8]||(d[8]=a=>l(e).discountLimitPrice=a),min:0,precision:2,class:"mr-2 !w-400px",placeholder:"\u8BF7\u8F93\u5165\u6700\u591A\u4F18\u60E0"},null,8,["modelValue"]),c(" \u5143 ")]),_:1})):m("",!0),o(r,{label:"\u6EE1\u591A\u5C11\u5143\u53EF\u4EE5\u4F7F\u7528",prop:"usePrice"},{default:t(()=>[o(n,{modelValue:l(e).usePrice,"onUpdate:modelValue":d[9]||(d[9]=a=>l(e).usePrice=a),min:0,precision:2,class:"mr-2 !w-400px",placeholder:"\u65E0\u95E8\u69DB\u8BF7\u8BBE\u4E3A 0"},null,8,["modelValue"]),c(" \u5143 ")]),_:1}),o(r,{label:"\u9886\u53D6\u65B9\u5F0F",prop:"takeType"},{default:t(()=>[o(_,{modelValue:l(e).takeType,"onUpdate:modelValue":d[10]||(d[10]=a=>l(e).takeType=a)},{default:t(()=>[(i(),s(f,{key:1,value:1},{default:t(()=>[c("\u76F4\u63A5\u9886\u53D6")]),_:1})),(i(),s(f,{key:2,value:2},{default:t(()=>[c("\u6307\u5B9A\u53D1\u653E")]),_:1}))]),_:1},8,["modelValue"])]),_:1}),l(e).takeType===1?(i(),s(r,{key:5,label:"\u53D1\u653E\u6570\u91CF",prop:"totalCount"},{default:t(()=>[o(n,{modelValue:l(e).totalCount,"onUpdate:modelValue":d[11]||(d[11]=a=>l(e).totalCount=a),min:-1,precision:0,class:"mr-2 !w-400px",placeholder:"\u53D1\u653E\u6570\u91CF\uFF0C\u6CA1\u6709\u4E4B\u540E\u4E0D\u80FD\u9886\u53D6\u6216\u53D1\u653E\uFF0C-1 \u4E3A\u4E0D\u9650\u5236"},null,8,["modelValue"]),c(" \u5F20 ")]),_:1})):m("",!0),l(e).takeType===1?(i(),s(r,{key:6,label:"\u6BCF\u4EBA\u9650\u9886\u4E2A\u6570",prop:"takeLimitCount"},{default:t(()=>[o(n,{modelValue:l(e).takeLimitCount,"onUpdate:modelValue":d[12]||(d[12]=a=>l(e).takeLimitCount=a),min:-1,precision:0,class:"mr-2 !w-400px",placeholder:"\u8BBE\u7F6E\u4E3A -1 \u65F6\uFF0C\u53EF\u65E0\u9650\u9886\u53D6"},null,8,["modelValue"]),c(" \u5F20 ")]),_:1})):m("",!0),o(r,{label:"\u6709\u6548\u671F\u7C7B\u578B",prop:"validityType"},{default:t(()=>[o(_,{modelValue:l(e).validityType,"onUpdate:modelValue":d[13]||(d[13]=a=>l(e).validityType=a)},{default:t(()=>[(i(!0),b(k,null,x(l(E)(l(I).PROMOTION_COUPON_TEMPLATE_VALIDITY_TYPE),a=>(i(),s(f,{key:a.value,value:a.value},{default:t(()=>[c(U(a.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(e).validityType===l(S).DATE.type?(i(),s(r,{key:7,label:"\u56FA\u5B9A\u65E5\u671F",prop:"validTimes"},{default:t(()=>[o(z,{modelValue:l(e).validTimes,"onUpdate:modelValue":d[14]||(d[14]=a=>l(e).validTimes=a),"default-time":[new Date(2e3,1,1,0,0,0),new Date(2e3,2,1,23,59,59)],type:"datetimerange","value-format":"x"},null,8,["modelValue","default-time"])]),_:1})):m("",!0),l(e).validityType===l(S).TERM.type?(i(),s(r,{key:8,label:"\u9886\u53D6\u65E5\u671F",prop:"fixedStartTerm"},{default:t(()=>[c(" \u7B2C "),o(n,{modelValue:l(e).fixedStartTerm,"onUpdate:modelValue":d[15]||(d[15]=a=>l(e).fixedStartTerm=a),min:0,precision:0,class:"mx-2",placeholder:"0 \u4E3A\u4ECA\u5929\u751F\u6548"},null,8,["modelValue"]),c(" \u81F3 "),o(n,{modelValue:l(e).fixedEndTerm,"onUpdate:modelValue":d[16]||(d[16]=a=>l(e).fixedEndTerm=a),min:0,precision:0,class:"mx-2",placeholder:"\u8BF7\u8F93\u5165\u7ED3\u675F\u5929\u6570"},null,8,["modelValue"]),c(" \u5929\u6709\u6548 ")]),_:1})):m("",!0)]),_:1},8,["model","rules"])),[[j,l(T)]])]),_:1},8,["modelValue","title"])}}});export{ye as _};
