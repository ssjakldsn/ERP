import{bt as d,d as N,r as f,N as R,n as S,ar as x,o as u,q as I,w as m,f as l,g as h,t as L,c as v,x as w,F as U,a as j,z,K as F,L as K}from"./index-CIfmhqRC.js";import{_ as P}from"./XTextButton-eNQK5rLc.js";import{S as g}from"./constants-A8BI3pz7.js";import{g as $}from"./profile-BKsNLFSW.js";const A=["src"],B={class:"mr-5"},D=N({name:"UserSocial",__name:"UserSocial",props:{activeName:{}},emits:["update:activeName"],setup(E,{emit:k}){const y=z(),n=f([]),r=f(),c=R(),C=k,_=()=>{const a=(s="type",new URL(decodeURIComponent(location.href)).searchParams.get(s)??"");var s;const e=c.query.code,t=c.query.state;e&&((i,o,p)=>d.post({url:"/system/social-user/bind",data:{type:i,code:o,state:p}}))(a,e,t).then(()=>{y.success("\u7ED1\u5B9A\u6210\u529F"),C("update:activeName","userSocial")})},b=a=>{const s=location.origin+"/user/profile?"+encodeURIComponent(`type=${a.type}`);((e,t)=>d.get({url:"/system/auth/social-auth-redirect?type="+e+"&redirectUri="+t}))(a.type,encodeURIComponent(s)).then(e=>{window.location.href=e})},q=async a=>{var s,e;await(s=a.type,e=a.openid,d.delete({url:"/system/social-user/unbind",data:{type:s,openid:e}}))&&(a.openid=void 0),y.success("\u89E3\u7ED1\u6210\u529F")};return S(async()=>{await(async()=>{var s;n.value=[];const a=await $();r.value=a;for(const e in g){const t={...g[e]};if(n.value.push(t),(s=r.value)==null?void 0:s.socialUsers){for(const i in r.value.socialUsers)if(t.type===r.value.socialUsers[i].type){t.openid=r.value.socialUsers[i].openid;break}}}})()}),x(()=>c,()=>{_()},{immediate:!0}),(a,s)=>{const e=F,t=P,i=K;return u(),I(i,{data:j(n),"show-header":!1},{default:m(()=>[l(e,{fixed:"left",title:"\u5E8F\u53F7",type:"seq",width:"60"}),l(e,{align:"left",label:"\u793E\u4EA4\u5E73\u53F0",width:"120"},{default:m(({row:o})=>[h("img",{src:o.img,alt:"",class:"h-5 align-middle"},null,8,A),h("p",B,L(o.title),1)]),_:1}),l(e,{align:"center",label:"\u64CD\u4F5C"},{default:m(({row:o})=>[o.openid?(u(),v(U,{key:0},[w(" \u5DF2\u7ED1\u5B9A "),l(t,{class:"mr-5",title:"(\u89E3\u7ED1)",type:"primary",onClick:p=>q(o)},null,8,["onClick"])],64)):(u(),v(U,{key:1},[w(" \u672A\u7ED1\u5B9A "),l(t,{class:"mr-5",title:"(\u7ED1\u5B9A)",type:"primary",onClick:p=>b(o)},null,8,["onClick"])],64))]),_:1})]),_:1},8,["data"])}}});export{D as _};
