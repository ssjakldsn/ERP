import{_ as L}from"./Dialog.vue_vue_type_style_index_0_lang-CtaLqQeX.js";import{d as O,z as R,r as u,o as y,q as C,w as o,f as n,a as i,x,g as d,k as _,c as A,F as E,p as G,b as J,aw as K,A as M,B as P,H as Q,ae as T,af as W,br as X,I as Y}from"./index-CIfmhqRC.js";import{k as Z,m as $}from"./index-BZptzjxi.js";import{d as ee}from"./download-D5Lb_h0f.js";import{g as ae}from"./index-QrlE36WK.js";const le={class:"flex items-center my-10px"},se=d("span",{class:"mr-10px"},"\u8D1F\u8D23\u4EBA",-1),te=d("div",{class:"el-upload__text"},[x("\u5C06\u6587\u4EF6\u62D6\u5230\u6B64\u5904\uFF0C\u6216"),d("em",null,"\u70B9\u51FB\u4E0A\u4F20")],-1),oe={class:"el-upload__tip text-center"},re={class:"el-upload__tip"},ue=d("span",null,"\u4EC5\u5141\u8BB8\u5BFC\u5165 xls\u3001xlsx \u683C\u5F0F\u6587\u4EF6\u3002",-1),ne=O({name:"SystemUserImportForm",__name:"CustomerImportForm",emits:["success"],setup(ie,{expose:V,emit:k}){const f=R(),m=u(!1),r=u(!1),g=u(),p=u([]),v=u(!1),c=u(),w=u([]);V({open:async()=>{m.value=!0,await I(),w.value=await ae(),c.value=J().getUser.id}});const N=async()=>{if(p.value.length!=0){r.value=!0;try{const a=new FormData;a.append("updateSupport",String(v.value)),a.append("file",p.value[0].raw),a.append("ownerUserId",String(c.value));const e=await Z(a);h(e)}catch{F()}finally{r.value=!1}}else f.error("\u8BF7\u4E0A\u4F20\u6587\u4EF6")},U=k,h=a=>{if(a.code!==0)return f.error(a.msg),void(r.value=!1);const e=a.data;let s="\u4E0A\u4F20\u6210\u529F\u6570\u91CF\uFF1A"+e.createCustomerNames.length+";";for(let t of e.createCustomerNames)s+="< "+t+" >";s+="\u66F4\u65B0\u6210\u529F\u6570\u91CF\uFF1A"+e.updateCustomerNames.length+";";for(const t of e.updateCustomerNames)s+="< "+t+" >";s+="\u66F4\u65B0\u5931\u8D25\u6570\u91CF\uFF1A"+Object.keys(e.failureCustomerNames).length+";";for(const t in e.failureCustomerNames)s+="< "+t+": "+e.failureCustomerNames[t]+" >";f.alert(s),r.value=!1,m.value=!1,U("success")},F=()=>{f.error("\u4E0A\u4F20\u5931\u8D25\uFF0C\u8BF7\u60A8\u91CD\u65B0\u4E0A\u4F20\uFF01"),r.value=!1},I=async()=>{var a;p.value=[],v.value=!1,c.value=void 0,await K(),(a=g.value)==null||a.clearFiles()},S=()=>{f.error("\u6700\u591A\u53EA\u80FD\u4E0A\u4F20\u4E00\u4E2A\u6587\u4EF6\uFF01")},q=async()=>{const a=await $();ee.excel(a,"\u5BA2\u6237\u5BFC\u5165\u6A21\u7248.xls")};return(a,e)=>{const s=M,t=P,z=Q,j=T,B=W,D=X,b=Y,H=L;return y(),C(H,{modelValue:i(m),"onUpdate:modelValue":e[4]||(e[4]=l=>_(m)?m.value=l:null),title:"\u5BA2\u6237\u5BFC\u5165",width:"400"},{footer:o(()=>[n(b,{disabled:i(r),type:"primary",onClick:N},{default:o(()=>[x("\u786E \u5B9A")]),_:1},8,["disabled"]),n(b,{onClick:e[3]||(e[3]=l=>m.value=!1)},{default:o(()=>[x("\u53D6 \u6D88")]),_:1})]),default:o(()=>[d("div",le,[se,n(t,{modelValue:i(c),"onUpdate:modelValue":e[0]||(e[0]=l=>_(c)?c.value=l:null),class:"!w-240px",clearable:""},{default:o(()=>[(y(!0),A(E,null,G(i(w),l=>(y(),C(s,{key:l.id,label:l.nickname,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),n(D,{ref_key:"uploadRef",ref:g,"file-list":i(p),"onUpdate:fileList":e[2]||(e[2]=l=>_(p)?p.value=l:null),"auto-upload":!1,disabled:i(r),limit:1,"on-exceed":S,accept:".xlsx, .xls",action:"none",drag:""},{tip:o(()=>[d("div",oe,[d("div",re,[n(j,{modelValue:i(v),"onUpdate:modelValue":e[1]||(e[1]=l=>_(v)?v.value=l:null)},null,8,["modelValue"]),x(" \u662F\u5426\u66F4\u65B0\u5DF2\u7ECF\u5B58\u5728\u7684\u5BA2\u6237\u6570\u636E\uFF08\u201C\u5BA2\u6237\u540D\u79F0\u201D\u91CD\u590D\uFF09 ")]),ue,n(B,{underline:!1,style:{"font-size":"12px","vertical-align":"baseline"},type:"primary",onClick:q},{default:o(()=>[x(" \u4E0B\u8F7D\u6A21\u677F ")]),_:1})])]),default:o(()=>[n(z,{icon:"ep:upload"}),te]),_:1},8,["file-list","disabled"])]),_:1},8,["modelValue"])}}});export{ne as _};
