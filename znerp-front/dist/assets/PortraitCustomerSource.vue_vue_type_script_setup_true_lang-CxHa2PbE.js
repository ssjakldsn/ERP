import{d as L,r as b,e as g,n as W,o as C,c as T,f as e,w as o,a as s,y as q,q as j,D as p,F as z,aE as _,ay as A,em as w,ek as v,E as D,j as I,K as k,L as F,M as K}from"./index-CIfmhqRC.js";import{_ as B}from"./DictTag.vue_vue_type_script_lang-CTpVFm77.js";import{E as G}from"./el-card-DyMugU68.js";import{E as H}from"./el-skeleton-item-Dm6LwaUQ.js";import{_ as J}from"./Echart.vue_vue_type_script_setup_true_lang-C-1NoClp.js";import{S as N}from"./portrait-CaDgKbEx.js";const Q=L({name:"PortraitCustomerSource",__name:"PortraitCustomerSource",props:{queryParams:{}},setup(S,{expose:y}){const R=S,i=b(!1),c=b([]),n=g({title:{text:"\u5168\u90E8\u5BA2\u6237",left:"center"},tooltip:{trigger:"item"},legend:{orient:"vertical",left:"left"},toolbox:{feature:{saveAsImage:{show:!0,name:"\u5168\u90E8\u5BA2\u6237"}}},series:[{name:"\u5168\u90E8\u5BA2\u6237",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:40,fontWeight:"bold"}},labelLine:{show:!1},data:[]}]}),u=g({title:{text:"\u6210\u4EA4\u5BA2\u6237",left:"center"},tooltip:{trigger:"item"},legend:{orient:"vertical",left:"left"},toolbox:{feature:{saveAsImage:{show:!0,name:"\u6210\u4EA4\u5BA2\u6237"}}},series:[{name:"\u6210\u4EA4\u5BA2\u6237",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:40,fontWeight:"bold"}},labelLine:{show:!1},data:[]}]}),f=async()=>{i.value=!0;const r=await N.getCustomerSource(R.queryParams);n.series&&n.series[0]&&n.series[0].data&&(n.series[0].data=r.map(t=>({name:_(p.CRM_CUSTOMER_SOURCE,t.source),value:t.customerCount}))),u.series&&u.series[0]&&u.series[0].data&&(u.series[0].data=r.map(t=>({name:_(p.CRM_CUSTOMER_SOURCE,t.source),value:t.dealCount}))),E(r),c.value=r,i.value=!1};y({loadData:f});const E=r=>{if(A(r))return;const t=r,d=w(t.map(a=>a.customerCount)),m=w(t.map(a=>a.dealCount));t.forEach(a=>{a.sourcePortion=a.customerCount===0?0:v(a.customerCount,d),a.dealPortion=a.dealCount===0?0:v(a.dealCount,m)})};return W(()=>{f()}),(r,t)=>{const d=J,m=H,a=D,x=I,h=G,l=k,O=B,P=F,M=K;return C(),T(z,null,[e(h,{shadow:"never"},{default:o(()=>[e(x,{gutter:20},{default:o(()=>[e(a,{span:12},{default:o(()=>[e(m,{loading:s(i),animated:""},{default:o(()=>[e(d,{height:500,options:s(n)},null,8,["options"])]),_:1},8,["loading"])]),_:1}),e(a,{span:12},{default:o(()=>[e(m,{loading:s(i),animated:""},{default:o(()=>[e(d,{height:500,options:s(u)},null,8,["options"])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1}),e(h,{class:"mt-16px",shadow:"never"},{default:o(()=>[q((C(),j(P,{data:s(c)},{default:o(()=>[e(l,{align:"center",label:"\u5E8F\u53F7",type:"index",width:"80"}),e(l,{align:"center",label:"\u5BA2\u6237\u6765\u6E90",prop:"source",width:"100"},{default:o(U=>[e(O,{type:s(p).CRM_CUSTOMER_SOURCE,value:U.row.source},null,8,["type","value"])]),_:1}),e(l,{align:"center",label:"\u5BA2\u6237\u4E2A\u6570","min-width":"200",prop:"customerCount"}),e(l,{align:"center",label:"\u6210\u4EA4\u4E2A\u6570","min-width":"200",prop:"dealCount"}),e(l,{align:"center",label:"\u6765\u6E90\u5360\u6BD4(%)","min-width":"200",prop:"sourcePortion"}),e(l,{align:"center",label:"\u6210\u4EA4\u5360\u6BD4(%)","min-width":"200",prop:"dealPortion"})]),_:1},8,["data"])),[[M,s(i)]])]),_:1})],64)}}});export{Q as _};
