import{bt as w,d as K,r as n,e as N,o as m,c as R,f as e,w as o,a as l,x as v,y as X,q as y,F as T,p as Z,Q as $,D as ee,a5 as F,k as ae,h as le,z as se,A as oe,B as te,C as ue,E as de,G as re,U as ce,cm as ne,cn as pe,H as ie,I as me,j as fe,J as be,M as _e}from"./index-CIfmhqRC.js";import{_ as ve}from"./Dialog.vue_vue_type_style_index_0_lang-CtaLqQeX.js";import{B as k}from"./index-8CYEcIk3.js";import{_ as ye}from"./FollowUpRecordBusinessForm.vue_vue_type_script_setup_true_lang-DxrArb3L.js";import{_ as Ue}from"./FollowUpRecordContactForm.vue_vue_type_script_setup_true_lang-DLVeCN1i.js";import{_ as we}from"./BusinessListModal.vue_vue_type_script_setup_true_lang-DoLUy-ZT.js";import{_ as Ve}from"./ContactListModal.vue_vue_type_script_setup_true_lang-KXTfVMT0.js";const z={getFollowUpRecordPage:async p=>await w.get({url:"/crm/follow-up-record/page",params:p}),createFollowUpRecord:async p=>await w.post({url:"/crm/follow-up-record/create",data:p}),deleteFollowUpRecord:async p=>await w.delete({url:"/crm/follow-up-record/delete?id="+p})},ge=K({name:"FollowUpRecordForm",__name:"FollowUpRecordForm",emits:["success"],setup(p,{expose:h,emit:C}){const{t:I}=le(),S=se(),i=n(!1);n("");const b=n(!1),a=n({bizType:void 0,bizId:void 0,businesses:[],contacts:[]}),E=N({type:[{required:!0,message:"\u8DDF\u8FDB\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],content:[{required:!0,message:"\u8DDF\u8FDB\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],nextTime:[{required:!0,message:"\u4E0B\u6B21\u8054\u7CFB\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),U=n();h({open:async(u,s)=>{i.value=!0,D(),a.value.bizType=u,a.value.bizId=s}});const M=C,O=async()=>{await U.value.validate(),b.value=!0;try{const u={...a.value,contactIds:a.value.contacts.map(s=>s.id),businessIds:a.value.businesses.map(s=>s.id)};await z.createFollowUpRecord(u),S.success(I("common.createSuccess")),i.value=!1,M("success")}finally{b.value=!1}},V=n(),q=()=>{var u;(u=V.value)==null||u.open()},P=(u,s)=>{s.forEach(d=>{a.value.contacts.some(f=>f.id===d.id)||a.value.contacts.push(d)})},g=n(),A=()=>{var u;(u=g.value)==null||u.open()},B=(u,s)=>{s.forEach(d=>{a.value.businesses.some(f=>f.id===d.id)||a.value.businesses.push(d)})},D=()=>{var u;(u=U.value)==null||u.resetFields(),a.value={bizId:void 0,bizType:void 0,businesses:[],contacts:[]}};return(u,s)=>{const d=oe,f=te,r=ue,c=de,L=re,Y=ce,j=ne,G=pe,x=ie,_=me,H=fe,J=be,Q=ve,W=_e;return m(),R(T,null,[e(Q,{modelValue:l(i),"onUpdate:modelValue":s[6]||(s[6]=t=>ae(i)?i.value=t:null),title:"\u6DFB\u52A0\u8DDF\u8FDB\u8BB0\u5F55",width:"50%"},{footer:o(()=>[e(_,{disabled:l(b),type:"primary",onClick:O},{default:o(()=>[v("\u786E \u5B9A")]),_:1},8,["disabled"]),e(_,{onClick:s[5]||(s[5]=t=>i.value=!1)},{default:o(()=>[v("\u53D6 \u6D88")]),_:1})]),default:o(()=>[X((m(),y(J,{ref_key:"formRef",ref:U,model:l(a),rules:l(E),"label-width":"120px"},{default:o(()=>[e(H,null,{default:o(()=>[e(c,{span:12},{default:o(()=>[e(r,{label:"\u8DDF\u8FDB\u7C7B\u578B",prop:"type"},{default:o(()=>[e(f,{modelValue:l(a).type,"onUpdate:modelValue":s[0]||(s[0]=t=>l(a).type=t),placeholder:"\u8BF7\u9009\u62E9\u8DDF\u8FDB\u7C7B\u578B"},{default:o(()=>[(m(!0),R(T,null,Z(l($)(l(ee).CRM_FOLLOW_UP_TYPE),t=>(m(),y(d,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(c,{span:12},{default:o(()=>[e(r,{label:"\u4E0B\u6B21\u8054\u7CFB\u65F6\u95F4",prop:"nextTime"},{default:o(()=>[e(L,{modelValue:l(a).nextTime,"onUpdate:modelValue":s[1]||(s[1]=t=>l(a).nextTime=t),placeholder:"\u9009\u62E9\u4E0B\u6B21\u8054\u7CFB\u65F6\u95F4",type:"date","value-format":"x"},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:24},{default:o(()=>[e(r,{label:"\u8DDF\u8FDB\u5185\u5BB9",prop:"content"},{default:o(()=>[e(Y,{modelValue:l(a).content,"onUpdate:modelValue":s[2]||(s[2]=t=>l(a).content=t),rows:3,type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:12},{default:o(()=>[e(r,{label:"\u56FE\u7247",prop:"picUrls"},{default:o(()=>[e(j,{modelValue:l(a).picUrls,"onUpdate:modelValue":s[3]||(s[3]=t=>l(a).picUrls=t),class:"min-w-80px"},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:12},{default:o(()=>[e(r,{label:"\u9644\u4EF6",prop:"fileUrls"},{default:o(()=>[e(G,{modelValue:l(a).fileUrls,"onUpdate:modelValue":s[4]||(s[4]=t=>l(a).fileUrls=t),class:"min-w-80px"},null,8,["modelValue"])]),_:1})]),_:1}),l(a).bizType==l(k).CRM_CUSTOMER?(m(),y(c,{key:0,span:24},{default:o(()=>[e(r,{label:"\u5173\u8054\u8054\u7CFB\u4EBA",prop:"contactIds"},{default:o(()=>[e(_,{onClick:q},{default:o(()=>[e(x,{class:"mr-5px",icon:"ep:plus"}),v(" \u6DFB\u52A0\u8054\u7CFB\u4EBA ")]),_:1}),e(Ue,{contacts:l(a).contacts},null,8,["contacts"])]),_:1})]),_:1})):F("",!0),l(a).bizType==l(k).CRM_CUSTOMER?(m(),y(c,{key:1,span:24},{default:o(()=>[e(r,{label:"\u5173\u8054\u5546\u673A",prop:"businessIds"},{default:o(()=>[e(_,{onClick:A},{default:o(()=>[e(x,{class:"mr-5px",icon:"ep:plus"}),v(" \u6DFB\u52A0\u5546\u673A ")]),_:1}),e(ye,{businesses:l(a).businesses},null,8,["businesses"])]),_:1})]),_:1})):F("",!0)]),_:1})]),_:1},8,["model","rules"])),[[W,l(b)]])]),_:1},8,["modelValue"]),e(Ve,{ref_key:"contactTableSelectRef",ref:V,"customer-id":l(a).bizId,onSuccess:P},null,8,["customer-id"]),e(we,{ref_key:"businessTableSelectRef",ref:g,"customer-id":l(a).bizId,onSuccess:B},null,8,["customer-id"])],64)}}});export{z as F,ge as _};
