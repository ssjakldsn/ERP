import{bt as j,d as E,z as J,r as c,e as x,n as P,o as d,q as U,w as T,g as _,y as H,a as l,c as y,a5 as b,f as w,k as A,x as F,aw as V,I as G,M as L,a0 as K,a1 as Q,_ as X}from"./index-CIfmhqRC.js";import{_ as Y}from"./ContentWrap.vue_vue_type_script_setup_true_lang-sm5dIhPQ.js";import{R as M}from"./TabNews-7oV1NnBl.js";import Z from"./main-BKPadW1d.js";import $ from"./MsgList-CNhz3oPm.js";import{g as aa}from"./index-CPdF_MJz.js";const O=n=>j.get({url:"/mp/message/page",params:n}),R=n=>(K("data-v-9a826f06"),n=n(),Q(),n),ea={key:0},la=[R(()=>_("span",{class:"el-table__empty-text"},"\u70B9\u51FB\u52A0\u8F7D\u66F4\u591A",-1))],sa={key:1,class:"el-table__empty-block"},ta=[R(()=>_("span",{class:"el-table__empty-text"},"\u6CA1\u6709\u66F4\u591A\u4E86",-1))],ua={class:"msg-send"},W=X(E({name:"WxMsg",__name:"main",props:{userId:{type:Number,required:!0}},setup(n){const q=J(),k=n,v=c(-1),m=c(!1),I=c(!0),p=c([]),r=x({pageNo:1,pageSize:14,accountId:v}),i=x({nickname:"\u7528\u6237",avatar:"/assets/profile-BiJdjH9E.jpg",accountId:v}),S=c(!1),e=c({type:M.Text,accountId:-1,articles:[]}),h=c(null),t=c(null);P(async()=>{var s,u;const a=await aa(k.userId);i.nickname=((s=a.nickname)==null?void 0:s.length)>0?a.nickname:i.nickname,i.avatar=((u=i.avatar)==null?void 0:u.length)>0?a.avatar:i.avatar,v.value=a.accountId,e.value.accountId=a.accountId,D()});const C=async()=>{var s;if(!l(e))return;e.value.type===M.News&&e.value.articles&&e.value.articles.length>1&&(e.value.articles=[e.value.articles[0]],q.success("\u56FE\u6587\u6D88\u606F\u6761\u6570\u9650\u5236\u5728 1 \u6761\u4EE5\u5185\uFF0C\u5DF2\u9ED8\u8BA4\u53D1\u9001\u7B2C\u4E00\u6761"));const a=await(u=>j.post({url:"/mp/message/send",data:u}))({userId:k.userId,...e.value});S.value=!1,p.value=[...p.value,a],await z(),(s=h.value)==null||s.clear()},B=()=>{r.pageNo++,N(r,null)},N=async(a,s=null)=>{var f;m.value=!0;let u=await O(Object.assign({pageNo:a.pageNo,pageSize:a.pageSize,userId:k.userId,accountId:a.accountId},s));const g=((f=t.value)==null?void 0:f.scrollHeight)??0,o=u.list.reverse();p.value=[...o,...p.value],m.value=!1,(o.length<r.pageSize||o.length===0)&&(I.value=!1),r.pageNo=a.pageNo,r.pageSize=a.pageSize,r.pageNo===1?await z():o.length!==0&&(await V(),g!==0&&t.value&&(t.value.scrollTop=t.value.scrollHeight-g-100))},D=()=>{N(r)},z=async()=>{await V(),t.value&&(t.value.scrollTop=t.value.scrollHeight)};return(a,s)=>{const u=G,g=Y,o=L;return d(),U(g,null,{default:T(()=>[_("div",{class:"msg-div",ref_key:"msgDivRef",ref:t},[H(_("div",null,null,512),[[o,l(m)]]),l(m)?b("",!0):(d(),y("div",ea,[l(I)?(d(),y("div",{key:0,class:"el-table__empty-block",onClick:B},la)):b("",!0),l(I)?b("",!0):(d(),y("div",sa,ta))])),w($,{list:l(p),"account-id":l(v),user:l(i)},null,8,["list","account-id","user"])],512),H((d(),y("div",ua,[w(l(Z),{ref_key:"replySelectRef",ref:h,modelValue:l(e),"onUpdate:modelValue":s[0]||(s[0]=f=>A(e)?e.value=f:null)},null,8,["modelValue"]),w(u,{type:"success",class:"send-but",onClick:C},{default:T(()=>[F("\u53D1\u9001(S)")]),_:1})])),[[o,l(S)]])]),_:1})}}}),[["__scopeId","data-v-9a826f06"]]),ca=Object.freeze(Object.defineProperty({__proto__:null,default:W},Symbol.toStringTag,{value:"Module"}));export{W,O as g,ca as m};
