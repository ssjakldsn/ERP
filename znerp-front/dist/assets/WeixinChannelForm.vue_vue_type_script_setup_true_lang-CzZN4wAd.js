import{d as J,h as L,z as T,r as m,o as c,c as V,f as l,w as i,a as t,x as p,y as B,q as k,F as E,p as W,cL as j,D as H,t as G,a5 as C,k as Q,U as X,C as Y,ak as Z,al as $,H as ee,I as le,br as ae,J as te,M as oe}from"./index-CIfmhqRC.js";import{_ as ie}from"./Dialog.vue_vue_type_style_index_0_lang-CtaLqQeX.js";import{C as re}from"./constants-A8BI3pz7.js";import{g as de,c as ne,u as pe}from"./index-BY9mST-C.js";const ue={key:0},se={key:1},ce=J({name:"WeixinChannelForm",__name:"WeixinChannelForm",emits:["success"],setup(me,{expose:K,emit:R}){const{t:v}=L(),f=T(),u=m(!1),h=m(""),s=m(!1),a=m({appId:"",code:"",status:void 0,feeRate:void 0,remark:"",config:{appId:"",mchId:"",apiVersion:"",mchKey:"",keyContent:"",privateKeyContent:"",certSerialNo:"",apiV3Key:""}}),U={feeRate:[{required:!0,message:"\u8BF7\u8F93\u5165\u6E20\u9053\u8D39\u7387",trigger:"blur"}],status:[{required:!0,message:"\u6E20\u9053\u72B6\u6001\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],"config.mchId":[{required:!0,message:"\u8BF7\u4F20\u5165\u5546\u6237\u53F7",trigger:"blur"}],"config.appId":[{required:!0,message:"\u8BF7\u8F93\u5165\u516C\u4F17\u53F7APPID",trigger:"blur"}],"config.apiVersion":[{required:!0,message:"API\u7248\u672C\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],"config.mchKey":[{required:!0,message:"\u8BF7\u8F93\u5165\u5546\u6237\u5BC6\u94A5",trigger:"blur"}],"config.keyContent":[{required:!0,message:"\u8BF7\u4E0A\u4F20 apiclient_cert.p12 \u8BC1\u4E66",trigger:"blur"}],"config.privateKeyContent":[{required:!0,message:"\u8BF7\u4E0A\u4F20 apiclient_key.pem \u8BC1\u4E66",trigger:"blur"}],"config.certSerialNo":[{required:!0,message:"\u8BF7\u8F93\u5165\u8BC1\u4E66\u5E8F\u5217\u53F7",trigger:"blur"}],"config.apiV3Key":[{required:!0,message:"\u8BF7\u4E0A\u4F20 api V3 \u5BC6\u94A5\u503C",trigger:"blur"}]},g=m();K({open:async(d,e)=>{u.value=!0,s.value=!0,A(d,e);try{const r=await de(d,e);r&&r.id&&(a.value=r,a.value.config=JSON.parse(r.config)),h.value=a.value.id?"\u7F16\u8F91\u652F\u4ED8\u6E20\u9053":"\u521B\u5EFA\u652F\u4ED8\u6E20\u9053"}finally{s.value=!1}}});const q=R,S=async()=>{if(g&&await g.value.validate()){s.value=!0;try{const d={...a.value};d.config=JSON.stringify(a.value.config),d.id?(await pe(d),f.success(v("common.updateSuccess"))):(await ne(d),f.success(v("common.createSuccess"))),u.value=!1,q("success")}finally{s.value=!1}}},A=(d,e)=>{var r;a.value={appId:d,code:e,status:re.ENABLE,feeRate:void 0,remark:"",config:{appId:"",mchId:"",apiVersion:"",mchKey:"",keyContent:"",privateKeyContent:"",certSerialNo:"",apiV3Key:""}},(r=g.value)==null||r.resetFields()},_=(d,e)=>{if("."+d.name.split(".")[1]!==e){debugger;return f.error('\u8BF7\u4E0A\u4F20\u6307\u5B9A\u683C\u5F0F"'+e+'"\u6587\u4EF6'),!1}let r=d.size/1024/1024<2;return r||f.error("\u6587\u4EF6\u5927\u5C0F\u8D85\u8FC7 2MB"),r},N=d=>{_(d,".p12")},P=d=>{_(d,".pem")},F=async d=>{const e=new FileReader;e.onload=r=>{a.value.config.privateKeyContent=r.target.result},e.readAsText(d.file)},z=async d=>{const e=new FileReader;e.onload=r=>{a.value.config.keyContent=r.target.result.split(",")[1]},e.readAsDataURL(d.file)};return(d,e)=>{const r=X,n=Y,b=Z,w=$,x=ee,y=le,I=ae,D=te,M=ie,O=oe;return c(),V("div",null,[l(M,{modelValue:t(u),"onUpdate:modelValue":e[12]||(e[12]=o=>Q(u)?u.value=o:null),title:t(h),width:"800px"},{footer:i(()=>[l(y,{disabled:t(s),type:"primary",onClick:S},{default:i(()=>[p("\u786E \u5B9A")]),_:1},8,["disabled"]),l(y,{onClick:e[11]||(e[11]=o=>u.value=!1)},{default:i(()=>[p("\u53D6 \u6D88")]),_:1})]),default:i(()=>[B((c(),k(D,{ref_key:"formRef",ref:g,model:t(a),rules:U,"label-width":"120px"},{default:i(()=>[l(n,{label:"\u6E20\u9053\u8D39\u7387","label-width":"180px",prop:"feeRate"},{default:i(()=>[l(r,{modelValue:t(a).feeRate,"onUpdate:modelValue":e[0]||(e[0]=o=>t(a).feeRate=o),style:{width:"100%"},clearable:"",placeholder:"\u8BF7\u8F93\u5165\u6E20\u9053\u8D39\u7387"},{append:i(()=>[p("%")]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"\u5FAE\u4FE1 APPID","label-width":"180px",prop:"config.appId"},{default:i(()=>[l(r,{modelValue:t(a).config.appId,"onUpdate:modelValue":e[1]||(e[1]=o=>t(a).config.appId=o),style:{width:"100%"},clearable:"",placeholder:"\u8BF7\u8F93\u5165\u5FAE\u4FE1 APPID"},null,8,["modelValue"])]),_:1}),l(n,{label:"\u5546\u6237\u53F7","label-width":"180px",prop:"config.mchId"},{default:i(()=>[l(r,{modelValue:t(a).config.mchId,"onUpdate:modelValue":e[2]||(e[2]=o=>t(a).config.mchId=o),style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(n,{label:"\u6E20\u9053\u72B6\u6001","label-width":"180px",prop:"status"},{default:i(()=>[l(w,{modelValue:t(a).status,"onUpdate:modelValue":e[3]||(e[3]=o=>t(a).status=o)},{default:i(()=>[(c(!0),V(E,null,W(t(j)(t(H).COMMON_STATUS),o=>(c(),k(b,{key:parseInt(o.value),value:parseInt(o.value)},{default:i(()=>[p(G(o.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"API \u7248\u672C","label-width":"180px",prop:"config.apiVersion"},{default:i(()=>[l(w,{modelValue:t(a).config.apiVersion,"onUpdate:modelValue":e[4]||(e[4]=o=>t(a).config.apiVersion=o)},{default:i(()=>[l(b,{value:"v2"},{default:i(()=>[p("v2")]),_:1}),l(b,{value:"v3"},{default:i(()=>[p("v3")]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(a).config.apiVersion==="v2"?(c(),V("div",ue,[l(n,{label:"\u5546\u6237\u5BC6\u94A5","label-width":"180px",prop:"config.mchKey"},{default:i(()=>[l(r,{modelValue:t(a).config.mchKey,"onUpdate:modelValue":e[5]||(e[5]=o=>t(a).config.mchKey=o),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u5546\u6237\u5BC6\u94A5"},null,8,["modelValue"])]),_:1}),l(n,{label:"apiclient_cert.p12 \u8BC1\u4E66","label-width":"180px",prop:"config.keyContent"},{default:i(()=>[l(r,{modelValue:t(a).config.keyContent,"onUpdate:modelValue":e[6]||(e[6]=o=>t(a).config.keyContent=o),autosize:{minRows:8,maxRows:8},style:{width:"100%"},placeholder:"\u8BF7\u4E0A\u4F20 apiclient_cert.p12 \u8BC1\u4E66",readonly:"",type:"textarea"},null,8,["modelValue"])]),_:1}),l(n,{label:"","label-width":"180px"},{default:i(()=>[l(I,{"before-upload":N,"http-request":z,limit:1,accept:".p12",action:""},{default:i(()=>[l(y,{type:"primary"},{default:i(()=>[l(x,{class:"mr-5px",icon:"ep:upload"}),p(" \u70B9\u51FB\u4E0A\u4F20 ")]),_:1})]),_:1})]),_:1})])):C("",!0),t(a).config.apiVersion==="v3"?(c(),V("div",se,[l(n,{label:"API V3 \u5BC6\u94A5","label-width":"180px",prop:"config.apiV3Key"},{default:i(()=>[l(r,{modelValue:t(a).config.apiV3Key,"onUpdate:modelValue":e[7]||(e[7]=o=>t(a).config.apiV3Key=o),clearable:"",placeholder:"\u8BF7\u8F93\u5165 API V3 \u5BC6\u94A5"},null,8,["modelValue"])]),_:1}),l(n,{label:"apiclient_key.pem \u8BC1\u4E66","label-width":"180px",prop:"config.privateKeyContent"},{default:i(()=>[l(r,{modelValue:t(a).config.privateKeyContent,"onUpdate:modelValue":e[8]||(e[8]=o=>t(a).config.privateKeyContent=o),autosize:{minRows:8,maxRows:8},style:{width:"100%"},placeholder:"\u8BF7\u4E0A\u4F20 apiclient_key.pem \u8BC1\u4E66",readonly:"",type:"textarea"},null,8,["modelValue"])]),_:1}),l(n,{label:"","label-width":"180px",prop:"privateKeyContentFile"},{default:i(()=>[l(I,{ref:"privateKeyContentFile","before-upload":P,"http-request":F,limit:1,accept:".pem",action:""},{default:i(()=>[l(y,{type:"primary"},{default:i(()=>[l(x,{class:"mr-5px",icon:"ep:upload"}),p(" \u70B9\u51FB\u4E0A\u4F20 ")]),_:1})]),_:1},512)]),_:1}),l(n,{label:"\u8BC1\u4E66\u5E8F\u5217\u53F7","label-width":"180px",prop:"config.certSerialNo"},{default:i(()=>[l(r,{modelValue:t(a).config.certSerialNo,"onUpdate:modelValue":e[9]||(e[9]=o=>t(a).config.certSerialNo=o),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u8BC1\u4E66\u5E8F\u5217\u53F7"},null,8,["modelValue"])]),_:1})])):C("",!0),l(n,{label:"\u5907\u6CE8","label-width":"180px",prop:"remark"},{default:i(()=>[l(r,{modelValue:t(a).remark,"onUpdate:modelValue":e[10]||(e[10]=o=>t(a).remark=o),style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[O,t(s)]])]),_:1},8,["modelValue","title"])])}}});export{ce as _};
