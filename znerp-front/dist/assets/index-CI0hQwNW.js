import{d as y,z as k,r as i,e8 as S,ex as w,bs as C,n as F,cy as M,o as x,q as R,w as o,f as r,a as m,E as b,j as A}from"./index-CIfmhqRC.js";import{_ as N}from"./ContentWrap.vue_vue_type_script_setup_true_lang-sm5dIhPQ.js";import j from"./KeFuConversationList-rvvXwxH7.js";import K from"./KeFuMessageList-CYg3b490.js";import L from"./MemberBrowsingHistory-DFxBMJUn.js";import{W as _}from"./constants-CD8mqZTg.js";import"./el-card-DyMugU68.js";import"./el-avatar-Cbg-oQZd.js";import"./emoji-B3TTaVnW.js";import"./formatTime-DFFN_xWx.js";import"./el-empty-fTn0RAmM.js";import"./el-image-DLpquQe6.js";import"./EmojiSelectPopover.vue_vue_type_script_setup_true_lang-BeZqZpAK.js";import"./PictureSelectUpload.vue_vue_type_script_setup_true_lang-CCwYTsa9.js";import"./picture-CTjip5lJ.js";import"./ProductItem-Cv4ArqnW.js";import"./OrderItem-Bpiqn_Aj.js";import"./constants-A8BI3pz7.js";import"./ProductBrowsingHistory.vue_vue_type_script_setup_true_lang-CzZkaLyg.js";import"./concat-BmzGRl5v.js";import"./OrderBrowsingHistory.vue_vue_type_script_setup_true_lang-D83skiJM.js";import"./index-DDOznnSc.js";const q=y({name:"KeFu",__name:"index",setup(B){const c=k(),v=i("https://erpapi.vqmjc.cc/infra/ws".replace("http","ws")+"?token="+S()),{data:s,close:d,open:g}=w(v.value,{autoReconnect:!0,heartbeat:!0});C(()=>{var t;if(s.value)try{if(s.value==="pong")return;const a=JSON.parse(s.value),e=a.type;if(!e)return void c.error("\u672A\u77E5\u7684\u6D88\u606F\u7C7B\u578B\uFF1A"+s.value);if(e===_.KEFU_MESSAGE_TYPE)return n(),void((t=p.value)==null?void 0:t.refreshMessageList(JSON.parse(a.content)));e===_.KEFU_MESSAGE_ADMIN_READ&&n()}catch(a){console.error(a)}});const l=i(),n=()=>{var t;(t=l.value)==null||t.getConversationList()},p=i(),f=i(),h=t=>{var a,e;(a=p.value)==null||a.getNewMessageList(t),(e=f.value)==null||e.initHistory(t)};return F(()=>{n(),g()}),M(()=>{d()}),(t,a)=>{const e=N,u=b,E=A;return x(),R(E,{gutter:10},{default:o(()=>[r(u,{span:6},{default:o(()=>[r(e,null,{default:o(()=>[r(m(j),{ref_key:"keFuConversationRef",ref:l,onChange:h},null,512)]),_:1})]),_:1}),r(u,{span:12},{default:o(()=>[r(e,null,{default:o(()=>[r(m(K),{ref_key:"keFuChatBoxRef",ref:p,onChange:n},null,512)]),_:1})]),_:1}),r(u,{span:6},{default:o(()=>[r(e,null,{default:o(()=>[r(m(L),{ref_key:"memberBrowsingHistoryRef",ref:f},null,512)]),_:1})]),_:1})]),_:1})}}});export{q as default};
