import{d as P,u as z,r as d,e as D,n as G,y as I,a as e,o,q as v,w as r,f as t,c as y,p as _,Q as J,D as Q,F as b,x as q,a5 as $,z as j,A as Y,B as H,C as K,G as N,U as W,J as X,E as Z,I as ee,M as ae}from"./index-CIfmhqRC.js";import{E as le}from"./el-card-DyMugU68.js";import{c as re}from"./index-Bi5zMYK4.js";import{u as te}from"./tagsView-CqxiFcdS.js";import{a as se}from"./index-w37PzF0B.js";import{g as ue}from"./index-QrlE36WK.js";const de=P({name:"BpmOALeaveCreate",__name:"create",setup(oe){const V=j(),{delView:x}=te(),{push:E,currentRoute:B}=z(),c=d(!1),s=d({type:void 0,reason:void 0,startTime:void 0,endTime:void 0}),C=D({type:[{required:!0,message:"\u8BF7\u5047\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],reason:[{required:!0,message:"\u8BF7\u5047\u539F\u56E0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],startTime:[{required:!0,message:"\u8BF7\u5047\u5F00\u59CB\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],endTime:[{required:!0,message:"\u8BF7\u5047\u7ED3\u675F\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}]}),g=d(),i=d([]),p=d({}),h=d(),T=d({}),U=d([]),O=async()=>{var m,l;if(g&&await g.value.validate()){((m=i.value)==null?void 0:m.length)>0&&await h.value.validate(),c.value=!0;try{const u={...s.value};((l=i.value)==null?void 0:l.length)>0&&(u.startUserSelectAssignees=p.value),await re(u),V.success("\u53D1\u8D77\u6210\u529F"),x(e(B)),await E({name:"BpmOALeave"})}finally{c.value=!1}}};return G(async()=>{var l;const m=await se(void 0,"oa_leave");if(m){if(i.value=m.startUserSelectTasks,((l=i.value)==null?void 0:l.length)>0){for(const u of i.value)p.value[u.id]=[],T.value[u.id]=[{required:!0,message:"\u8BF7\u9009\u62E9\u5BA1\u6279\u4EBA",trigger:"blur"}];U.value=await ue()}}else V.error("OA \u8BF7\u5047\u7684\u6D41\u7A0B\u6A21\u578B\u672A\u914D\u7F6E\uFF0C\u8BF7\u68C0\u67E5\uFF01")}),(m,l)=>{const u=Y,k=H,n=K,w=N,L=W,A=X,R=le,S=Z,F=ee,M=ae;return I((o(),v(A,{ref_key:"formRef",ref:g,model:e(s),rules:e(C),"label-width":"80px"},{default:r(()=>[t(n,{label:"\u8BF7\u5047\u7C7B\u578B",prop:"type"},{default:r(()=>[t(k,{modelValue:e(s).type,"onUpdate:modelValue":l[0]||(l[0]=a=>e(s).type=a),clearable:"",placeholder:"\u8BF7\u9009\u62E9\u8BF7\u5047\u7C7B\u578B"},{default:r(()=>[(o(!0),y(b,null,_(e(J)(e(Q).BPM_OA_LEAVE_TYPE),a=>(o(),v(u,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(n,{label:"\u5F00\u59CB\u65F6\u95F4",prop:"startTime"},{default:r(()=>[t(w,{modelValue:e(s).startTime,"onUpdate:modelValue":l[1]||(l[1]=a=>e(s).startTime=a),clearable:"",placeholder:"\u8BF7\u9009\u62E9\u5F00\u59CB\u65F6\u95F4",type:"datetime","value-format":"x"},null,8,["modelValue"])]),_:1}),t(n,{label:"\u7ED3\u675F\u65F6\u95F4",prop:"endTime"},{default:r(()=>[t(w,{modelValue:e(s).endTime,"onUpdate:modelValue":l[2]||(l[2]=a=>e(s).endTime=a),clearable:"",placeholder:"\u8BF7\u9009\u62E9\u7ED3\u675F\u65F6\u95F4",type:"datetime","value-format":"x"},null,8,["modelValue"])]),_:1}),t(n,{label:"\u539F\u56E0",prop:"reason"},{default:r(()=>[t(L,{modelValue:e(s).reason,"onUpdate:modelValue":l[3]||(l[3]=a=>e(s).reason=a),placeholder:"\u8BF7\u8F93\u8BF7\u5047\u539F\u56E0",type:"textarea"},null,8,["modelValue"])]),_:1}),e(i).length>0?(o(),v(S,{key:0},{default:r(()=>[t(R,{class:"mb-10px"},{header:r(()=>[q("\u6307\u5B9A\u5BA1\u6279\u4EBA")]),default:r(()=>[t(A,{model:e(p),rules:e(T),ref_key:"startUserSelectAssigneesFormRef",ref:h},{default:r(()=>[(o(!0),y(b,null,_(e(i),a=>(o(),v(n,{key:a.id,label:`\u4EFB\u52A1\u3010${a.name}\u3011`,prop:a.id},{default:r(()=>[t(k,{modelValue:e(p)[a.id],"onUpdate:modelValue":f=>e(p)[a.id]=f,multiple:"",placeholder:"\u8BF7\u9009\u62E9\u5BA1\u6279\u4EBA"},{default:r(()=>[(o(!0),y(b,null,_(e(U),f=>(o(),v(u,{key:f.id,label:f.nickname,value:f.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label","prop"]))),128))]),_:1},8,["model","rules"])]),_:1})]),_:1})):$("",!0),t(n,null,{default:r(()=>[t(F,{disabled:e(c),type:"primary",onClick:O},{default:r(()=>[q("\u786E \u5B9A")]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model","rules"])),[[M,e(c)]])}}});export{de as default};
