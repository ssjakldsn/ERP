import{d as q,r as c,e as G,u as H,ar as K,O as J,o as d,c as Q,f as e,w as r,x as m,a as t,y as w,q as p,a5 as f,t as V,D as W,F as X,z as Y,H as Z,I as $,j as ee,K as ae,af as se,L as te,M as oe}from"./index-CIfmhqRC.js";import{_ as ie}from"./ContentWrap.vue_vue_type_script_setup_true_lang-sm5dIhPQ.js";import{_ as re}from"./index.vue_vue_type_script_setup_true_lang-DYHi04Tm.js";import{_ as ne}from"./DictTag.vue_vue_type_script_lang-CTpVFm77.js";import{d as le,g as ce,e as de,f as ue}from"./index-B_QTmj5f.js";import{_ as pe}from"./ContactForm.vue_vue_type_script_setup_true_lang-CLRF_VIq.js";import{B as R}from"./index-8CYEcIk3.js";import{_ as me}from"./ContactListModal.vue_vue_type_script_setup_true_lang-KXTfVMT0.js";const fe=q({name:"CrmContactList",__name:"ContactList",props:{bizType:{},bizId:{},customerId:{},businessId:{}},setup(x){const o=x,I=c(!0),k=c(0),z=c([]),a=G({pageNo:1,pageSize:10,customerId:void 0,businessId:void 0}),b=Y(),_=async()=>{I.value=!0;try{a.customerId=void 0;let s={list:[],total:0};switch(o.bizType){case R.CRM_CUSTOMER:a.customerId=o.bizId,s=await ce(a);break;case R.CRM_BUSINESS:a.businessId=o.bizId,s=await le(a);break;default:return}z.value=s.list,k.value=s.total}finally{I.value=!1}},y=()=>{a.pageNo=1,_()},C=c(),M=()=>{C.value.open("create",void 0,o.customerId,o.businessId)},{push:T}=H(),S=c(),U=()=>{S.value.open()},E=async s=>{const i={businessId:o.bizId,contactIds:s};g.value.getSelectionRows().forEach(u=>{i.contactIds.push(u.id)}),await de(i),b.success("\u5173\u8054\u8054\u7CFB\u4EBA\u6210\u529F"),y()},g=c(),L=async()=>{const s={businessId:o.bizId,contactIds:g.value.getSelectionRows().map(i=>i.id)};if(s.contactIds.length===0)return b.error("\u672A\u9009\u62E9\u8054\u7CFB\u4EBA");await ue(s),b.success("\u53D6\u5173\u8054\u7CFB\u4EBA\u6210\u529F"),y()};return K(()=>[o.bizId,o.bizType],()=>{y()},{immediate:!0,deep:!0}),(s,i)=>{const u=Z,v=$,O=ee,l=ae,B=se,P=ne,j=te,A=re,D=ie,h=J("hasPermi"),F=oe;return d(),Q(X,null,[e(O,{justify:"end"},{default:r(()=>[e(v,{onClick:M},{default:r(()=>[e(u,{class:"mr-5px",icon:"system-uicons:contacts"}),m(" \u521B\u5EFA\u8054\u7CFB\u4EBA ")]),_:1}),t(a).businessId?w((d(),p(v,{key:0,onClick:U},{default:r(()=>[e(u,{class:"mr-5px",icon:"ep:circle-plus"}),m(" \u5173\u8054 ")]),_:1})),[[h,["crm:contact:create-business"]]]):f("",!0),t(a).businessId?w((d(),p(v,{key:1,onClick:L},{default:r(()=>[e(u,{class:"mr-5px",icon:"ep:remove"}),m(" \u89E3\u9664\u5173\u8054 ")]),_:1})),[[h,["crm:contact:delete-business"]]]):f("",!0)]),_:1}),e(D,{class:"mt-10px"},{default:r(()=>[w((d(),p(j,{ref_key:"contactRef",ref:g,data:t(z),"show-overflow-tooltip":!0,stripe:!0},{default:r(()=>[t(a).businessId?(d(),p(l,{key:0,type:"selection",width:"55"})):f("",!0),e(l,{align:"center",fixed:"left",label:"\u59D3\u540D",prop:"name"},{default:r(n=>[e(B,{underline:!1,type:"primary",onClick:Ie=>{return N=n.row.id,void T({name:"CrmContactDetail",params:{id:N}});var N}},{default:r(()=>[m(V(n.row.name),1)]),_:2},1032,["onClick"])]),_:1}),e(l,{align:"center",label:"\u624B\u673A\u53F7",prop:"mobile"}),e(l,{align:"center",label:"\u804C\u4F4D",prop:"post"}),e(l,{align:"center",label:"\u76F4\u5C5E\u4E0A\u7EA7",prop:"parentName"}),e(l,{align:"center",label:"\u662F\u5426\u5173\u952E\u51B3\u7B56\u4EBA","min-width":"100",prop:"master"},{default:r(n=>[e(P,{type:t(W).INFRA_BOOLEAN_STRING,value:n.row.master},null,8,["type","value"])]),_:1})]),_:1},8,["data"])),[[F,t(I)]]),e(A,{limit:t(a).pageSize,"onUpdate:limit":i[0]||(i[0]=n=>t(a).pageSize=n),page:t(a).pageNo,"onUpdate:page":i[1]||(i[1]=n=>t(a).pageNo=n),total:t(k),onPagination:_},null,8,["limit","page","total"])]),_:1}),e(pe,{ref_key:"formRef",ref:C,onSuccess:_},null,512),s.customerId?(d(),p(me,{key:0,ref_key:"contactModalRef",ref:S,"customer-id":s.customerId,onSuccess:E},null,8,["customer-id"])):f("",!0)],64)}}});export{fe as _};
