import{d as ue,ai as ie,r as n,n as re,o as h,q as _,c9 as ne,w as u,f as l,x as m,a as t,P as pe,c as de,F as se,p as me,Q as ve,D as A,y as ce,k as x,t as k,aD as fe,c5 as E,U as we,C as he,A as be,B as _e,H as ge,I as Ve,J as ye,ae as Ce,K as Ue,ak as xe,L as ke,M as Se}from"./index-CIfmhqRC.js";import{_ as Te}from"./Dialog.vue_vue_type_style_index_0_lang-CtaLqQeX.js";import{_ as Me}from"./ContentWrap.vue_vue_type_script_setup_true_lang-sm5dIhPQ.js";import{_ as Ne}from"./index.vue_vue_type_script_setup_true_lang-DYHi04Tm.js";import{_ as Ye}from"./DictTag.vue_vue_type_script_lang-CTpVFm77.js";import{E as De}from"./el-image-DLpquQe6.js";import{h as Oe}from"./tree-BMqZf9_I.js";import{g as Pe}from"./category-CKOb63Br.js";import{a as ze}from"./combinationActivity-DUAmepQB.js";import{f as Ie}from"./formatter-CHMUnmj-.js";import{f as F,d as qe}from"./formatTime-DFFN_xWx.js";const Ae=ue({name:"CombinationTableSelect",__name:"CombinationTableSelect",props:{multiple:ie.bool.def(!1)},emits:["change"],setup(S,{expose:B,emit:J}){const T=n(0),v=n([]),U=n(!1),s=n(!1),r=n({pageNo:1,pageSize:10,name:null,status:void 0});B({open:o=>{c.value=[],p.value={},d.value=!1,V.value=!1,o&&o.length>0&&(c.value=[...o],p.value=Object.fromEntries(o.map(a=>[a.id,!0]))),s.value=!0,N()}});const g=async()=>{U.value=!0;try{const o=await ze(r.value);v.value=o.list,T.value=o.total,v.value.forEach(a=>p.value[a.id]=p.value[a.id]||!1),O()}finally{U.value=!1}},M=()=>{r.value.pageNo=1,g()},N=()=>{r.value={pageNo:1,pageSize:10,name:"",createTime:[]},g()},K=o=>{const a=Math.min(...o.map(b=>b.combinationPrice));return`\uFFE5${fe(a)}`},d=n(!1),V=n(!1),c=n([]),p=n({}),y=n(),j=()=>{s.value=!1,Y(E,[...c.value])},Y=J,H=o=>{d.value=o,V.value=!1,v.value.forEach(a=>D(o,a,!1))},D=(o,a,b)=>{if(o)c.value.push(a),p.value[a.id]=!0;else{const f=L(a);f>-1&&(c.value.splice(f,1),p.value[a.id]=!1,d.value=!1)}b&&O()},L=o=>c.value.findIndex(a=>a.id===o.id),O=()=>{d.value=v.value.every(o=>p.value[o.id]),V.value=!d.value&&v.value.some(o=>p.value[o.id])},P=n(),Q=n();return re(async()=>{await g(),P.value=await Pe({}),Q.value=Oe(P.value,"id","parentId")}),(o,a)=>{const b=we,f=he,R=be,$=_e,z=ge,C=Ve,G=ye,I=Ce,i=Ue,W=xe,X=De,Z=Ye,ee=ke,ae=Ne,le=Me,te=Te,oe=Se;return h(),_(te,{modelValue:t(s),"onUpdate:modelValue":a[7]||(a[7]=e=>x(s)?s.value=e:null),appendToBody:!0,title:"\u9009\u62E9\u6D3B\u52A8",width:"70%"},ne({default:u(()=>[l(le,null,{default:u(()=>[l(G,{ref:"queryFormRef",inline:!0,model:t(r),class:"-mb-15px","label-width":"68px"},{default:u(()=>[l(f,{label:"\u6D3B\u52A8\u540D\u79F0",prop:"name"},{default:u(()=>[l(b,{modelValue:t(r).name,"onUpdate:modelValue":a[0]||(a[0]=e=>t(r).name=e),placeholder:"\u8BF7\u8F93\u5165\u6D3B\u52A8\u540D\u79F0",clearable:"",onKeyup:pe(M,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),l(f,{label:"\u6D3B\u52A8\u72B6\u6001",prop:"status"},{default:u(()=>[l($,{modelValue:t(r).status,"onUpdate:modelValue":a[1]||(a[1]=e=>t(r).status=e),placeholder:"\u8BF7\u9009\u62E9\u6D3B\u52A8\u72B6\u6001",clearable:"",class:"!w-240px"},{default:u(()=>[(h(!0),de(se,null,me(t(ve)(t(A).COMMON_STATUS),e=>(h(),_(R,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(f,null,{default:u(()=>[l(C,{onClick:M},{default:u(()=>[l(z,{class:"mr-5px",icon:"ep:search"}),m(" \u641C\u7D22 ")]),_:1}),l(C,{onClick:N},{default:u(()=>[l(z,{class:"mr-5px",icon:"ep:refresh"}),m(" \u91CD\u7F6E ")]),_:1})]),_:1})]),_:1},8,["model"]),ce((h(),_(ee,{data:t(v),"show-overflow-tooltip":""},{default:u(()=>[S.multiple?(h(),_(i,{key:0,width:"55"},{header:u(()=>[l(I,{modelValue:t(d),"onUpdate:modelValue":a[2]||(a[2]=e=>x(d)?d.value=e:null),indeterminate:t(V),onChange:H},null,8,["modelValue","indeterminate"])]),default:u(({row:e})=>[l(I,{modelValue:t(p)[e.id],"onUpdate:modelValue":w=>t(p)[e.id]=w,onChange:w=>D(w,e,!0)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1})):(h(),_(i,{key:1,label:"#",width:"55"},{default:u(({row:e})=>[l(W,{value:e.id,modelValue:t(y),"onUpdate:modelValue":a[3]||(a[3]=w=>x(y)?y.value=w:null),onChange:w=>{return Y(E,q=e),s.value=!1,void(y.value=q.id);var q}},{default:u(()=>[m(" \xA0 ")]),_:2},1032,["value","modelValue","onChange"])]),_:1})),l(i,{label:"\u6D3B\u52A8\u7F16\u53F7",prop:"id","min-width":"80"}),l(i,{label:"\u6D3B\u52A8\u540D\u79F0",prop:"name","min-width":"140"}),l(i,{label:"\u6D3B\u52A8\u65F6\u95F4","min-width":"210"},{default:u(e=>[m(k(t(F)(e.row.startTime,"YYYY-MM-DD"))+" ~ "+k(t(F)(e.row.endTime,"YYYY-MM-DD")),1)]),_:1}),l(i,{label:"\u5546\u54C1\u56FE\u7247",prop:"spuName","min-width":"80"},{default:u(e=>[l(X,{src:e.row.picUrl,class:"h-40px w-40px","preview-src-list":[e.row.picUrl],"preview-teleported":""},null,8,["src","preview-src-list"])]),_:1}),l(i,{label:"\u5546\u54C1\u6807\u9898",prop:"spuName","min-width":"300"}),l(i,{label:"\u539F\u4EF7",prop:"marketPrice","min-width":"100",formatter:t(Ie)},null,8,["formatter"]),l(i,{label:"\u62FC\u56E2\u4EF7",prop:"seckillPrice","min-width":"100"},{default:u(e=>[m(k(K(e.row.products)),1)]),_:1}),l(i,{label:"\u5F00\u56E2\u7EC4\u6570",prop:"groupCount","min-width":"100"}),l(i,{label:"\u6210\u56E2\u7EC4\u6570",prop:"groupSuccessCount","min-width":"100"}),l(i,{label:"\u8D2D\u4E70\u6B21\u6570",prop:"recordCount","min-width":"100"}),l(i,{label:"\u6D3B\u52A8\u72B6\u6001",align:"center",prop:"status","min-width":"100"},{default:u(e=>[l(Z,{type:t(A).COMMON_STATUS,value:e.row.status},null,8,["type","value"])]),_:1}),l(i,{label:"\u521B\u5EFA\u65F6\u95F4",align:"center",prop:"createTime",formatter:t(qe),width:"180px"},null,8,["formatter"])]),_:1},8,["data"])),[[oe,t(U)]]),l(ae,{limit:t(r).pageSize,"onUpdate:limit":a[4]||(a[4]=e=>t(r).pageSize=e),page:t(r).pageNo,"onUpdate:page":a[5]||(a[5]=e=>t(r).pageNo=e),total:t(T),onPagination:g},null,8,["limit","page","total"])]),_:1})]),_:2},[S.multiple?{name:"footer",fn:u(()=>[l(C,{type:"primary",onClick:j},{default:u(()=>[m("\u786E \u5B9A")]),_:1}),l(C,{onClick:a[6]||(a[6]=e=>s.value=!1)},{default:u(()=>[m("\u53D6 \u6D88")]),_:1})]),key:"0"}:void 0]),1032,["modelValue"])}}});export{Ae as _};
