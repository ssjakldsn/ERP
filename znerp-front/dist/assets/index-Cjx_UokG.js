import{d as ra,h as na,z as sa,u as ia,r as g,e as pa,n as da,O as ca,o as s,c as K,f as a,w as e,a as o,P as L,F as B,p as ua,Q as ma,D,q as i,x as p,y as m,t as fa,a5 as R,U as ba,C as ya,A as _a,B as ga,H as ha,I as wa,J as ka,K as va,L as xa,M as ja}from"./index-CIfmhqRC.js";import{_ as Ca}from"./index.vue_vue_type_script_setup_true_lang-DYHi04Tm.js";import{E as Na,a as Sa,b as Oa}from"./el-dropdown-item-CvgBZuG7.js";import{_ as Ra}from"./DictTag.vue_vue_type_script_lang-CTpVFm77.js";import{_ as Va}from"./ContentWrap.vue_vue_type_script_setup_true_lang-sm5dIhPQ.js";import{_ as Pa}from"./index-2RHHZ-Zv.js";import{c as V}from"./permission-CNSsVK1N.js";import{_ as Ta}from"./JobForm.vue_vue_type_script_setup_true_lang-BtWJ5d_P.js";import{_ as Ua}from"./JobDetail.vue_vue_type_script_setup_true_lang-pNdzqWmw.js";import{d as qa}from"./download-D5Lb_h0f.js";import{b as Aa,e as Ja,d as za,f as Fa,r as Ia}from"./index-FstcPY4O.js";import{c as w}from"./constants-A8BI3pz7.js";import"./index-CrBeVHKs.js";import"./color-BN7ZL7BD.js";import"./el-card-DyMugU68.js";import"./Dialog.vue_vue_type_style_index_0_lang-CtaLqQeX.js";import"./el-descriptions-item-BL6ba85F.js";import"./el-timeline-item-r9TewDuU.js";import"./formatTime-DFFN_xWx.js";const Ka=ra({name:"InfraJob",__name:"index",setup(La){const{t:j}=na(),f=sa(),{push:E}=ia(),C=g(!0),P=g(0),T=g([]),n=pa({pageNo:1,pageSize:10,name:void 0,status:void 0,handlerName:void 0}),U=g(),N=g(!1),b=async()=>{C.value=!0;try{const t=await Aa(n);T.value=t.list,P.value=t.total}finally{C.value=!1}},k=()=>{n.pageNo=1,b()},M=()=>{U.value.resetFields(),k()},G=async()=>{try{await f.exportConfirm(),N.value=!0;const t=await Ja(n);qa.excel(t,"\u5B9A\u65F6\u4EFB\u52A1.xls")}catch{}finally{N.value=!1}},q=g(),A=(t,r)=>{q.value.open(t,r)},H=async t=>{try{await f.confirm("\u786E\u8BA4\u8981\u7ACB\u5373\u6267\u884C\u4E00\u6B21"+t.name+"?",j("common.reminder")),await Ia(t.id),f.success("\u6267\u884C\u6210\u529F"),await b()}catch{}},J=g(),Q=t=>{J.value.open(t)},z=t=>{E(t&&t>0?"/job/job-log?id="+t:"/job/job-log")};return da(()=>{b()}),(t,r)=>{const S=Pa,F=ba,v=ya,W=_a,Y=ga,h=ha,d=wa,X=ka,I=Va,y=va,Z=Ra,O=Na,$=Sa,aa=Oa,ea=xa,la=Ca,_=ca("hasPermi"),oa=ja;return s(),K(B,null,[a(S,{title:"\u5B9A\u65F6\u4EFB\u52A1",url:"https://doc.iocoder.cn/job/"}),a(S,{title:"\u5F02\u6B65\u4EFB\u52A1",url:"https://doc.iocoder.cn/async-task/"}),a(S,{title:"\u6D88\u606F\u961F\u5217",url:"https://doc.iocoder.cn/message-queue/"}),a(I,null,{default:e(()=>[a(X,{class:"-mb-15px",model:o(n),ref_key:"queryFormRef",ref:U,inline:!0,"label-width":"100px"},{default:e(()=>[a(v,{label:"\u4EFB\u52A1\u540D\u79F0",prop:"name"},{default:e(()=>[a(F,{modelValue:o(n).name,"onUpdate:modelValue":r[0]||(r[0]=l=>o(n).name=l),placeholder:"\u8BF7\u8F93\u5165\u4EFB\u52A1\u540D\u79F0",clearable:"",onKeyup:L(k,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),a(v,{label:"\u4EFB\u52A1\u72B6\u6001",prop:"status"},{default:e(()=>[a(Y,{modelValue:o(n).status,"onUpdate:modelValue":r[1]||(r[1]=l=>o(n).status=l),placeholder:"\u8BF7\u9009\u62E9\u4EFB\u52A1\u72B6\u6001",clearable:"",class:"!w-240px"},{default:e(()=>[(s(!0),K(B,null,ua(o(ma)(o(D).INFRA_JOB_STATUS),l=>(s(),i(W,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(v,{label:"\u5904\u7406\u5668\u7684\u540D\u5B57",prop:"handlerName"},{default:e(()=>[a(F,{modelValue:o(n).handlerName,"onUpdate:modelValue":r[2]||(r[2]=l=>o(n).handlerName=l),placeholder:"\u8BF7\u8F93\u5165\u5904\u7406\u5668\u7684\u540D\u5B57",clearable:"",onKeyup:L(k,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),a(v,null,{default:e(()=>[a(d,{onClick:k},{default:e(()=>[a(h,{icon:"ep:search",class:"mr-5px"}),p(" \u641C\u7D22")]),_:1}),a(d,{onClick:M},{default:e(()=>[a(h,{icon:"ep:refresh",class:"mr-5px"}),p(" \u91CD\u7F6E")]),_:1}),m((s(),i(d,{type:"primary",plain:"",onClick:r[3]||(r[3]=l=>A("create"))},{default:e(()=>[a(h,{icon:"ep:plus",class:"mr-5px"}),p(" \u65B0\u589E ")]),_:1})),[[_,["infra:job:create"]]]),m((s(),i(d,{type:"success",plain:"",onClick:G,loading:o(N)},{default:e(()=>[a(h,{icon:"ep:download",class:"mr-5px"}),p(" \u5BFC\u51FA ")]),_:1},8,["loading"])),[[_,["infra:job:export"]]]),m((s(),i(d,{type:"info",plain:"",onClick:r[4]||(r[4]=l=>z())},{default:e(()=>[a(h,{icon:"ep:zoom-in",class:"mr-5px"}),p(" \u6267\u884C\u65E5\u5FD7 ")]),_:1})),[[_,["infra:job:query"]]])]),_:1})]),_:1},8,["model"])]),_:1}),a(I,null,{default:e(()=>[m((s(),i(ea,{data:o(T)},{default:e(()=>[a(y,{label:"\u4EFB\u52A1\u7F16\u53F7",align:"center",prop:"id"}),a(y,{label:"\u4EFB\u52A1\u540D\u79F0",align:"center",prop:"name"}),a(y,{label:"\u4EFB\u52A1\u72B6\u6001",align:"center",prop:"status"},{default:e(l=>[a(Z,{type:o(D).INFRA_JOB_STATUS,value:l.row.status},null,8,["type","value"])]),_:1}),a(y,{label:"\u5904\u7406\u5668\u7684\u540D\u5B57",align:"center",prop:"handlerName"}),a(y,{label:"\u5904\u7406\u5668\u7684\u53C2\u6570",align:"center",prop:"handlerParam"}),a(y,{label:"CRON \u8868\u8FBE\u5F0F",align:"center",prop:"cronExpression"}),a(y,{label:"\u64CD\u4F5C",align:"center",width:"200"},{default:e(l=>[m((s(),i(d,{type:"primary",link:"",onClick:x=>A("update",l.row.id)},{default:e(()=>[p(" \u4FEE\u6539 ")]),_:2},1032,["onClick"])),[[_,["infra:job:update"]]]),m((s(),i(d,{type:"primary",link:"",onClick:x=>(async c=>{try{const u=c.status===w.STOP?"\u5F00\u542F":"\u5173\u95ED";await f.confirm("\u786E\u8BA4\u8981"+u+'\u5B9A\u65F6\u4EFB\u52A1\u7F16\u53F7\u4E3A"'+c.id+'"\u7684\u6570\u636E\u9879?',j("common.reminder"));const ta=c.status===w.STOP?w.NORMAL:w.STOP;await za(c.id,ta),f.success(u+"\u6210\u529F"),await b()}catch{}})(l.row)},{default:e(()=>[p(fa(l.row.status===o(w).STOP?"\u5F00\u542F":"\u6682\u505C"),1)]),_:2},1032,["onClick"])),[[_,["infra:job:update"]]]),m((s(),i(d,{type:"danger",link:"",onClick:x=>(async c=>{try{await f.delConfirm(),await Fa(c),f.success(j("common.delSuccess")),await b()}catch{}})(l.row.id)},{default:e(()=>[p(" \u5220\u9664 ")]),_:2},1032,["onClick"])),[[_,["infra:job:delete"]]]),m((s(),i(aa,{onCommand:x=>((c,u)=>{switch(c){case"handleRun":H(u);break;case"openDetail":Q(u.id);break;case"handleJobLog":z(u==null?void 0:u.id)}})(x,l.row)},{dropdown:e(()=>[a($,null,{default:e(()=>[o(V)(["infra:job:trigger"])?(s(),i(O,{key:0,command:"handleRun"},{default:e(()=>[p(" \u6267\u884C\u4E00\u6B21 ")]),_:1})):R("",!0),o(V)(["infra:job:query"])?(s(),i(O,{key:1,command:"openDetail"},{default:e(()=>[p(" \u4EFB\u52A1\u8BE6\u7EC6 ")]),_:1})):R("",!0),o(V)(["infra:job:query"])?(s(),i(O,{key:2,command:"handleJobLog"},{default:e(()=>[p(" \u8C03\u5EA6\u65E5\u5FD7 ")]),_:1})):R("",!0)]),_:1})]),default:e(()=>[a(d,{type:"primary",link:""},{default:e(()=>[a(h,{icon:"ep:d-arrow-right"}),p(" \u66F4\u591A")]),_:1})]),_:2},1032,["onCommand"])),[[_,["infra:job:trigger","infra:job:query"]]])]),_:1})]),_:1},8,["data"])),[[oa,o(C)]]),a(la,{total:o(P),page:o(n).pageNo,"onUpdate:page":r[5]||(r[5]=l=>o(n).pageNo=l),limit:o(n).pageSize,"onUpdate:limit":r[6]||(r[6]=l=>o(n).pageSize=l),onPagination:b},null,8,["total","page","limit"])]),_:1}),a(Ta,{ref_key:"formRef",ref:q,onSuccess:b},null,512),a(Ua,{ref_key:"detailRef",ref:J},null,512)],64)}}});export{Ka as default};
