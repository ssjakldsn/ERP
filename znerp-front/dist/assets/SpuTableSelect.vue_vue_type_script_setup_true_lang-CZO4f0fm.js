import{d as ae,ai as le,r as i,n as te,o as b,q as x,c9 as oe,w as u,f as l,x as h,a as t,P as ue,y as de,k as I,g as ie,t as ne,c5 as K,U as re,C as pe,G as me,H as se,I as ce,J as ve,ae as fe,K as ge,ak as he,L as we,M as ye}from"./index-CIfmhqRC.js";import{_ as _e}from"./Dialog.vue_vue_type_style_index_0_lang-CtaLqQeX.js";import{_ as Ve}from"./ContentWrap.vue_vue_type_script_setup_true_lang-sm5dIhPQ.js";import{_ as be}from"./index.vue_vue_type_script_setup_true_lang-DYHi04Tm.js";import{E as xe}from"./el-image-DLpquQe6.js";import{E as Ue}from"./el-tree-select-CYFGeiEt.js";import{h as ke,d as Ce}from"./tree-BMqZf9_I.js";import{g as Ie}from"./category-CKOb63Br.js";import{d as Te}from"./spu-BTu6kAbO.js";const Se=ae({name:"SpuTableSelect",__name:"SpuTableSelect",props:{multiple:le.bool.def(!1)},emits:["change"],setup(T,{expose:P,emit:j}){const S=i(0),c=i([]),U=i(!1),m=i(!1),d=i({pageNo:1,pageSize:10,tabType:0,name:"",categoryId:null,createTime:[]});P({open:o=>{v.value=[],n.value={},p.value=!1,y.value=!1,o&&o.length>0&&(v.value=[...o],n.value=Object.fromEntries(o.map(e=>[e.id,!0]))),m.value=!0,Y()}});const w=async()=>{U.value=!0;try{const o=await Te(d.value);c.value=o.list,S.value=o.total,c.value.forEach(e=>n.value[e.id]=n.value[e.id]||!1),E()}finally{U.value=!1}},N=()=>{d.value.pageNo=1,w()},Y=()=>{d.value={pageNo:1,pageSize:10,tabType:0,name:"",categoryId:null,createTime:[]},w()},p=i(!1),y=i(!1),v=i([]),n=i({}),_=i(),B=()=>{m.value=!1,z(K,[...v.value])},z=j,F=o=>{p.value=o,y.value=!1,c.value.forEach(e=>D(o,e,!1))},D=(o,e,C)=>{if(o)v.value.push(e),n.value[e.id]=!0;else{const s=G(e);s>-1&&(v.value.splice(s,1),n.value[e.id]=!1,p.value=!1)}C&&E()},G=o=>v.value.findIndex(e=>e.id===o.id),E=()=>{p.value=c.value.every(o=>n.value[o.id]),y.value=!p.value&&c.value.some(o=>n.value[o.id])},k=i(),H=i();return te(async()=>{await w(),k.value=await Ie({}),H.value=ke(k.value,"id","parentId")}),(o,e)=>{const C=re,s=pe,J=Ue,L=me,M=se,V=ce,O=ve,q=fe,f=ge,R=he,W=xe,A=we,Q=be,X=Ve,Z=_e,$=ye;return b(),x(Z,{modelValue:t(m),"onUpdate:modelValue":e[8]||(e[8]=a=>I(m)?m.value=a:null),appendToBody:!0,title:"\u9009\u62E9\u5546\u54C1",width:"70%"},oe({default:u(()=>[l(X,null,{default:u(()=>[l(O,{ref:"queryFormRef",inline:!0,model:t(d),class:"-mb-15px","label-width":"68px"},{default:u(()=>[l(s,{label:"\u5546\u54C1\u540D\u79F0",prop:"name"},{default:u(()=>[l(C,{modelValue:t(d).name,"onUpdate:modelValue":e[0]||(e[0]=a=>t(d).name=a),class:"!w-240px",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u5546\u54C1\u540D\u79F0",onKeyup:ue(N,["enter"])},null,8,["modelValue"])]),_:1}),l(s,{label:"\u5546\u54C1\u5206\u7C7B",prop:"categoryId"},{default:u(()=>[l(J,{modelValue:t(d).categoryId,"onUpdate:modelValue":e[1]||(e[1]=a=>t(d).categoryId=a),data:t(H),props:t(Ce),"check-strictly":"",class:"!w-240px","node-key":"id",placeholder:"\u8BF7\u9009\u62E9\u5546\u54C1\u5206\u7C7B"},null,8,["modelValue","data","props"])]),_:1}),l(s,{label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime"},{default:u(()=>[l(L,{modelValue:t(d).createTime,"onUpdate:modelValue":e[2]||(e[2]=a=>t(d).createTime=a),"default-time":[new Date("1 00:00:00"),new Date("1 23:59:59")],class:"!w-240px","end-placeholder":"\u7ED3\u675F\u65E5\u671F","start-placeholder":"\u5F00\u59CB\u65E5\u671F",type:"daterange","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue","default-time"])]),_:1}),l(s,null,{default:u(()=>[l(V,{onClick:N},{default:u(()=>[l(M,{class:"mr-5px",icon:"ep:search"}),h(" \u641C\u7D22 ")]),_:1}),l(V,{onClick:Y},{default:u(()=>[l(M,{class:"mr-5px",icon:"ep:refresh"}),h(" \u91CD\u7F6E ")]),_:1})]),_:1})]),_:1},8,["model"]),de((b(),x(A,{data:t(c),"show-overflow-tooltip":""},{default:u(()=>[T.multiple?(b(),x(f,{key:0,width:"55"},{header:u(()=>[l(q,{modelValue:t(p),"onUpdate:modelValue":e[3]||(e[3]=a=>I(p)?p.value=a:null),indeterminate:t(y),onChange:F},null,8,["modelValue","indeterminate"])]),default:u(({row:a})=>[l(q,{modelValue:t(n)[a.id],"onUpdate:modelValue":r=>t(n)[a.id]=r,onChange:r=>D(r,a,!0)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1})):(b(),x(f,{key:1,label:"#",width:"55"},{default:u(({row:a})=>[l(R,{value:a.id,modelValue:t(_),"onUpdate:modelValue":e[4]||(e[4]=r=>I(_)?_.value=r:null),onChange:r=>{return z(K,g=a),m.value=!1,void(_.value=g.id);var g}},{default:u(()=>[h(" \xA0 ")]),_:2},1032,["value","modelValue","onChange"])]),_:1})),l(f,{key:"id",align:"center",label:"\u5546\u54C1\u7F16\u53F7",prop:"id","min-width":"60"}),l(f,{label:"\u5546\u54C1\u56FE","min-width":"80"},{default:u(({row:a})=>[l(W,{src:a.picUrl,class:"h-30px w-30px","preview-src-list":[a.picUrl],"preview-teleported":""},null,8,["src","preview-src-list"])]),_:1}),l(f,{label:"\u5546\u54C1\u540D\u79F0","min-width":"200",prop:"name"}),l(f,{label:"\u5546\u54C1\u5206\u7C7B","min-width":"100",prop:"categoryId"},{default:u(({row:a})=>{var r,g;return[ie("span",null,ne((g=(r=t(k))==null?void 0:r.find(ee=>ee.id===a.categoryId))==null?void 0:g.name),1)]}),_:1})]),_:1},8,["data"])),[[$,t(U)]]),l(Q,{limit:t(d).pageSize,"onUpdate:limit":e[5]||(e[5]=a=>t(d).pageSize=a),page:t(d).pageNo,"onUpdate:page":e[6]||(e[6]=a=>t(d).pageNo=a),total:t(S),onPagination:w},null,8,["limit","page","total"])]),_:1})]),_:2},[T.multiple?{name:"footer",fn:u(()=>[l(V,{type:"primary",onClick:B},{default:u(()=>[h("\u786E \u5B9A")]),_:1}),l(V,{onClick:e[7]||(e[7]=a=>m.value=!1)},{default:u(()=>[h("\u53D6 \u6D88")]),_:1})]),key:"0"}:void 0]),1032,["modelValue"])}}});export{Se as _};
