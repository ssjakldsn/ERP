import{bt as A,d as J,z as O,r as _,e as E,n as R,o as C,c as U,f as a,w as e,a as h,k as V,F as M,p as S,q as H,g as i,A as K,B as Q,C as W,G as $,J as L,E as N,j as P}from"./index-CIfmhqRC.js";import{E as X}from"./el-card-DyMugU68.js";import{_ as Z}from"./Echart.vue_vue_type_script_setup_true_lang-C-1NoClp.js";import{_ as aa}from"./ContentWrap.vue_vue_type_script_setup_true_lang-sm5dIhPQ.js";import{e as ea,g as ta,o as F,f as d,p as sa}from"./formatTime-DFFN_xWx.js";import{f as la}from"./index-Dsi5T0R-.js";import"./echarts-D6KrxhA1.js";const na=i("div",null,[i("span",null,"\u7528\u6237\u589E\u51CF\u6570\u636E")],-1),ra=i("div",null,[i("span",null,"\u7D2F\u8BA1\u7528\u6237\u6570\u636E")],-1),ua=i("div",null,[i("span",null,"\u6D88\u606F\u6982\u51B5\u6570\u636E")],-1),da=i("div",null,[i("span",null,"\u63A5\u53E3\u5206\u6790\u6570\u636E")],-1),oa=J({name:"MpStatistics",__name:"index",setup(ia){const I=O(),t=_([ea(new Date(new Date().getTime()-6048e5)),ta(new Date(new Date().getTime()-864e5))]),o=_(-1),y=_([]),c=_([]),p=E({color:["#67C23A","#E5323E"],legend:{data:["\u65B0\u589E\u7528\u6237","\u53D6\u6D88\u5173\u6CE8\u7684\u7528\u6237"]},tooltip:{},xAxis:{data:[]},yAxis:{minInterval:1},series:[{name:"\u65B0\u589E\u7528\u6237",type:"bar",label:{show:!0},barGap:0,data:[]},{name:"\u53D6\u6D88\u5173\u6CE8\u7684\u7528\u6237",type:"bar",label:{show:!0},data:[]}]}),x=E({legend:{data:["\u7D2F\u8BA1\u7528\u6237\u91CF"]},xAxis:{type:"category",data:[]},yAxis:{minInterval:1},series:[{name:"\u7D2F\u8BA1\u7528\u6237\u91CF",data:[],type:"line",smooth:!0,label:{show:!0}}]}),m=E({color:["#67C23A","#E5323E"],legend:{data:["\u7528\u6237\u53D1\u9001\u4EBA\u6570","\u7528\u6237\u53D1\u9001\u6761\u6570"]},tooltip:{},xAxis:{data:[]},yAxis:{minInterval:1},series:[{name:"\u7528\u6237\u53D1\u9001\u4EBA\u6570",type:"line",smooth:!0,label:{show:!0},data:[]},{name:"\u7528\u6237\u53D1\u9001\u6761\u6570",type:"line",smooth:!0,label:{show:!0},data:[]}]}),u=E({color:["#67C23A","#E5323E","#E6A23C","#409EFF"],legend:{data:["\u88AB\u52A8\u56DE\u590D\u7528\u6237\u6D88\u606F\u7684\u6B21\u6570","\u5931\u8D25\u6B21\u6570","\u6700\u5927\u8017\u65F6","\u603B\u8017\u65F6"]},tooltip:{},xAxis:{data:[]},yAxis:{},series:[{name:"\u88AB\u52A8\u56DE\u590D\u7528\u6237\u6D88\u606F\u7684\u6B21\u6570",type:"bar",label:{show:!0},barGap:0,data:[]},{name:"\u5931\u8D25\u6B21\u6570",type:"bar",label:{show:!0},data:[]},{name:"\u6700\u5927\u8017\u65F6",type:"bar",label:{show:!0},data:[]},{name:"\u603B\u8017\u65F6",type:"bar",label:{show:!0},data:[]}]}),D=()=>{if(!o)return I.error("\u672A\u9009\u4E2D\u516C\u4F17\u53F7\uFF0C\u65E0\u6CD5\u7EDF\u8BA1\u6570\u636E"),!1;if(F(t.value[0],t.value[1])>=7)return I.error("\u65F6\u95F4\u95F4\u9694 7 \u5929\u4EE5\u5185\uFF0C\u8BF7\u91CD\u65B0\u9009\u62E9"),!1;c.value=[];const l=F(t.value[0],t.value[1]);for(let s=0;s<=l;s++)c.value.push(d(sa(t.value[0],864e5*s),"YYYY-MM-DD"));G(),T(),k(),j()},G=async()=>{p.xAxis.data=[],p.series[0].data=[],p.series[1].data=[];try{const s=await(l={accountId:o.value,date:[d(t.value[0]),d(t.value[1])]},A.get({url:"/mp/statistics/user-summary",params:l}));p.xAxis.data=c.value,c.value.forEach((r,n)=>{s.forEach(f=>{d(new Date(f.refDate),"YYYY-MM-DD").indexOf(r)!==-1&&(p.series[0].data[n]=f.newUser,p.series[1].data[n]=f.cancelUser)})})}catch{}var l},T=async()=>{x.xAxis.data=[],x.series[0].data=[];try{const s=await(l={accountId:o.value,date:[d(t.value[0]),d(t.value[1])]},A.get({url:"/mp/statistics/user-cumulate",params:l}));x.xAxis.data=c.value,s.forEach((r,n)=>{x.series[0].data[n]=r.cumulateUser})}catch{}var l},k=async()=>{m.xAxis.data=[],m.series[0].data=[],m.series[1].data=[];try{const s=await(l={accountId:o.value,date:[d(t.value[0]),d(t.value[1])]},A.get({url:"/mp/statistics/upstream-message",params:l}));m.xAxis.data=c.value,s.forEach((r,n)=>{m.series[0].data[n]=r.messageUser,m.series[1].data[n]=r.messageCount})}catch{}var l},j=async()=>{u.xAxis.data=[],u.series[0].data=[],u.series[1].data=[],u.series[2].data=[],u.series[3].data=[];try{const s=await(l={accountId:o.value,date:[d(t.value[0]),d(t.value[1])]},A.get({url:"/mp/statistics/interface-summary",params:l}));u.xAxis.data=c.value,s.forEach((r,n)=>{u.series[0].data[n]=r.callbackCount,u.series[1].data[n]=r.failCount,u.series[2].data[n]=r.maxTimeCost,u.series[3].data[n]=r.totalTimeCost})}catch{}var l};return R(async()=>{await(async()=>{y.value=await la(),y.value.length>0&&(o.value=y.value[0].id)})(),D()}),(l,s)=>{const r=K,n=Q,f=W,q=$,z=L,Y=aa,b=Z,w=X,g=N,B=P;return C(),U(M,null,[a(Y,null,{default:e(()=>[a(z,{class:"-mb-15px",ref:"queryForm",inline:!0,"label-width":"68px"},{default:e(()=>[a(f,{label:"\u516C\u4F17\u53F7",prop:"accountId"},{default:e(()=>[a(n,{modelValue:h(o),"onUpdate:modelValue":s[0]||(s[0]=v=>V(o)?o.value=v:null),onChange:D,class:"!w-240px"},{default:e(()=>[(C(!0),U(M,null,S(h(y),v=>(C(),H(r,{key:v.id,label:v.name,value:v.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(f,{label:"\u65F6\u95F4\u8303\u56F4",prop:"dateRange"},{default:e(()=>[a(q,{modelValue:h(t),"onUpdate:modelValue":s[1]||(s[1]=v=>V(t)?t.value=v:null),type:"daterange","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F","default-time":[new Date("1 00:00:00"),new Date("1 23:59:59")],onChange:D,class:"!w-240px"},null,8,["modelValue","default-time"])]),_:1})]),_:1},512)]),_:1}),a(Y,null,{default:e(()=>[a(B,null,{default:e(()=>[a(g,{span:12,class:"card-box"},{default:e(()=>[a(w,null,{header:e(()=>[na]),default:e(()=>[a(b,{options:h(p),height:420},null,8,["options"])]),_:1})]),_:1}),a(g,{span:12,class:"card-box"},{default:e(()=>[a(w,null,{header:e(()=>[ra]),default:e(()=>[a(b,{options:h(x),height:420},null,8,["options"])]),_:1})]),_:1}),a(g,{span:12,class:"card-box"},{default:e(()=>[a(w,null,{header:e(()=>[ua]),default:e(()=>[a(b,{options:h(m),height:420},null,8,["options"])]),_:1})]),_:1}),a(g,{span:12,class:"card-box"},{default:e(()=>[a(w,null,{header:e(()=>[da]),default:e(()=>[a(b,{options:h(u),height:420},null,8,["options"])]),_:1})]),_:1})]),_:1})]),_:1})],64)}}});export{oa as default};
