import{bt as C,d as Q,z as W,r as i,O as Y,o as v,c as b,f as u,w as y,a as t,y as k,g as f,t as Z,k as A,q as F,x as N,F as ee,C as le,J as ae,I as re,M as ie,a0 as te,a1 as ue,_ as ne}from"./index-CIfmhqRC.js";import{_ as se}from"./ContentWrap.vue_vue_type_script_setup_true_lang-sm5dIhPQ.js";import{_ as ce}from"./index-2RHHZ-Zv.js";import{_ as pe}from"./main.vue_vue_type_script_setup_true_lang-Ds9hfoYc.js";import oe from"./MenuEditor-e-iU6wZq.js";import de from"./MenuPreviewer-MPz2fZMJ.js";import{h as me}from"./tree-BMqZf9_I.js";import"./el-card-DyMugU68.js";import"./index-Dsi5T0R-.js";import"./main-BKPadW1d.js";import"./TabNews-7oV1NnBl.js";import"./main-q6_374v6.js";import"./el-image-DLpquQe6.js";import"./main-CfsIYUE7.js";import"./index.vue_vue_type_script_setup_true_lang-DYHi04Tm.js";import"./index-CrBeVHKs.js";import"./main-D-MTREjU.js";import"./main.vue_vue_type_script_setup_true_lang-4T-wzdRZ.js";import"./index-B3YA5cCI.js";import"./index-DO3zXEBC.js";import"./formatTime-DFFN_xWx.js";import"./TabText.vue_vue_type_script_setup_true_lang-56KExiTN.js";import"./TabImage-E636bkCf.js";import"./useUpload-Dugldi2L.js";import"./TabVoice-Dqn1wB6g.js";import"./TabVideo-C4oWHYiJ.js";import"./TabMusic.vue_vue_type_script_setup_true_lang-YMp3hNn3.js";import"./vuedraggable.umd-CcTr7I5e.js";const ve={class:"clearfix public-account-management"},ye={class:"left"},fe={class:"weixin-hd"},he={class:"weixin-title"},Me={class:"clearfix weixin-menu"},_e={class:"save_div"},xe={key:0,class:"right"},be={key:1,class:"right"},Ue=[(x=>(te("data-v-3cc4e775"),x=x(),ue(),x))(()=>f("p",null,"\u8BF7\u9009\u62E9\u83DC\u5355\u914D\u7F6E",-1))],E="__MENU_NOT_SELECTED__",ge=ne(Q({name:"MpMenu",__name:"index",setup(x){const o=W(),n=i(!1),d=i(-1),V=i(""),s=i([]),h=i(E),U=i(-1),M=i(!1),g=i(!0),c=i({}),r=i({grand:"0",x:0,y:0}),z=i(!1),G=(l,e)=>{d.value=l,V.value=e,I()},I=async()=>{n.value=!1;try{const l=await(a=>C.get({url:"/mp/menu/list?accountId="+a}))(d.value),e=J(l);s.value=me(e,"id")}finally{n.value=!1}},J=l=>{if(!l)return[];const e=[];return l.forEach(a=>{const m={...a};m.reply={type:a.replyMessageType,accountId:a.accountId,content:a.replyContent,mediaId:a.replyMediaId,url:a.replyMediaUrl,title:a.replyTitle,description:a.replyDescription,thumbMediaId:a.replyThumbMediaId,thumbMediaUrl:a.replyThumbMediaUrl,articles:a.replyArticles,musicUrl:a.replyMusicUrl,hqMusicUrl:a.replyHqMusicUrl},e.push(m)}),e},L=()=>{h.value=E,U.value=-1,M.value=!1,c.value={},r.value={grand:"0",x:0,y:0},z.value=!1},P=async()=>{var l;try{await o.confirm("\u786E\u5B9A\u8981\u5220\u9664\u5417?"),r.value.grand==="1"?s.value.splice(r.value.x,1):r.value.grand==="2"&&((l=s.value[r.value.x].children)==null||l.splice(r.value.y,1)),o.notifySuccess("\u5220\u9664\u6210\u529F"),c.value={},M.value=!1,h.value=E}catch{}},R=async()=>{try{await o.confirm("\u786E\u5B9A\u8981\u4FDD\u5B58\u5417?"),n.value=!0,await((l,e)=>C.post({url:"/mp/menu/save",data:{accountId:l,menus:e}}))(d.value,j()),I(),o.notifySuccess("\u53D1\u5E03\u6210\u529F")}finally{n.value=!1}},X=async()=>{try{await o.confirm("\u786E\u5B9A\u8981\u5220\u9664\u5417?"),n.value=!0,await(l=>C.delete({url:"/mp/menu/delete?accountId="+l}))(d.value),L(),I(),o.notifySuccess("\u6E05\u7A7A\u6210\u529F")}finally{n.value=!1}},j=()=>{const l=[];return s.value.forEach(e=>{const a=q(e);l.push(a),!e.children||e.children.length<=0||(a.children=[],e.children.forEach(m=>{a.children.push(q(m))}))}),l},q=l=>{let e={...l,children:void 0,reply:void 0};return e.replyMessageType=l.reply.type,e.replyContent=l.reply.content,e.replyMediaId=l.reply.mediaId,e.replyMediaUrl=l.reply.url,e.replyTitle=l.reply.title,e.replyDescription=l.reply.description,e.replyThumbMediaId=l.reply.thumbMediaId,e.replyThumbMediaUrl=l.reply.thumbMediaUrl,e.replyArticles=l.reply.articles,e.replyMusicUrl=l.reply.musicUrl,e.replyHqMusicUrl=l.reply.hqMusicUrl,e};return(l,e)=>{const a=ce,m=le,B=ae,S=se,D=re,H=Y("hasPermi"),K=ie;return v(),b(ee,null,[u(a,{title:"\u516C\u4F17\u53F7\u83DC\u5355",url:"https://doc.iocoder.cn/mp/menu/"}),u(S,null,{default:y(()=>[u(B,{class:"-mb-15px",ref:"queryFormRef",inline:!0,"label-width":"68px"},{default:y(()=>[u(m,{label:"\u516C\u4F17\u53F7",prop:"accountId"},{default:y(()=>[u(t(pe),{onChange:G})]),_:1})]),_:1},512)]),_:1}),u(S,null,{default:y(()=>[k((v(),b("div",ve,[f("div",ye,[f("div",fe,[f("div",he,Z(t(V)),1)]),f("div",Me,[u(de,{modelValue:t(s),"onUpdate:modelValue":e[0]||(e[0]=p=>A(s)?s.value=p:null),"account-id":t(d),"active-index":t(h),"parent-index":t(U),onMenuClicked:e[1]||(e[1]=(p,w)=>((T,_)=>{M.value=!0,c.value=T,r.value.grand="1",r.value.x=_,g.value=!0,h.value=`${_}`,U.value=_})(p,w)),onSubmenuClicked:e[2]||(e[2]=(p,w,T)=>((_,O,$)=>{M.value=!0,c.value=_,r.value.grand="2",r.value.x=O,r.value.y=$,g.value=!1,h.value=`${O}-${$}`})(p,w,T))},null,8,["modelValue","account-id","active-index","parent-index"])]),f("div",_e,[k((v(),F(D,{class:"save_btn",type:"success",onClick:R},{default:y(()=>[N("\u4FDD\u5B58\u5E76\u53D1\u5E03\u83DC\u5355")]),_:1})),[[H,["mp:menu:save"]]]),k((v(),F(D,{class:"save_btn",type:"danger",onClick:X},{default:y(()=>[N("\u6E05\u7A7A\u83DC\u5355")]),_:1})),[[H,["mp:menu:delete"]]])])]),t(M)?(v(),b("div",xe,[u(oe,{"account-id":t(d),"is-parent":t(g),modelValue:t(c),"onUpdate:modelValue":e[3]||(e[3]=p=>A(c)?c.value=p:null),onDelete:P},null,8,["account-id","is-parent","modelValue"])])):(v(),b("div",be,Ue))])),[[K,t(n)]])]),_:1})],64)}}}),[["__scopeId","data-v-3cc4e775"]]);export{ge as default};
