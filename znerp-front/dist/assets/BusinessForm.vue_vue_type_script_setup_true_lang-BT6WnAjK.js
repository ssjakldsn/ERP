import{d as Q,r as i,e as X,ar as Y,o as m,q as v,w as d,f as e,x as C,a,y as Z,c as y,p as U,F as g,k as R,dV as S,h as $,z as ee,dW as le,b as ae,U as de,C as te,E as ue,A as oe,B as re,j as se,G as ie,l as ce,m as me,cc as ne,J as pe,I as fe,M as ve}from"./index-CIfmhqRC.js";import{_ as _e}from"./Dialog.vue_vue_type_style_index_0_lang-CtaLqQeX.js";import{_ as be}from"./ContentWrap.vue_vue_type_script_setup_true_lang-sm5dIhPQ.js";import{a as Ve,c as Pe,u as Ie}from"./index-B5nlbV2q.js";import{g as we}from"./index-CwB7FJGa.js";import{a as ye}from"./index-BZptzjxi.js";import{g as Ue}from"./index-QrlE36WK.js";import{_ as ge}from"./BusinessProductForm.vue_vue_type_script_setup_true_lang-23yRPDfu.js";const ke=Q({__name:"BusinessForm",emits:["success"],setup(he,{expose:z,emit:A}){const{t:b}=$(),k=ee(),n=i(!1),h=i(""),p=i(!1),f=i(""),t=i({id:void 0,name:void 0,customerId:void 0,ownerUserId:void 0,statusTypeId:void 0,dealTime:void 0,discountPercent:0,totalProductPrice:void 0,totalPrice:void 0,remark:void 0,products:[],contactId:void 0,customerDefault:!1}),B=X({name:[{required:!0,message:"\u5546\u673A\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],customerId:[{required:!0,message:"\u5BA2\u6237\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],ownerUserId:[{required:!0,message:"\u8D1F\u8D23\u4EBA\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],statusTypeId:[{required:!0,message:"\u5546\u673A\u72B6\u6001\u7EC4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),_=i(),T=i([]),x=i([]),q=i([]),V=i("product"),D=i();Y(()=>t.value,o=>{if(!o)return;const u=o.products.reduce((r,s)=>r+s.totalPrice,0),c=u-(o.discountPercent!=null?le(u,o.discountPercent/100):0);t.value.totalProductPrice=u,t.value.totalPrice=c},{deep:!0}),z({open:async(o,u,c,r)=>{if(n.value=!0,h.value=b("action."+o),f.value=o,W(),u){p.value=!0;try{t.value=await Ve(u)}finally{p.value=!1}}else c&&(t.value.customerId=c,t.value.customerDefault=!0),r&&(t.value.contactId=r);q.value=await ye(),x.value=await we(),T.value=await Ue(),f.value==="create"&&(t.value.ownerUserId=ae().getUser.id)}});const E=A,J=async()=>{if(_&&await _.value.validate()){await D.value.validate(),p.value=!0;try{const o=t.value;f.value==="create"?(await Pe(o),k.success(b("common.createSuccess"))):(await Ie(o),k.success(b("common.updateSuccess"))),n.value=!1,E("success")}finally{p.value=!1}}},W=()=>{var o;t.value={id:void 0,name:void 0,customerId:void 0,ownerUserId:void 0,statusTypeId:void 0,dealTime:void 0,discountPercent:0,totalProductPrice:void 0,totalPrice:void 0,remark:void 0,products:[],contactId:void 0,customerDefault:!1},(o=_.value)==null||o.resetFields()};return(o,u)=>{const c=de,r=te,s=ue,P=oe,I=re,w=se,j=ie,G=ce,H=me,M=be,K=ne,L=pe,F=fe,N=_e,O=ve;return m(),v(N,{title:a(h),modelValue:a(n),"onUpdate:modelValue":u[11]||(u[11]=l=>R(n)?n.value=l:null),width:"1280"},{footer:d(()=>[e(F,{onClick:J,type:"primary",disabled:a(p)},{default:d(()=>[C("\u786E \u5B9A")]),_:1},8,["disabled"]),e(F,{onClick:u[10]||(u[10]=l=>n.value=!1)},{default:d(()=>[C("\u53D6 \u6D88")]),_:1})]),default:d(()=>[Z((m(),v(L,{ref_key:"formRef",ref:_,model:a(t),rules:a(B),"label-width":"120px"},{default:d(()=>[e(w,null,{default:d(()=>[e(s,{span:8},{default:d(()=>[e(r,{label:"\u5546\u673A\u540D\u79F0",prop:"name"},{default:d(()=>[e(c,{modelValue:a(t).name,"onUpdate:modelValue":u[0]||(u[0]=l=>a(t).name=l),placeholder:"\u8BF7\u8F93\u5165\u5546\u673A\u540D\u79F0"},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:d(()=>[e(r,{label:"\u8D1F\u8D23\u4EBA",prop:"ownerUserId"},{default:d(()=>[e(I,{modelValue:a(t).ownerUserId,"onUpdate:modelValue":u[1]||(u[1]=l=>a(t).ownerUserId=l),disabled:a(f)!=="create",class:"w-1/1"},{default:d(()=>[(m(!0),y(g,null,U(a(T),l=>(m(),v(P,{key:l.id,label:l.nickname,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),e(s,{span:8},{default:d(()=>[e(r,{label:"\u5BA2\u6237\u540D\u79F0",prop:"customerId"},{default:d(()=>[e(I,{disabled:a(t).customerDefault,modelValue:a(t).customerId,"onUpdate:modelValue":u[2]||(u[2]=l=>a(t).customerId=l),placeholder:"\u8BF7\u9009\u62E9\u5BA2\u6237",class:"w-1/1"},{default:d(()=>[(m(!0),y(g,null,U(a(q),l=>(m(),v(P,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["disabled","modelValue"])]),_:1})]),_:1})]),_:1}),e(w,null,{default:d(()=>[e(s,{span:8},{default:d(()=>[e(r,{label:"\u5546\u673A\u72B6\u6001\u7EC4",prop:"statusTypeId"},{default:d(()=>[e(I,{modelValue:a(t).statusTypeId,"onUpdate:modelValue":u[3]||(u[3]=l=>a(t).statusTypeId=l),placeholder:"\u8BF7\u9009\u62E9\u5546\u673A\u72B6\u6001\u7EC4",clearable:"",class:"w-1/1",disabled:a(f)!=="create"},{default:d(()=>[(m(!0),y(g,null,U(a(x),l=>(m(),v(P,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),e(s,{span:8},{default:d(()=>[e(r,{label:"\u9884\u8BA1\u6210\u4EA4\u65E5\u671F",prop:"dealTime"},{default:d(()=>[e(j,{modelValue:a(t).dealTime,"onUpdate:modelValue":u[4]||(u[4]=l=>a(t).dealTime=l),type:"date","value-format":"x",placeholder:"\u9009\u62E9\u9884\u8BA1\u6210\u4EA4\u65E5\u671F",class:"!w-1/1"},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:d(()=>[e(r,{label:"\u5907\u6CE8",prop:"remark"},{default:d(()=>[e(c,{type:"textarea",modelValue:a(t).remark,"onUpdate:modelValue":u[5]||(u[5]=l=>a(t).remark=l),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(M,null,{default:d(()=>[e(H,{modelValue:a(V),"onUpdate:modelValue":u[6]||(u[6]=l=>R(V)?V.value=l:null),class:"-mt-15px -mb-10px"},{default:d(()=>[e(G,{label:"\u4EA7\u54C1\u6E05\u5355",name:"product"},{default:d(()=>[e(ge,{ref_key:"productFormRef",ref:D,products:a(t).products,disabled:o.disabled},null,8,["products","disabled"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(w,null,{default:d(()=>[e(s,{span:8},{default:d(()=>[e(r,{label:"\u4EA7\u54C1\u603B\u91D1\u989D",prop:"totalProductPrice"},{default:d(()=>[e(c,{disabled:"",modelValue:a(t).totalProductPrice,"onUpdate:modelValue":u[7]||(u[7]=l=>a(t).totalProductPrice=l),formatter:a(S)},null,8,["modelValue","formatter"])]),_:1})]),_:1}),e(s,{span:8},{default:d(()=>[e(r,{label:"\u6574\u5355\u6298\u6263\uFF08%\uFF09",prop:"discountPercent"},{default:d(()=>[e(K,{modelValue:a(t).discountPercent,"onUpdate:modelValue":u[8]||(u[8]=l=>a(t).discountPercent=l),placeholder:"\u8BF7\u8F93\u5165\u6574\u5355\u6298\u6263","controls-position":"right",min:0,precision:2,class:"!w-1/1"},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:d(()=>[e(r,{label:"\u6298\u6263\u540E\u91D1\u989D",prop:"price"},{default:d(()=>[e(c,{disabled:"",modelValue:a(t).totalPrice,"onUpdate:modelValue":u[9]||(u[9]=l=>a(t).totalPrice=l),placeholder:"\u8BF7\u8F93\u5165\u5546\u673A\u91D1\u989D",formatter:a(S)},null,8,["modelValue","formatter"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])),[[O,a(p)]])]),_:1},8,["title","modelValue"])}}});export{ke as _};
